!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";exports.byteLength=function(b64){var b64=getLens(b64),validLen=b64[0],b64=b64[1];return 3*(validLen+b64)/4-b64},exports.toByteArray=function(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],lens=lens[1],arr=new Arr(function(validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(validLen,lens)),curByte=0,len=0<lens?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===lens&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===lens&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(function(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(function(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}(tmp));return output.join("")}(uint8,i,len2<i+16383?len2:i+16383));1==extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2==extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(0<len%4)throw new Error("Invalid string. Length must be a multiple of 4");b64=b64.indexOf("="),len=(b64=-1===b64?len:b64)===len?0:4-b64%4;return[b64,len]}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],2:[function(require,module,exports){!function(Buffer){!function(){"use strict";var base64=require("base64-js"),ieee754=require("ieee754"),K_MAX_LENGTH=(exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50,2147483647);function createBuffer(length){if(K_MAX_LENGTH<length)throw new RangeError('The value "'+length+'" is invalid for option "size"');length=new Uint8Array(length);return length.__proto__=Buffer.prototype,length}function Buffer(arg,encodingOrOffset,length){if("number"!=typeof arg)return from(arg,encodingOrOffset,length);if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}function from(value,encodingOrOffset,length){if("string"==typeof value)return function(string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),string=buf.write(string,encoding);string!==length&&(buf=buf.slice(0,string));return buf}(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return function(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);return array.__proto__=Buffer.prototype,array}(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);valueOf=function(obj){{var len,buf;if(Buffer.isBuffer(obj))return len=0|checked(obj.length),0!==(buf=createBuffer(len)).length&&obj.copy(buf,0,0,len),buf}if(void 0!==obj.length)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}(value);if(valueOf)return valueOf;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function checked(length){if(K_MAX_LENGTH<=length)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=2<arguments.length&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((start=void 0===start||start<0?0:start)>this.length)return"";if((end=void 0===end||end>this.length?this.length:end)<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding=encoding||"utf8";;)switch(encoding){case"hex":return function(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0);(!end||end<0||len<end)&&(end=len);for(var out="",i=start;i<end;++i)out+=function(n){return n<16?"0"+n.toString(16):n.toString(16)}(buf[i]);return out}(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}(this,start,end);case"latin1":case"binary":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}(this,start,end);case"base64":return function(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):2147483647<byteOffset?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),(byteOffset=(byteOffset=numberIsNaN(byteOffset=+byteOffset)?dir?0:buffer.length-1:byteOffset)<0?buffer.length+byteOffset:byteOffset)>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?(dir?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;arrLength/=indexSize=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir)for(var foundIndex=-1,i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(i-(foundIndex=-1===foundIndex?i:foundIndex)+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1;else for(i=byteOffset=arrLength<byteOffset+valLength?arrLength-valLength:byteOffset;0<=i;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var c,hi,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,byteArray.push(c%256),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=239<firstByte?4:223<firstByte?3:191<firstByte?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&127<(tempCodePoint=(31&firstByte)<<6|63&secondByte)&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&2047<(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)&&(tempCodePoint<55296||57343<tempCodePoint)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&65535<(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):65535<codePoint&&(res.push((codePoint-=65536)>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}exports.kMaxLength=K_MAX_LENGTH,(Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=from,Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return assertSize(size),!(size<=0)&&void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)},Buffer.allocUnsafe=allocUnsafe,Buffer.allocUnsafeSlow=allocUnsafe,Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);if(void 0===length)for(i=length=0;i<list.length;++i)length+=list[i].length;for(var buffer=Buffer.allocUnsafe(length),pos=0,i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toLocaleString=Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(Buffer.isBuffer(b))return this===b||0===Buffer.compare(this,b);throw new TypeError("Argument must be a Buffer")},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES,str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();return this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),(start=void 0===start?0:start)<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisEnd<=thisStart&&end<=start)return 0;if(thisEnd<=thisStart)return-1;if(end<=start)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||remaining<length)&&(length=remaining),0<string.length&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding=encoding||"utf8";for(var loweredCase=!1;;)switch(encoding){case"hex":return function(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;(!length||remaining<(length=Number(length)))&&(length=remaining),(remaining=string.length)/2<length&&(length=remaining/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}(this,string,offset,length);case"utf8":case"utf-8":return function(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return asciiWrite(this,string,offset,length);case"base64":return function(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(length<offset+ext)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(max<value||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,end){var len=this.length,len=((start=~~start)<0?(start+=len)<0&&(start=0):len<start&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):len<end&&(end=len),end<start&&(end=start),this.subarray(start,end));return len.__proto__=Buffer.prototype,len},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;0<byteLength&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];0<i&&(mul*=256);)val+=this[offset+--i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);noAssert=this[offset]|this[offset+1]<<8;return 32768&noAssert?4294901760|noAssert:noAssert},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);noAssert=this[offset+1]|this[offset]<<8;return 32768&noAssert?4294901760|noAssert:noAssert},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,byteLength,(noAssert=Math.pow(2,8*byteLength-1))-1,-noAssert);var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,byteLength,(noAssert=Math.pow(2,8*byteLength-1))-1,-noAssert);var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),this[offset]=255&(value=value<0?255+value+1:value),offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=(value=value<0?4294967295+value+1:value)>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start=start||0,end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),(end=0<end&&end<start?start:end)===start)return 0;if(0===target.length||0===this.length)return 0;if((targetStart=targetStart||0)<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length);var len=(end=target.length-targetStart<end-start?target.length-targetStart+start:end)-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;0<=i;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var code;1===val.length&&(code=val.charCodeAt(0),"utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");var i;if(!(end<=start))if(start>>>=0,end=void 0===end?this.length:end>>>0,"number"==typeof(val=val||0))for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(55295<(codePoint=string.charCodeAt(i))&&codePoint<57344){if(!leadSurrogate){if(56319<codePoint){-1<(units-=3)&&bytes.push(239,191,189);continue}if(i+1===length){-1<(units-=3)&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){-1<(units-=3)&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&-1<(units-=3)&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if(--units<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}}.call(this)}.call(this,require("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:3}],3:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,nBytes=buffer[offset+i];for(i+=d,e=nBytes&(1<<-nBits)-1,nBytes>>=-nBits,nBits+=eLen;0<nBits;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;0<nBits;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(nBytes?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(nBytes?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,nBytes=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(isLE=Math.pow(2,-e))<1&&(e--,isLE*=2),2<=(value+=1<=e+eBias?rt/isLE:rt*Math.pow(2,1-eBias))*isLE&&(e++,isLE/=2),eMax<=e+eBias?(m=0,e=eMax):1<=e+eBias?(m=(value*isLE-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));8<=mLen;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;0<eLen;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*nBytes}},{}],4:[function(require,module,exports){!function(Buffer){!function(){module.exports=new function(){var el,bBE=!1,m=this;m._DeArray=function(a,p,l){return[a.slice(p,p+l)]},m._EnArray=function(a,p,l,v){for(var i=0;i<l;a[p+i]=v[i]||0,i++);},m._DeChar=function(a,p){return String.fromCharCode(a[p])},m._EnChar=function(a,p,v){a[p]=v.charCodeAt(0)},m._DeInt=function(a,p){for(var lsb=bBE?el.len-1:0,nsb=bBE?-1:1,stop=lsb+nsb*el.len,rv=0,i=lsb,f=1;i!=stop;rv+=a[p+i]*f,i+=nsb,f*=256);return el.bSigned&&rv&Math.pow(2,8*el.len-1)&&(rv-=Math.pow(2,8*el.len)),rv},m._EnInt=function(a,p,v){var i,lsb=bBE?el.len-1:0,nsb=bBE?-1:1,stop=lsb+nsb*el.len;for(v=v<el.min?el.min:v>el.max?el.max:v,i=lsb;i!=stop;a[p+i]=255&v,i+=nsb,v>>=8);},m._DeString=function(a,p,l){for(var rv=new Array(l),i=0;i<l;rv[i]=String.fromCharCode(a[p+i]),i++);return rv.join("")},m._EnString=function(a,p,l,v){for(var i=0;i<l;a[p+i]=v.charCodeAt(i)||0,i++);},m._DeNullString=function(a,p,l,v){a=m._DeString(a,p,l,v);return a.substring(0,a.length-1)},m._De754=function(a,p){var e,m,nBits,mLen=el.mLen,eLen=8*el.len-el.mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,i=bBE?0:el.len-1,d=bBE?1:-1,s=a[p+i];for(i+=d,e=s&(1<<-(nBits=-7))-1,s>>=-nBits,nBits+=eLen;0<nBits;e=256*e+a[p+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;0<nBits;m=256*m+a[p+i],i+=d,nBits-=8);switch(e){case 0:e=1-eBias;break;case eMax:return m?NaN:1/0*(s?-1:1);default:m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},m._En754=function(a,p,v){var e,m,i,d,c,mLen=el.mLen,eLen=8*el.len-el.mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,s=v<0?1:0;for(v=Math.abs(v),isNaN(v)||v==1/0?(m=isNaN(v)?1:0,e=eMax):(e=Math.floor(Math.log(v)/Math.LN2),v*(c=Math.pow(2,-e))<1&&(e--,c*=2),2<=(v+=1<=e+eBias?el.rt/c:el.rt*Math.pow(2,1-eBias))*c&&(e++,c/=2),eMax<=e+eBias?(m=0,e=eMax):1<=e+eBias?(m=(v*c-1)*Math.pow(2,mLen),e+=eBias):(m=v*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0)),i=bBE?el.len-1:0,d=bBE?-1:1;8<=mLen;a[p+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;0<eLen;a[p+i]=255&e,i+=d,e/=256,eLen-=8);a[p+i-d]|=128*s},m._sPattern="(\\d+)?([AxcbBhHsSfdiIlL])(\\(([a-zA-Z0-9]+)\\))?",m._lenLut={A:1,x:1,c:1,b:1,B:1,h:2,H:2,s:1,S:1,f:4,d:8,i:4,I:4,l:4,L:4},m._elLut={A:{en:m._EnArray,de:m._DeArray},s:{en:m._EnString,de:m._DeString},S:{en:m._EnString,de:m._DeNullString},c:{en:m._EnChar,de:m._DeChar},b:{en:m._EnInt,de:m._DeInt,len:1,bSigned:!0,min:-Math.pow(2,7),max:Math.pow(2,7)-1},B:{en:m._EnInt,de:m._DeInt,len:1,bSigned:!1,min:0,max:Math.pow(2,8)-1},h:{en:m._EnInt,de:m._DeInt,len:2,bSigned:!0,min:-Math.pow(2,15),max:Math.pow(2,15)-1},H:{en:m._EnInt,de:m._DeInt,len:2,bSigned:!1,min:0,max:Math.pow(2,16)-1},i:{en:m._EnInt,de:m._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},I:{en:m._EnInt,de:m._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},l:{en:m._EnInt,de:m._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},L:{en:m._EnInt,de:m._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},f:{en:m._En754,de:m._De754,len:4,mLen:23,rt:Math.pow(2,-24)-Math.pow(2,-77)},d:{en:m._En754,de:m._De754,len:8,mLen:52,rt:0}},m._UnpackSeries=function(n,s,a,p){for(var fxn=el.de,rv=[],i=0;i<n;rv.push(fxn(a,p+i*s)),i++);return rv},m._PackSeries=function(n,s,a,p,v,i){for(var fxn=el.en,o=0;o<n;fxn(a,p+o*s,v[i+o]),o++);},m._zip=function(keys,values){for(var result={},i=0;i<keys.length;i++)result[keys[i]]=values[i];return result},m.unpack=function(fmt,a,p){bBE="<"!=fmt.charAt(0),p=p||0;for(var m,n,s,re=new RegExp(this._sPattern,"g"),rk=[],rv=[];m=re.exec(fmt);){if(n=null==m[1]||""==m[1]?1:parseInt(m[1]),"S"===m[2]){for(n=0;0!==a[p+n];)n++;n++}if(p+n*(s=this._lenLut[m[2]])>a.length)return;switch(m[2]){case"A":case"s":case"S":rv.push(this._elLut[m[2]].de(a,p,n));break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":el=this._elLut[m[2]],rv.push(this._UnpackSeries(n,s,a,p))}rk.push(m[4]),p+=n*s}return rv=Array.prototype.concat.apply([],rv),-1!==rk.indexOf(void 0)?rv:this._zip(rk,rv)},m.packTo=function(fmt,a,p,values){bBE="<"!=fmt.charAt(0);for(var m,n,s,j,re=new RegExp(this._sPattern,"g"),i=0;m=re.exec(fmt);){if(n=null==m[1]||""==m[1]?1:parseInt(m[1]),p+(n="S"===m[2]?values[i].length+1:n)*(s=this._lenLut[m[2]])>a.length)return!1;switch(m[2]){case"A":case"s":case"S":if(i+1>values.length)return!1;this._elLut[m[2]].en(a,p,n,values[i]),i+=1;break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":if(el=this._elLut[m[2]],i+n>values.length)return!1;this._PackSeries(n,s,a,p,values,i),i+=n;break;case"x":for(j=0;j<n;j++)a[p+j]=0}p+=n*s}return a},m.pack=function(fmt,values){return this.packTo(fmt,new Buffer(this.calcLength(fmt,values)),0,values)},m.calcLength=function(format,values){for(var m,re=new RegExp(this._sPattern,"g"),sum=0,i=0;m=re.exec(format);){var n=(null==m[1]||""==m[1]?1:parseInt(m[1]))*this._lenLut[m[2]];sum+=n="S"===m[2]?values[i].length+1:n,i++}return sum}}}.call(this)}.call(this,require("buffer").Buffer)},{buffer:2}],5:[function(require,module,exports){"use strict";var dijkstra={single_source_shortest_paths:function(graph,s,d){var closest,u,v,cost_of_s_to_u,adjacent_nodes,cost_of_s_to_u_plus_cost_of_e,cost_of_s_to_v,predecessors={},costs={},open=(costs[s]=0,dijkstra.PriorityQueue.make());for(open.push(s,0);!open.empty();)for(v in u=(closest=open.pop()).value,cost_of_s_to_u=closest.cost,adjacent_nodes=graph[u]||{})adjacent_nodes.hasOwnProperty(v)&&(cost_of_s_to_u_plus_cost_of_e=cost_of_s_to_u+adjacent_nodes[v],void 0===(cost_of_s_to_v=costs[v])||cost_of_s_to_u_plus_cost_of_e<cost_of_s_to_v)&&(open.push(v,costs[v]=cost_of_s_to_u_plus_cost_of_e),predecessors[v]=u);if(void 0!==d&&void 0===costs[d])throw s=["Could not find a path from ",s," to ",d,"."].join(""),new Error(s);return predecessors},extract_shortest_path_from_predecessor_list:function(predecessors,d){for(var nodes=[],u=d;u;)nodes.push(u),predecessors[u],u=predecessors[u];return nodes.reverse(),nodes},find_path:function(graph,s,d){graph=dijkstra.single_source_shortest_paths(graph,s,d);return dijkstra.extract_shortest_path_from_predecessor_list(graph,d)},PriorityQueue:{make:function(opts){var key,T=dijkstra.PriorityQueue,t={};for(key in opts=opts||{},T)T.hasOwnProperty(key)&&(t[key]=T[key]);return t.queue=[],t.sorter=opts.sorter||T.default_sorter,t},default_sorter:function(a,b){return a.cost-b.cost},push:function(value,cost){this.queue.push({value:value,cost:cost}),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};void 0!==module&&(module.exports=dijkstra)},{}],6:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],7:[function(require,module,exports){var canPromise=require("./can-promise"),QRCode=require("./core/qrcode"),CanvasRenderer=require("./renderer/canvas"),SvgRenderer=require("./renderer/svg-tag.js");function renderCanvas(renderFunc,canvas,text,opts,cb){var args=[].slice.call(arguments,1),argsNum=args.length,args="function"==typeof args[argsNum-1];if(!args&&!canPromise())throw new Error("Callback required as last argument");if(!args){if(argsNum<1)throw new Error("Too few arguments provided");return 1===argsNum?(text=canvas,canvas=opts=void 0):2!==argsNum||canvas.getContext||(opts=text,text=canvas,canvas=void 0),new Promise(function(resolve,reject){try{var data=QRCode.create(text,opts);resolve(renderFunc(data,canvas,opts))}catch(e){reject(e)}})}if(argsNum<2)throw new Error("Too few arguments provided");2===argsNum?(cb=text,text=canvas,canvas=opts=void 0):3===argsNum&&(canvas.getContext&&void 0===cb?(cb=opts,opts=void 0):(cb=opts,opts=text,text=canvas,canvas=void 0));try{var data=QRCode.create(text,opts);cb(null,renderFunc(data,canvas,opts))}catch(e){cb(e)}}exports.create=QRCode.create,exports.toCanvas=renderCanvas.bind(null,CanvasRenderer.render),exports.toDataURL=renderCanvas.bind(null,CanvasRenderer.renderToDataURL),exports.toString=renderCanvas.bind(null,function(data,_,opts){return SvgRenderer.render(data,opts)})},{"./can-promise":8,"./core/qrcode":24,"./renderer/canvas":31,"./renderer/svg-tag.js":32}],8:[function(require,module,exports){module.exports=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}},{}],9:[function(require,module,exports){var getSymbolSize=require("./utils").getSymbolSize;exports.getRowColCoords=function(version){if(1===version)return[];for(var posCount=Math.floor(version/7)+2,version=getSymbolSize(version),intervals=145===version?26:2*Math.ceil((version-13)/(2*posCount-2)),positions=[version-7],i=1;i<posCount-1;i++)positions[i]=positions[i-1]-intervals;return positions.push(6),positions.reverse()},exports.getPositions=function(version){for(var coords=[],pos=exports.getRowColCoords(version),posLength=pos.length,i=0;i<posLength;i++)for(var j=0;j<posLength;j++)0===i&&0===j||0===i&&j===posLength-1||i===posLength-1&&0===j||coords.push([pos[i],pos[j]]);return coords}},{"./utils":28}],10:[function(require,module,exports){var Mode=require("./mode"),ALPHA_NUM_CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function AlphanumericData(data){this.mode=Mode.ALPHANUMERIC,this.data=data}AlphanumericData.getBitsLength=function(length){return 11*Math.floor(length/2)+length%2*6},AlphanumericData.prototype.getLength=function(){return this.data.length},AlphanumericData.prototype.getBitsLength=function(){return AlphanumericData.getBitsLength(this.data.length)},AlphanumericData.prototype.write=function(bitBuffer){for(var i=0;i+2<=this.data.length;i+=2){var value=45*ALPHA_NUM_CHARS.indexOf(this.data[i]);value+=ALPHA_NUM_CHARS.indexOf(this.data[i+1]),bitBuffer.put(value,11)}this.data.length%2&&bitBuffer.put(ALPHA_NUM_CHARS.indexOf(this.data[i]),6)},module.exports=AlphanumericData},{"./mode":21}],11:[function(require,module,exports){function BitBuffer(){this.buffer=[],this.length=0}BitBuffer.prototype={get:function(index){var bufIndex=Math.floor(index/8);return 1==(this.buffer[bufIndex]>>>7-index%8&1)},put:function(num,length){for(var i=0;i<length;i++)this.putBit(1==(num>>>length-i-1&1))},getLengthInBits:function(){return this.length},putBit:function(bit){var bufIndex=Math.floor(this.length/8);this.buffer.length<=bufIndex&&this.buffer.push(0),bit&&(this.buffer[bufIndex]|=128>>>this.length%8),this.length++}},module.exports=BitBuffer},{}],12:[function(require,module,exports){var BufferUtil=require("../utils/buffer");function BitMatrix(size){if(!size||size<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=size,this.data=BufferUtil.alloc(size*size),this.reservedBit=BufferUtil.alloc(size*size)}BitMatrix.prototype.set=function(row,col,value,reserved){row=row*this.size+col;this.data[row]=value,reserved&&(this.reservedBit[row]=!0)},BitMatrix.prototype.get=function(row,col){return this.data[row*this.size+col]},BitMatrix.prototype.xor=function(row,col,value){this.data[row*this.size+col]^=value},BitMatrix.prototype.isReserved=function(row,col){return this.reservedBit[row*this.size+col]},module.exports=BitMatrix},{"../utils/buffer":34}],13:[function(require,module,exports){var BufferUtil=require("../utils/buffer"),Mode=require("./mode");function ByteData(data){this.mode=Mode.BYTE,this.data=BufferUtil.from(data)}ByteData.getBitsLength=function(length){return 8*length},ByteData.prototype.getLength=function(){return this.data.length},ByteData.prototype.getBitsLength=function(){return ByteData.getBitsLength(this.data.length)},ByteData.prototype.write=function(bitBuffer){for(var i=0,l=this.data.length;i<l;i++)bitBuffer.put(this.data[i],8)},module.exports=ByteData},{"../utils/buffer":34,"./mode":21}],14:[function(require,module,exports){var ECLevel=require("./error-correction-level"),EC_BLOCKS_TABLE=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],EC_CODEWORDS_TABLE=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];exports.getBlocksCount=function(version,errorCorrectionLevel){switch(errorCorrectionLevel){case ECLevel.L:return EC_BLOCKS_TABLE[4*(version-1)+0];case ECLevel.M:return EC_BLOCKS_TABLE[4*(version-1)+1];case ECLevel.Q:return EC_BLOCKS_TABLE[4*(version-1)+2];case ECLevel.H:return EC_BLOCKS_TABLE[4*(version-1)+3];default:return}},exports.getTotalCodewordsCount=function(version,errorCorrectionLevel){switch(errorCorrectionLevel){case ECLevel.L:return EC_CODEWORDS_TABLE[4*(version-1)+0];case ECLevel.M:return EC_CODEWORDS_TABLE[4*(version-1)+1];case ECLevel.Q:return EC_CODEWORDS_TABLE[4*(version-1)+2];case ECLevel.H:return EC_CODEWORDS_TABLE[4*(version-1)+3];default:return}}},{"./error-correction-level":15}],15:[function(require,module,exports){exports.L={bit:1},exports.M={bit:0},exports.Q={bit:3},exports.H={bit:2},exports.isValid=function(level){return level&&void 0!==level.bit&&0<=level.bit&&level.bit<4},exports.from=function(value,defaultValue){if(exports.isValid(value))return value;try{var string=value;if("string"!=typeof string)throw new Error("Param is not a string");switch(string.toLowerCase()){case"l":case"low":return exports.L;case"m":case"medium":return exports.M;case"q":case"quartile":return exports.Q;case"h":case"high":return exports.H;default:throw new Error("Unknown EC Level: "+string)}}catch(e){return defaultValue}}},{}],16:[function(require,module,exports){var getSymbolSize=require("./utils").getSymbolSize;exports.getPositions=function(version){version=getSymbolSize(version);return[[0,0],[version-7,0],[0,version-7]]}},{"./utils":28}],17:[function(require,module,exports){var Utils=require("./utils"),G15_BCH=Utils.getBCHDigit(1335);exports.getEncodedBits=function(errorCorrectionLevel,mask){for(var errorCorrectionLevel=errorCorrectionLevel.bit<<3|mask,d=errorCorrectionLevel<<10;0<=Utils.getBCHDigit(d)-G15_BCH;)d^=1335<<Utils.getBCHDigit(d)-G15_BCH;return 21522^(errorCorrectionLevel<<10|d)}},{"./utils":28}],18:[function(require,module,exports){for(var require=require("../utils/buffer"),EXP_TABLE=require.alloc(512),LOG_TABLE=require.alloc(256),x=1,i=0;i<255;i++)EXP_TABLE[i]=x,LOG_TABLE[x]=i,256&(x<<=1)&&(x^=285);for(i=255;i<512;i++)EXP_TABLE[i]=EXP_TABLE[i-255];exports.log=function(n){if(n<1)throw new Error("log("+n+")");return LOG_TABLE[n]},exports.exp=function(n){return EXP_TABLE[n]},exports.mul=function(x,y){return 0===x||0===y?0:EXP_TABLE[LOG_TABLE[x]+LOG_TABLE[y]]}},{"../utils/buffer":34}],19:[function(require,module,exports){var Mode=require("./mode"),Utils=require("./utils");function KanjiData(data){this.mode=Mode.KANJI,this.data=data}KanjiData.getBitsLength=function(length){return 13*length},KanjiData.prototype.getLength=function(){return this.data.length},KanjiData.prototype.getBitsLength=function(){return KanjiData.getBitsLength(this.data.length)},KanjiData.prototype.write=function(bitBuffer){for(var i=0;i<this.data.length;i++){var value=Utils.toSJIS(this.data[i]);if(33088<=value&&value<=40956)value-=33088;else{if(!(57408<=value&&value<=60351))throw new Error("Invalid SJIS character: "+this.data[i]+"\nMake sure your charset is UTF-8");value-=49472}bitBuffer.put(value=192*(value>>>8&255)+(255&value),13)}},module.exports=KanjiData},{"./mode":21,"./utils":28}],20:[function(require,module,exports){exports.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var PenaltyScores_N1=3,PenaltyScores_N2=3,PenaltyScores_N3=40,PenaltyScores_N4=10;exports.isValid=function(mask){return null!=mask&&""!==mask&&!isNaN(mask)&&0<=mask&&mask<=7},exports.from=function(value){return exports.isValid(value)?parseInt(value,10):void 0},exports.getPenaltyN1=function(data){for(var size=data.size,points=0,sameCountCol=0,sameCountRow=0,lastCol=null,lastRow=null,row=0;row<size;row++){for(var sameCountCol=sameCountRow=0,lastCol=lastRow=null,col=0;col<size;col++){var module=data.get(row,col);module===lastCol?sameCountCol++:(5<=sameCountCol&&(points+=PenaltyScores_N1+(sameCountCol-5)),lastCol=module,sameCountCol=1),(module=data.get(col,row))===lastRow?sameCountRow++:(5<=sameCountRow&&(points+=PenaltyScores_N1+(sameCountRow-5)),lastRow=module,sameCountRow=1)}5<=sameCountCol&&(points+=PenaltyScores_N1+(sameCountCol-5)),5<=sameCountRow&&(points+=PenaltyScores_N1+(sameCountRow-5))}return points},exports.getPenaltyN2=function(data){for(var size=data.size,points=0,row=0;row<size-1;row++)for(var col=0;col<size-1;col++){var last=data.get(row,col)+data.get(row,col+1)+data.get(row+1,col)+data.get(row+1,col+1);4!==last&&0!==last||points++}return points*PenaltyScores_N2},exports.getPenaltyN3=function(data){for(var size=data.size,points=0,bitsCol=0,bitsRow=0,row=0;row<size;row++)for(var bitsCol=bitsRow=0,col=0;col<size;col++)bitsCol=bitsCol<<1&2047|data.get(row,col),10<=col&&(1488===bitsCol||93===bitsCol)&&points++,bitsRow=bitsRow<<1&2047|data.get(col,row),10<=col&&(1488===bitsRow||93===bitsRow)&&points++;return points*PenaltyScores_N3},exports.getPenaltyN4=function(data){for(var darkCount=0,modulesCount=data.data.length,i=0;i<modulesCount;i++)darkCount+=data.data[i];return Math.abs(Math.ceil(100*darkCount/modulesCount/5)-10)*PenaltyScores_N4},exports.applyMask=function(pattern,data){for(var size=data.size,col=0;col<size;col++)for(var row=0;row<size;row++)data.isReserved(row,col)||data.xor(row,col,function(maskPattern,i,j){switch(maskPattern){case exports.Patterns.PATTERN000:return(i+j)%2==0;case exports.Patterns.PATTERN001:return i%2==0;case exports.Patterns.PATTERN010:return j%3==0;case exports.Patterns.PATTERN011:return(i+j)%3==0;case exports.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(j/3))%2==0;case exports.Patterns.PATTERN101:return i*j%2+i*j%3==0;case exports.Patterns.PATTERN110:return(i*j%2+i*j%3)%2==0;case exports.Patterns.PATTERN111:return(i*j%3+(i+j)%2)%2==0;default:throw new Error("bad maskPattern:"+maskPattern)}}(pattern,row,col))},exports.getBestMask=function(data,setupFormatFunc){for(var numPatterns=Object.keys(exports.Patterns).length,bestPattern=0,lowerPenalty=1/0,p=0;p<numPatterns;p++){setupFormatFunc(p),exports.applyMask(p,data);var penalty=exports.getPenaltyN1(data)+exports.getPenaltyN2(data)+exports.getPenaltyN3(data)+exports.getPenaltyN4(data);exports.applyMask(p,data),penalty<lowerPenalty&&(lowerPenalty=penalty,bestPattern=p)}return bestPattern}},{}],21:[function(require,module,exports){var VersionCheck=require("./version-check"),Regex=require("./regex");exports.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},exports.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},exports.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},exports.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},exports.MIXED={bit:-1},exports.getCharCountIndicator=function(mode,version){if(!mode.ccBits)throw new Error("Invalid mode: "+mode);if(VersionCheck.isValid(version))return 1<=version&&version<10?mode.ccBits[0]:version<27?mode.ccBits[1]:mode.ccBits[2];throw new Error("Invalid version: "+version)},exports.getBestModeForData=function(dataStr){return Regex.testNumeric(dataStr)?exports.NUMERIC:Regex.testAlphanumeric(dataStr)?exports.ALPHANUMERIC:Regex.testKanji(dataStr)?exports.KANJI:exports.BYTE},exports.toString=function(mode){if(mode&&mode.id)return mode.id;throw new Error("Invalid mode")},exports.isValid=function(mode){return mode&&mode.bit&&mode.ccBits},exports.from=function(value,defaultValue){if(exports.isValid(value))return value;try{var string=value;if("string"!=typeof string)throw new Error("Param is not a string");switch(string.toLowerCase()){case"numeric":return exports.NUMERIC;case"alphanumeric":return exports.ALPHANUMERIC;case"kanji":return exports.KANJI;case"byte":return exports.BYTE;default:throw new Error("Unknown mode: "+string)}}catch(e){return defaultValue}}},{"./regex":26,"./version-check":29}],22:[function(require,module,exports){var Mode=require("./mode");function NumericData(data){this.mode=Mode.NUMERIC,this.data=data.toString()}NumericData.getBitsLength=function(length){return 10*Math.floor(length/3)+(length%3?length%3*3+1:0)},NumericData.prototype.getLength=function(){return this.data.length},NumericData.prototype.getBitsLength=function(){return NumericData.getBitsLength(this.data.length)},NumericData.prototype.write=function(bitBuffer){for(var group,value,i=0;i+3<=this.data.length;i+=3)group=this.data.substr(i,3),value=parseInt(group,10),bitBuffer.put(value,10);var remainingNum=this.data.length-i;0<remainingNum&&(group=this.data.substr(i),value=parseInt(group,10),bitBuffer.put(value,3*remainingNum+1))},module.exports=NumericData},{"./mode":21}],23:[function(require,module,exports){var BufferUtil=require("../utils/buffer"),GF=require("./galois-field");exports.mul=function(p1,p2){for(var coeff=BufferUtil.alloc(p1.length+p2.length-1),i=0;i<p1.length;i++)for(var j=0;j<p2.length;j++)coeff[i+j]^=GF.mul(p1[i],p2[j]);return coeff},exports.mod=function(divident,divisor){for(var result=BufferUtil.from(divident);0<=result.length-divisor.length;){for(var coeff=result[0],i=0;i<divisor.length;i++)result[i]^=GF.mul(divisor[i],coeff);for(var offset=0;offset<result.length&&0===result[offset];)offset++;result=result.slice(offset)}return result},exports.generateECPolynomial=function(degree){for(var poly=BufferUtil.from([1]),i=0;i<degree;i++)poly=exports.mul(poly,[1,GF.exp(i)]);return poly}},{"../utils/buffer":34,"./galois-field":18}],24:[function(require,module,exports){var BufferUtil=require("../utils/buffer"),Utils=require("./utils"),ECLevel=require("./error-correction-level"),BitBuffer=require("./bit-buffer"),BitMatrix=require("./bit-matrix"),AlignmentPattern=require("./alignment-pattern"),FinderPattern=require("./finder-pattern"),MaskPattern=require("./mask-pattern"),ECCode=require("./error-correction-code"),ReedSolomonEncoder=require("./reed-solomon-encoder"),Version=require("./version"),FormatInfo=require("./format-info"),Mode=require("./mode"),Segments=require("./segments"),isArray=require("isarray");function setupFormatInfo(matrix,errorCorrectionLevel,maskPattern){for(var mod,size=matrix.size,bits=FormatInfo.getEncodedBits(errorCorrectionLevel,maskPattern),i=0;i<15;i++)mod=1==(bits>>i&1),i<6?matrix.set(i,8,mod,!0):i<8?matrix.set(i+1,8,mod,!0):matrix.set(size-15+i,8,mod,!0),i<8?matrix.set(8,size-i-1,mod,!0):i<9?matrix.set(8,15-i-1+1,mod,!0):matrix.set(8,15-i-1,mod,!0);matrix.set(size-8,8,1,!0)}function createData(version,errorCorrectionLevel,segments){var buffer=new BitBuffer;segments.forEach(function(data){buffer.put(data.mode.bit,4),buffer.put(data.getLength(),Mode.getCharCountIndicator(data.mode,version)),data.write(buffer)});segments=8*(Utils.getSymbolTotalCodewords(version)-ECCode.getTotalCodewordsCount(version,errorCorrectionLevel));for(buffer.getLengthInBits()+4<=segments&&buffer.put(0,4);buffer.getLengthInBits()%8!=0;)buffer.putBit(0);for(var remainingByte=(segments-buffer.getLengthInBits())/8,i=0;i<remainingByte;i++)buffer.put(i%2?17:236,8);return function(bitBuffer,version,errorCorrectionLevel){for(var totalCodewords=Utils.getSymbolTotalCodewords(version),ecTotalCodewords=ECCode.getTotalCodewordsCount(version,errorCorrectionLevel),ecTotalCodewords=totalCodewords-ecTotalCodewords,ecTotalBlocks=ECCode.getBlocksCount(version,errorCorrectionLevel),blocksInGroup1=ecTotalBlocks-totalCodewords%ecTotalBlocks,version=Math.floor(totalCodewords/ecTotalBlocks),dataCodewordsInGroup1=Math.floor(ecTotalCodewords/ecTotalBlocks),dataCodewordsInGroup2=dataCodewordsInGroup1+1,ecCount=version-dataCodewordsInGroup1,rs=new ReedSolomonEncoder(ecCount),offset=0,dcData=new Array(ecTotalBlocks),ecData=new Array(ecTotalBlocks),maxDataSize=0,buffer=BufferUtil.from(bitBuffer.buffer),b=0;b<ecTotalBlocks;b++){var dataSize=b<blocksInGroup1?dataCodewordsInGroup1:dataCodewordsInGroup2;dcData[b]=buffer.slice(offset,offset+dataSize),ecData[b]=rs.encode(dcData[b]),offset+=dataSize,maxDataSize=Math.max(maxDataSize,dataSize)}var i,r,data=BufferUtil.alloc(totalCodewords),index=0;for(i=0;i<maxDataSize;i++)for(r=0;r<ecTotalBlocks;r++)i<dcData[r].length&&(data[index++]=dcData[r][i]);for(i=0;i<ecCount;i++)for(r=0;r<ecTotalBlocks;r++)data[index++]=ecData[r][i];return data}(buffer,version,errorCorrectionLevel)}function createSymbol(data,version,errorCorrectionLevel,maskPattern){var segments;if(isArray(data))segments=Segments.fromArray(data);else{if("string"!=typeof data)throw new Error("Invalid data");var estimatedVersion=version;estimatedVersion||(rawSegments=Segments.rawSplit(data),estimatedVersion=Version.getBestVersionForData(rawSegments,errorCorrectionLevel)),segments=Segments.fromString(data,estimatedVersion||40)}var rawSegments=Version.getBestVersionForData(segments,errorCorrectionLevel);if(!rawSegments)throw new Error("The amount of data is too big to be stored in a QR Code");if(version){if(version<rawSegments)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+rawSegments+".\n")}else version=rawSegments;for(var data=createData(version,errorCorrectionLevel,segments),estimatedVersion=Utils.getSymbolSize(version),rawSegments=new BitMatrix(estimatedVersion),matrix=(!function(matrix,version){for(var size=matrix.size,pos=FinderPattern.getPositions(version),i=0;i<pos.length;i++)for(var row=pos[i][0],col=pos[i][1],r=-1;r<=7;r++)if(!(row+r<=-1||size<=row+r))for(var c=-1;c<=7;c++)col+c<=-1||size<=col+c||(0<=r&&r<=6&&(0===c||6===c)||0<=c&&c<=6&&(0===r||6===r)||2<=r&&r<=4&&2<=c&&c<=4?matrix.set(row+r,col+c,!0,!0):matrix.set(row+r,col+c,!1,!0))}(rawSegments,version),rawSegments),size=matrix.size,r=8;r<size-8;r++){var value=r%2==0;matrix.set(r,6,value,!0),matrix.set(6,r,value,!0)}return function(matrix,version){for(var pos=AlignmentPattern.getPositions(version),i=0;i<pos.length;i++)for(var row=pos[i][0],col=pos[i][1],r=-2;r<=2;r++)for(var c=-2;c<=2;c++)-2===r||2===r||-2===c||2===c||0===r&&0===c?matrix.set(row+r,col+c,!0,!0):matrix.set(row+r,col+c,!1,!0)}(rawSegments,version),setupFormatInfo(rawSegments,errorCorrectionLevel,0),7<=version&&function(matrix,version){for(var row,col,mod,size=matrix.size,bits=Version.getEncodedBits(version),i=0;i<18;i++)row=Math.floor(i/3),matrix.set(row,col=i%3+size-8-3,mod=1==(bits>>i&1),!0),matrix.set(col,row,mod,!0)}(rawSegments,version),function(matrix,data){for(var size=matrix.size,inc=-1,row=size-1,bitIndex=7,byteIndex=0,col=size-1;0<col;col-=2)for(6===col&&col--;;){for(var dark,c=0;c<2;c++)matrix.isReserved(row,col-c)||(dark=!1,byteIndex<data.length&&(dark=1==(data[byteIndex]>>>bitIndex&1)),matrix.set(row,col-c,dark),-1===--bitIndex&&(byteIndex++,bitIndex=7));if((row+=inc)<0||size<=row){row-=inc,inc=-inc;break}}}(rawSegments,data),isNaN(maskPattern)&&(maskPattern=MaskPattern.getBestMask(rawSegments,setupFormatInfo.bind(null,rawSegments,errorCorrectionLevel))),MaskPattern.applyMask(maskPattern,rawSegments),setupFormatInfo(rawSegments,errorCorrectionLevel,maskPattern),{modules:rawSegments,version:version,errorCorrectionLevel:errorCorrectionLevel,maskPattern:maskPattern,segments:segments}}exports.create=function(data,options){if(void 0===data||""===data)throw new Error("No input text");var version,mask,errorCorrectionLevel=ECLevel.M;return void 0!==options&&(errorCorrectionLevel=ECLevel.from(options.errorCorrectionLevel,ECLevel.M),version=Version.from(options.version),mask=MaskPattern.from(options.maskPattern),options.toSJISFunc)&&Utils.setToSJISFunction(options.toSJISFunc),createSymbol(data,version,errorCorrectionLevel,mask)}},{"../utils/buffer":34,"./alignment-pattern":9,"./bit-buffer":11,"./bit-matrix":12,"./error-correction-code":14,"./error-correction-level":15,"./finder-pattern":16,"./format-info":17,"./mask-pattern":20,"./mode":21,"./reed-solomon-encoder":25,"./segments":27,"./utils":28,"./version":30,isarray:6}],25:[function(require,module,exports){var BufferUtil=require("../utils/buffer"),Polynomial=require("./polynomial"),Buffer=require("buffer").Buffer;function ReedSolomonEncoder(degree){this.genPoly=void 0,this.degree=degree,this.degree&&this.initialize(this.degree)}ReedSolomonEncoder.prototype.initialize=function(degree){this.degree=degree,this.genPoly=Polynomial.generateECPolynomial(this.degree)},ReedSolomonEncoder.prototype.encode=function(data){var pad,buff;if(this.genPoly)return pad=BufferUtil.alloc(this.degree),pad=Buffer.concat([data,pad],data.length+this.degree),data=Polynomial.mod(pad,this.genPoly),0<(pad=this.degree-data.length)?(buff=BufferUtil.alloc(this.degree),data.copy(buff,pad),buff):data;throw new Error("Encoder not initialized")},module.exports=ReedSolomonEncoder},{"../utils/buffer":34,"./polynomial":23,buffer:2}],26:[function(require,module,exports){var kanji="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+",byte="(?:(?![A-Z0-9 $%*+\\-./:]|"+(kanji=kanji.replace(/u/g,"\\u"))+")(?:.|[\r\n]))+",TEST_KANJI=(exports.KANJI=new RegExp(kanji,"g"),exports.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),exports.BYTE=new RegExp(byte,"g"),exports.NUMERIC=new RegExp("[0-9]+","g"),exports.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g"),new RegExp("^"+kanji+"$")),TEST_NUMERIC=new RegExp("^[0-9]+$"),TEST_ALPHANUMERIC=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");exports.testKanji=function(str){return TEST_KANJI.test(str)},exports.testNumeric=function(str){return TEST_NUMERIC.test(str)},exports.testAlphanumeric=function(str){return TEST_ALPHANUMERIC.test(str)}},{}],27:[function(require,module,exports){var Mode=require("./mode"),NumericData=require("./numeric-data"),AlphanumericData=require("./alphanumeric-data"),ByteData=require("./byte-data"),KanjiData=require("./kanji-data"),Regex=require("./regex"),Utils=require("./utils"),dijkstra=require("dijkstrajs");function getStringByteLength(str){return unescape(encodeURIComponent(str)).length}function getSegments(regex,mode,str){for(var result,segments=[];null!==(result=regex.exec(str));)segments.push({data:result[0],index:result.index,mode:mode,length:result[0].length});return segments}function getSegmentsFromString(dataStr){var byteSegs,numSegs=getSegments(Regex.NUMERIC,Mode.NUMERIC,dataStr),alphaNumSegs=getSegments(Regex.ALPHANUMERIC,Mode.ALPHANUMERIC,dataStr),dataStr=Utils.isKanjiModeEnabled()?(byteSegs=getSegments(Regex.BYTE,Mode.BYTE,dataStr),getSegments(Regex.KANJI,Mode.KANJI,dataStr)):(byteSegs=getSegments(Regex.BYTE_KANJI,Mode.BYTE,dataStr),[]);return numSegs.concat(alphaNumSegs,byteSegs,dataStr).sort(function(s1,s2){return s1.index-s2.index}).map(function(obj){return{data:obj.data,mode:obj.mode,length:obj.length}})}function getSegmentBitsLength(length,mode){switch(mode){case Mode.NUMERIC:return NumericData.getBitsLength(length);case Mode.ALPHANUMERIC:return AlphanumericData.getBitsLength(length);case Mode.KANJI:return KanjiData.getBitsLength(length);case Mode.BYTE:return ByteData.getBitsLength(length)}}function buildSingleSegment(data,modesHint){var bestMode=Mode.getBestModeForData(data),modesHint=Mode.from(modesHint,bestMode);if(modesHint!==Mode.BYTE&&modesHint.bit<bestMode.bit)throw new Error('"'+data+'" cannot be encoded with mode '+Mode.toString(modesHint)+".\n Suggested mode is: "+Mode.toString(bestMode));switch(modesHint=modesHint!==Mode.KANJI||Utils.isKanjiModeEnabled()?modesHint:Mode.BYTE){case Mode.NUMERIC:return new NumericData(data);case Mode.ALPHANUMERIC:return new AlphanumericData(data);case Mode.KANJI:return new KanjiData(data);case Mode.BYTE:return new ByteData(data)}}exports.fromArray=function(array){return array.reduce(function(acc,seg){return"string"==typeof seg?acc.push(buildSingleSegment(seg,null)):seg.data&&acc.push(buildSingleSegment(seg.data,seg.mode)),acc},[])},exports.fromString=function(data,version){for(var graph=function(nodes,version){for(var table={},graph={start:{}},prevNodeIds=["start"],i=0;i<nodes.length;i++){for(var nodeGroup=nodes[i],currentNodeIds=[],j=0;j<nodeGroup.length;j++){var node=nodeGroup[j],key=""+i+j;currentNodeIds.push(key),table[key]={node:node,lastCount:0},graph[key]={};for(var n=0;n<prevNodeIds.length;n++){var prevNodeId=prevNodeIds[n];table[prevNodeId]&&table[prevNodeId].node.mode===node.mode?(graph[prevNodeId][key]=getSegmentBitsLength(table[prevNodeId].lastCount+node.length,node.mode)-getSegmentBitsLength(table[prevNodeId].lastCount,node.mode),table[prevNodeId].lastCount+=node.length):(table[prevNodeId]&&(table[prevNodeId].lastCount=node.length),graph[prevNodeId][key]=getSegmentBitsLength(node.length,node.mode)+4+Mode.getCharCountIndicator(node.mode,version))}}prevNodeIds=currentNodeIds}for(n=0;n<prevNodeIds.length;n++)graph[prevNodeIds[n]].end=0;return{map:graph,table:table}}(function(segs){for(var nodes=[],i=0;i<segs.length;i++){var seg=segs[i];switch(seg.mode){case Mode.NUMERIC:nodes.push([seg,{data:seg.data,mode:Mode.ALPHANUMERIC,length:seg.length},{data:seg.data,mode:Mode.BYTE,length:seg.length}]);break;case Mode.ALPHANUMERIC:nodes.push([seg,{data:seg.data,mode:Mode.BYTE,length:seg.length}]);break;case Mode.KANJI:nodes.push([seg,{data:seg.data,mode:Mode.BYTE,length:getStringByteLength(seg.data)}]);break;case Mode.BYTE:nodes.push([{data:seg.data,mode:Mode.BYTE,length:getStringByteLength(seg.data)}])}}return nodes}(getSegmentsFromString(data,Utils.isKanjiModeEnabled())),version),path=dijkstra.find_path(graph.map,"start","end"),optimizedSegs=[],i=1;i<path.length-1;i++)optimizedSegs.push(graph.table[path[i]].node);return exports.fromArray(function(segs){return segs.reduce(function(acc,curr){var prevSeg=0<=acc.length-1?acc[acc.length-1]:null;return prevSeg&&prevSeg.mode===curr.mode?acc[acc.length-1].data+=curr.data:acc.push(curr),acc},[])}(optimizedSegs))},exports.rawSplit=function(data){return exports.fromArray(getSegmentsFromString(data,Utils.isKanjiModeEnabled()))}},{"./alphanumeric-data":10,"./byte-data":13,"./kanji-data":19,"./mode":21,"./numeric-data":22,"./regex":26,"./utils":28,dijkstrajs:5}],28:[function(require,module,exports){var toSJISFunction,CODEWORDS_COUNT=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];exports.getSymbolSize=function(version){if(!version)throw new Error('"version" cannot be null or undefined');if(version<1||40<version)throw new Error('"version" should be in range from 1 to 40');return 4*version+17},exports.getSymbolTotalCodewords=function(version){return CODEWORDS_COUNT[version]},exports.getBCHDigit=function(data){for(var digit=0;0!==data;)digit++,data>>>=1;return digit},exports.setToSJISFunction=function(f){if("function"!=typeof f)throw new Error('"toSJISFunc" is not a valid function.');toSJISFunction=f},exports.isKanjiModeEnabled=function(){return void 0!==toSJISFunction},exports.toSJIS=function(kanji){return toSJISFunction(kanji)}},{}],29:[function(require,module,exports){exports.isValid=function(version){return!isNaN(version)&&1<=version&&version<=40}},{}],30:[function(require,module,exports){var Utils=require("./utils"),ECCode=require("./error-correction-code"),ECLevel=require("./error-correction-level"),Mode=require("./mode"),VersionCheck=require("./version-check"),isArray=require("isarray"),G18_BCH=Utils.getBCHDigit(7973);function getReservedBitsCount(mode,version){return Mode.getCharCountIndicator(mode,version)+4}function getBestVersionForMixedData(segments,errorCorrectionLevel){for(var currentVersion=1;currentVersion<=40;currentVersion++)if(function(segments,version){var totalBits=0;return segments.forEach(function(data){var reservedBits=getReservedBitsCount(data.mode,version);totalBits+=reservedBits+data.getBitsLength()}),totalBits}(segments,currentVersion)<=exports.getCapacity(currentVersion,errorCorrectionLevel,Mode.MIXED))return currentVersion}exports.from=function(value,defaultValue){return VersionCheck.isValid(value)?parseInt(value,10):defaultValue},exports.getCapacity=function(version,errorCorrectionLevel,mode){if(!VersionCheck.isValid(version))throw new Error("Invalid QR Code version");void 0===mode&&(mode=Mode.BYTE);errorCorrectionLevel=8*(Utils.getSymbolTotalCodewords(version)-ECCode.getTotalCodewordsCount(version,errorCorrectionLevel));if(mode===Mode.MIXED)return errorCorrectionLevel;var usableBits=errorCorrectionLevel-getReservedBitsCount(mode,version);switch(mode){case Mode.NUMERIC:return Math.floor(usableBits/10*3);case Mode.ALPHANUMERIC:return Math.floor(usableBits/11*2);case Mode.KANJI:return Math.floor(usableBits/13);default:Mode.BYTE;return Math.floor(usableBits/8)}},exports.getBestVersionForData=function(data,errorCorrectionLevel){var seg,errorCorrectionLevel=ECLevel.from(errorCorrectionLevel,ECLevel.M);if(isArray(data)){if(1<data.length)return getBestVersionForMixedData(data,errorCorrectionLevel);if(0===data.length)return 1;seg=data[0]}else seg=data;return function(mode,length,errorCorrectionLevel){for(var currentVersion=1;currentVersion<=40;currentVersion++)if(length<=exports.getCapacity(currentVersion,errorCorrectionLevel,mode))return currentVersion}(seg.mode,seg.getLength(),errorCorrectionLevel)},exports.getEncodedBits=function(version){if(!VersionCheck.isValid(version)||version<7)throw new Error("Invalid QR Code version");for(var d=version<<12;0<=Utils.getBCHDigit(d)-G18_BCH;)d^=7973<<Utils.getBCHDigit(d)-G18_BCH;return version<<12|d}},{"./error-correction-code":14,"./error-correction-level":15,"./mode":21,"./utils":28,"./version-check":29,isarray:6}],31:[function(require,module,exports){var Utils=require("./utils");exports.render=function(qrData,canvas,options){var canvasEl=canvas,canvas=(void 0!==options||canvas&&canvas.getContext||(options=canvas,canvas=void 0),canvas||(canvasEl=function(){try{return document.createElement("canvas")}catch(e){throw new Error("You need to specify a canvas element")}}()),options=Utils.getOptions(options),Utils.getImageWidth(qrData.modules.size,options)),ctx=canvasEl.getContext("2d"),image=ctx.createImageData(canvas,canvas);return Utils.qrToImageData(image.data,qrData,options),function(ctx,canvas,size){ctx.clearRect(0,0,canvas.width,canvas.height),canvas.style||(canvas.style={}),canvas.height=size,canvas.width=size,canvas.style.height=size+"px",canvas.style.width=size+"px"}(ctx,canvasEl,canvas),ctx.putImageData(image,0,0),canvasEl},exports.renderToDataURL=function(qrData,canvas,options){void 0!==options||canvas&&canvas.getContext||(options=canvas,canvas=void 0),qrData=exports.render(qrData,canvas,options=options||{}),canvas=options.type||"image/png",options=options.rendererOpts||{};return qrData.toDataURL(canvas,options.quality)}},{"./utils":33}],32:[function(require,module,exports){var Utils=require("./utils");function getColorAttrib(color,attrib){var alpha=color.a/255,color=attrib+'="'+color.hex+'"';return alpha<1?color+" "+attrib+'-opacity="'+alpha.toFixed(2).slice(1)+'"':color}function svgCmd(cmd,x,y){cmd+=x;return void 0!==y&&(cmd+=" "+y),cmd}exports.render=function(qrData,options,cb){var options=Utils.getOptions(options),size=qrData.modules.size,qrData=qrData.modules.data,qrcodesize=size+2*options.margin,bg=options.color.light.a?"<path "+getColorAttrib(options.color.light,"fill")+' d="M0 0h'+qrcodesize+"v"+qrcodesize+'H0z"/>':"",qrData="<path "+getColorAttrib(options.color.dark,"stroke")+' d="'+function(data,size,margin){for(var path="",moveBy=0,newRow=!1,lineLength=0,i=0;i<data.length;i++){var col=Math.floor(i%size),row=Math.floor(i/size);col||(newRow=newRow||!0),data[i]?(lineLength++,0<i&&0<col&&data[i-1]||(path+=newRow?svgCmd("M",col+margin,.5+row+margin):svgCmd("m",moveBy,0),moveBy=0,newRow=!1),col+1<size&&data[i+1]||(path+=svgCmd("h",lineLength),lineLength=0)):moveBy++}return path}(qrData,size,options.margin)+'"/>',size='<svg xmlns="http://www.w3.org/2000/svg" '+(options.width?'width="'+options.width+'" height="'+options.width+'" ':"")+('viewBox="0 0 '+qrcodesize+" "+qrcodesize+'"')+' shape-rendering="crispEdges">'+bg+qrData+"</svg>\n";return"function"==typeof cb&&cb(null,size),size}},{"./utils":33}],33:[function(require,module,exports){function hex2rgba(hex){if("string"!=typeof(hex="number"==typeof hex?hex.toString():hex))throw new Error("Color should be defined as hex string");var hexCode=hex.slice().replace("#","").split("");if(hexCode.length<3||5===hexCode.length||8<hexCode.length)throw new Error("Invalid hex color: "+hex);6===(hexCode=3!==hexCode.length&&4!==hexCode.length?hexCode:Array.prototype.concat.apply([],hexCode.map(function(c){return[c,c]}))).length&&hexCode.push("F","F");hex=parseInt(hexCode.join(""),16);return{r:hex>>24&255,g:hex>>16&255,b:hex>>8&255,a:255&hex,hex:"#"+hexCode.slice(0,6).join("")}}exports.getOptions=function(options){(options=options||{}).color||(options.color={});var margin=void 0===options.margin||null===options.margin||options.margin<0?4:options.margin,width=options.width&&21<=options.width?options.width:void 0,scale=options.scale||4;return{width:width,scale:width?4:scale,margin:margin,color:{dark:hex2rgba(options.color.dark||"#000000ff"),light:hex2rgba(options.color.light||"#ffffffff")},type:options.type,rendererOpts:options.rendererOpts||{}}},exports.getScale=function(qrSize,opts){return opts.width&&opts.width>=qrSize+2*opts.margin?opts.width/(qrSize+2*opts.margin):opts.scale},exports.getImageWidth=function(qrSize,opts){var scale=exports.getScale(qrSize,opts);return Math.floor((qrSize+2*opts.margin)*scale)},exports.qrToImageData=function(imgData,qr,opts){for(var size=qr.modules.size,data=qr.modules.data,scale=exports.getScale(size,opts),symbolSize=Math.floor((size+2*opts.margin)*scale),scaledMargin=opts.margin*scale,palette=[opts.color.light,opts.color.dark],i=0;i<symbolSize;i++)for(var j=0;j<symbolSize;j++){var posDst=4*(i*symbolSize+j),pxColor=opts.color.light;scaledMargin<=i&&scaledMargin<=j&&i<symbolSize-scaledMargin&&j<symbolSize-scaledMargin&&(pxColor=palette[data[Math.floor((i-scaledMargin)/scale)*size+Math.floor((j-scaledMargin)/scale)]?1:0]),imgData[posDst++]=pxColor.r,imgData[posDst++]=pxColor.g,imgData[posDst++]=pxColor.b,imgData[posDst]=pxColor.a}}},{}],34:[function(require,module,exports){!function(Buffer){!function(){"use strict";var isArray=require("isarray");var K_MAX_LENGTH=(Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}())?2147483647:1073741823;function Buffer(arg,offset,length){return Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer?"number"==typeof arg?allocUnsafe(this,arg):function(that,value,offset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer)return function(that,array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);Buffer.TYPED_ARRAY_SUPPORT?array.__proto__=Buffer.prototype:array=fromArrayLike(that,array);return array}(that,value,offset,length);return("string"!=typeof value?function(that,obj){{var len,buf;if(Buffer.isBuffer(obj))return len=0|checked(obj.length),0!==(buf=createBuffer(that,len)).length&&obj.copy(buf,0,0,len),buf}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||function(val){return val!=val}(obj.length)?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(that,obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}:function(that,string){var length=0|byteLength(string),that=createBuffer(that,length),string=that.write(string);string!==length&&(that=that.slice(0,string));return that})(that,value)}(this,arg,offset,length):new Buffer(arg,offset,length)}function checked(length){if(K_MAX_LENGTH<=length)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function createBuffer(that,length){var buf;return Buffer.TYPED_ARRAY_SUPPORT?(buf=new Uint8Array(length)).__proto__=Buffer.prototype:(buf=null===(buf=that)?new Buffer(length):buf).length=length,buf}function allocUnsafe(that,size){var buf=createBuffer(that,size<0?0:0|checked(size));if(!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)buf[i]=0;return buf}function fromArrayLike(that,array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(that,length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(55295<(codePoint=string.charCodeAt(i))&&codePoint<57344){if(!leadSurrogate){if(56319<codePoint){-1<(units-=3)&&bytes.push(239,191,189);continue}if(i+1===length){-1<(units-=3)&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){-1<(units-=3)&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&-1<(units-=3)&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if(--units<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function byteLength(string){return Buffer.isBuffer(string)?string.length:"undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)?string.byteLength:0===(string="string"!=typeof string?""+string:string).length?0:utf8ToBytes(string).length}function utf8Write(buf,string,offset,length){return function(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}(utf8ToBytes(string,buf.length-offset),buf,offset,length)}Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol)&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.prototype.write=function(string,offset,length){void 0===offset||void 0===length&&"string"==typeof offset?(length=this.length,offset=0):isFinite(offset)&&(offset|=0,isFinite(length)?length|=0:length=void 0);var remaining=this.length-offset;if((void 0===length||remaining<length)&&(length=remaining),0<string.length&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");return utf8Write(this,string,offset,length)},Buffer.prototype.slice=function(start,end){var len=this.length;if((start=~~start)<0?(start+=len)<0&&(start=0):len<start&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):len<end&&(end=len),end<start&&(end=start),Buffer.TYPED_ARRAY_SUPPORT)(newBuf=this.subarray(start,end)).__proto__=Buffer.prototype;else for(var sliceLen=end-start,newBuf=new Buffer(sliceLen,void 0),i=0;i<sliceLen;++i)newBuf[i]=this[i+start];return newBuf},Buffer.prototype.copy=function(target,targetStart,start,end){if(start=start||0,end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),(end=0<end&&end<start?start:end)===start)return 0;if(0===target.length||0===this.length)return 0;if((targetStart=targetStart||0)<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length);var i,len=(end=target.length-targetStart<end-start?target.length-targetStart+start:end)-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;0<=i;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end){var code;if("string"==typeof val?("string"==typeof start?(start=0,end=this.length):"string"==typeof end&&(end=this.length),1===val.length&&(code=val.charCodeAt(0))<256&&(val=code)):"number"==typeof val&&(val&=255),start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(!(end<=start))if(start>>>=0,end=void 0===end?this.length:end>>>0,"number"==typeof(val=val||0))for(i=start;i<end;++i)this[i]=val;else for(var bytes=Buffer.isBuffer(val)?val:new Buffer(val),len=bytes.length,i=0;i<end-start;++i)this[i+start]=bytes[i%len];return this},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return createBuffer(null,0);if(void 0===length)for(i=length=0;i<list.length;++i)length+=list[i].length;for(var buffer=allocUnsafe(null,length),pos=0,i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},module.exports.alloc=function(size){size=new Buffer(size);return size.fill(0),size},module.exports.from=function(data){return new Buffer(data)}}.call(this)}.call(this,require("buffer").Buffer)},{buffer:2,isarray:6}],35:[function(require,module,exports){"use strict";const objpacker=require("./objpacker");const unitStructNames=["classInstance","x","y","unitID","relation","validFlags","validProps","player","hp","sp","energy","resources","hangar","stateFlags","relationCI"],unitStateBits=["cloak","burrow","transit","hallucinated","invincible"],validPropBits=["owner","hp","shield","energy","resource","hangar"],relationBits=["_0","_1","_2","_3","_4","_5","_6","_7","_8","nydus","addon"];function unpackUnit(buffer){buffer=objpacker.unpack("<I6H4BIHHI",unitStructNames,buffer);return buffer.validFlags=objpacker.unpackFlags(buffer.validFlags,unitStateBits),buffer.validProps=objpacker.unpackFlags(buffer.validProps,validPropBits),buffer.relation=objpacker.unpackFlags(buffer.relation,relationBits,!0),buffer.stateFlags=objpacker.unpackFlags(buffer.stateFlags,unitStateBits),buffer}function packUnit(obj){let objToPack={};return unitStructNames.forEach(key=>{switch(key){case"relation":objToPack[key]=objpacker.packFlags(obj[key],relationBits);break;case"validFlags":case"stateFlags":objToPack[key]=objpacker.packFlags(obj[key],unitStateBits);break;case"validProps":objToPack[key]=objpacker.packFlags(obj[key],validPropBits);break;default:objToPack[key]=obj[key]}}),objpacker.pack("<I6H4BIHHI",unitStructNames,objToPack)}module.exports={packUnit:packUnit,unpackUnit:unpackUnit,packAllUnits:function(units){let buffer=new Uint8Array(36*units.length);return units.map(packUnit).forEach((buf,i)=>{buffer.set(buf,36*i)}),buffer},unpackAllUnits:function(buffer){var out=[];for(let i=0;i<buffer.length;i+=36)out.push(unpackUnit(buffer.slice(i,i+36)));return out},packTile:function(arrayInput){let array;return array=0<arrayInput[0].length?arrayInput.reduce((t,a)=>t.concat(a),[]):arrayInput,arrayInput=new Uint16Array(array),new Uint8Array(arrayInput.buffer)},unpackTile:function(buffer,tileSize){if(tileSize){var[w,h]=tileSize,retArray=new Uint16Array(w*h),tileSize=new Uint16Array(buffer.buffer||buffer,buffer.byteOffset||0,(buffer.byteLength||buffer.length)>>1),a=(retArray.set(tileSize.slice(0,w*h)),[]);for(let i=0;i<h;i++)a.push(Array.from(retArray.slice(i*w,(i+1)*w)));return a}return tileSize=new Uint16Array(buffer.buffer||buffer,buffer.byteOffset||0,(buffer.byteLength||buffer.length)>>1),Array.from(tileSize)},packDim:function(obj){return objpacker.pack("<HH",["width","height"],obj)},unpackDim:function(buffer){return objpacker.unpack("<HH",["width","height"],buffer)}}},{"./objpacker":42}],36:[function(require,module,exports){"use strict";module.exports.findChunk=function(array,head,validationFunc=()=>!0){var b=[head.charCodeAt(0),head.charCodeAt(1),head.charCodeAt(2),head.charCodeAt(3)];let found=-1;for(let i=0;i<array.length;i++)if(array[i]==b[0]&&array[i+1]==b[1]&&array[i+2]==b[2]&&array[i+3]==b[3]){var cl=array[i+4]+(array[i+5]<<8)+(array[i+6]<<16)+(array[i+7]<<24);if(validationFunc(cl,array.slice(i+8,i+cl+8))){found=i;break}}return-1==found?null:(head=array[found+4]+(array[found+5]<<8)+(array[found+6]<<16)+(array[found+7]<<24),{chunkPosition:found,chunkLength:head,chunkLengthTotal:head+8,data:array.slice(found+8,found+head+8)})},module.exports.replaceChunk=function(arrayInput,head,newDataBuffer,validationFunc=()=>!0){var array=arrayInput.concat?arrayInput:Array.from(arrayInput),b=[head.charCodeAt(0),head.charCodeAt(1),head.charCodeAt(2),head.charCodeAt(3)],arrayInput=Array.from(newDataBuffer);let found=-1;for(let i=0;i<array.length;i++)if(array[i]==b[0]&&array[i+1]==b[1]&&array[i+2]==b[2]&&array[i+3]==b[3]){var cl=array[i+4]+(array[i+5]<<8)+(array[i+6]<<16)+(array[i+7]<<24);if(validationFunc(cl,array.slice(i+8,i+cl+8))){found=i;break}}return-1==found?null:(head=array[found+4]+(array[found+5]<<8)+(array[found+6]<<16)+(array[found+7]<<24),newDataBuffer=array.slice(0,found).concat(b).concat([255&(newDataBuffer=arrayInput.length),newDataBuffer>>>8&255,newDataBuffer>>>16&255,newDataBuffer>>>24&255]).concat(arrayInput).concat(array.slice(found+head+8)),new Uint8Array(newDataBuffer))}},{}],37:[function(require,module,exports){"use strict";const _excluded=["precision","format","inGamut"],_excluded2=["space"],_excluded4=["method"];function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,target=function(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],0<=excluded.indexOf(key)||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols)for(var sourceSymbolKeys=Object.getOwnPropertySymbols(source),i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],0<=excluded.indexOf(key)||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key]);return target}function ownKeys(object,enumerableOnly){var symbols,keys=Object.keys(object);return Object.getOwnPropertySymbols&&(symbols=Object.getOwnPropertySymbols(object),enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)),keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}function _classPrivateFieldInitSpec(obj,privateMap,value){_checkPrivateRedeclaration(obj,privateMap),privateMap.set(obj,value)}function _classPrivateMethodInitSpec(obj,privateSet){_checkPrivateRedeclaration(obj,privateSet),privateSet.add(obj)}function _checkPrivateRedeclaration(obj,privateCollection){if(privateCollection.has(obj))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateFieldGet(receiver,privateMap){return function(receiver,descriptor){if(descriptor.get)return descriptor.get.call(receiver);return descriptor.value}(receiver,_classExtractFieldDescriptor(receiver,privateMap,"get"))}function _classPrivateMethodGet(receiver,privateSet,fn){if(privateSet.has(receiver))return fn;throw new TypeError("attempted to get private field on non-instance")}function _classPrivateFieldSet(receiver,privateMap,value){!function(receiver,descriptor,value){if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(receiver,_classExtractFieldDescriptor(receiver,privateMap,"set"),value)}function _classExtractFieldDescriptor(receiver,privateMap,action){if(privateMap.has(receiver))return privateMap.get(receiver);throw new TypeError("attempted to "+action+" private field on non-instance")}function multiplyMatrices(A,B){var m=A.length,p=(Array.isArray(A[0])||(A=[A]),(B=Array.isArray(B[0])?B:B.map(x=>[x]))[0].length);let B_cols=B[0].map((_,i)=>B.map(x=>x[i])),product=A.map(row=>B_cols.map(col=>{let ret=0;if(Array.isArray(row))for(let i=0;i<row.length;i++)ret+=row[i]*(col[i]||0);else for(var c of col)ret+=row*c;return ret}));return 1===m&&(product=product[0]),1===p?product.map(x=>x[0]):product}function isString(str){return"string"===type(str)}function type(o){return(Object.prototype.toString.call(o).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function toPrecision(n,precision){n=+n,precision=+precision;var integerLength=(Math.floor(n)+"").length;return integerLength<precision?+n.toFixed(precision-integerLength):(integerLength=10**(integerLength-precision),Math.round(n/integerLength)*integerLength)}function parseFunction(str){if(str){str=str.trim();const isNumberRegex=/^-?[\d.]+$/;str=str.match(/^([a-z]+)\((.+?)\)$/i);if(str){let args=[];return str[2].replace(/\/?\s*([-\w.]+(?:%|deg)?)/g,($0,arg)=>{/%$/.test(arg)?(arg=new Number(arg.slice(0,-1)/100)).type="<percentage>":/deg$/.test(arg)?((arg=new Number(+arg.slice(0,-3))).type="<angle>",arg.unit="deg"):isNumberRegex.test(arg)&&((arg=new Number(arg)).type="<number>"),$0.startsWith("/")&&((arg=arg instanceof Number?arg:new Number(arg)).alpha=!0),args.push(arg)}),{name:str[1].toLowerCase(),rawName:str[1],rawArgs:str[2],args:args}}}}function last(arr){return arr[arr.length-1]}function interpolate(start,end,p){return isNaN(start)?end:isNaN(end)?start:start+(end-start)*p}function interpolateInv(start,end,value){return(value-start)/(end-start)}function mapRange(from,to,value){return interpolate(to[0],to[1],interpolateInv(from[0],from[1],value))}function parseCoordGrammar(coordGrammars){return coordGrammars.map(coordGrammar=>coordGrammar.split("|").map(type=>{var ret,range=(type=type.trim()).match(/^(<[a-z]+>)\[(-?[.\d]+),\s*(-?[.\d]+)\]?$/);return range?((ret=new String(range[1])).range=[+range[2],+range[3]],ret):type}))}var util=Object.freeze({__proto__:null,isString:isString,type:type,toPrecision:toPrecision,parseFunction:parseFunction,last:last,interpolate:interpolate,interpolateInv:interpolateInv,mapRange:mapRange,parseCoordGrammar:parseCoordGrammar,multiplyMatrices:multiplyMatrices});const hooks=new class{add(name,callback,first){if("string"!=typeof arguments[0])for(var name in arguments[0])this.add(name,arguments[0][name],callback);else(Array.isArray(name)?name:[name]).forEach(function(name){this[name]=this[name]||[],callback&&this[name][first?"unshift":"push"](callback)},this)}run(name,env){this[name]=this[name]||[],this[name].forEach(function(callback){callback.call(env&&env.context?env.context:env,env)})}};var defaults={gamut_mapping:"lch.c",precision:5,deltaE:"76"};const WHITES={D50:[.3457/.3585,1,.2958/.3585],D65:[.3127/.329,1,.3583/.329]};function getWhite(name){return Array.isArray(name)?name:WHITES[name]}function adapt$1(W1,W2,XYZ,options={}){if(W1=getWhite(W1),W2=getWhite(W2),!W1||!W2)throw new TypeError("Missing white point to convert "+(W1?"":"from")+(W1||W2?"":"/")+(W2?"":"to"));if(W1===W2)return XYZ;W1={W1:W1,W2:W2,XYZ:XYZ,options:options};if(hooks.run("chromatic-adaptation-start",W1),W1.M||(W1.W1===WHITES.D65&&W1.W2===WHITES.D50?W1.M=[[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]]:W1.W1===WHITES.D50&&W1.W2===WHITES.D65&&(W1.M=[[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]])),hooks.run("chromatic-adaptation-end",W1),W1.M)return multiplyMatrices(W1.M,W1.XYZ);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}var _processFormat=new WeakSet,_path=new WeakMap,_getPath=new WeakSet;class ColorSpace{constructor(options){_classPrivateMethodInitSpec(this,_getPath),_classPrivateMethodInitSpec(this,_processFormat),_classPrivateFieldInitSpec(this,_path,{writable:!0,value:void 0}),this.id=options.id,this.name=options.name,this.base=options.base?ColorSpace.get(options.base):null,this.aliases=options.aliases,this.base&&(this.fromBase=options.fromBase,this.toBase=options.toBase);var name,_options$coords=null!=(_options$coords=options.coords)?_options$coords:this.base.coords,_options$coords=(this.coords=_options$coords,null!=(_options$coords=null!=(_options$coords=options.white)?_options$coords:this.base.white)?_options$coords:"D65");for(name in this.white=getWhite(_options$coords),this.formats=null!=(_options$coords=options.formats)?_options$coords:{},this.formats){var format=this.formats[name];format.type||(format.type="function"),format.name||(format.name=name)}!options.cssId||null!=(_options$coords=this.formats.functions)&&_options$coords.color?null==(_options$coords=this.formats)||!_options$coords.color||null!=(_options$coords=this.formats)&&_options$coords.color.id||(this.formats.color.id=this.id):(this.formats.color={id:options.cssId},Object.defineProperty(this,"cssId",{value:options.cssId})),this.referred=options.referred,_classPrivateFieldSet(this,_path,_classPrivateMethodGet(this,_getPath,_getPath2).call(this).reverse()),hooks.run("colorspace-init-end",this)}inGamut(coords,{epsilon=75e-6}={}){if(this.isPolar)return coords=this.toBase(coords),this.base.inGamut(coords,{epsilon:epsilon});let coordMeta=Object.values(this.coords);return coords.every((c,i)=>{var max,i=coordMeta[i];return"angle"===i.type||!i.range||!!Number.isNaN(c)||([i,max]=i.range,(void 0===i||i-epsilon<=c)&&(void 0===max||c<=max+epsilon))})}get cssId(){var _this$formats$functio2;return(null==(_this$formats$functio2=this.formats.functions)||null==(_this$formats$functio2=_this$formats$functio2.color)?void 0:_this$formats$functio2.id)||this.id}get isPolar(){for(var id in this.coords)if("angle"===this.coords[id].type)return!0;return!1}getFormat(format){if("object"==typeof format)return format=_classPrivateMethodGet(this,_processFormat,_processFormat2).call(this,format);let ret;return(ret="default"===format?Object.values(this.formats)[0]:this.formats[format])?ret=_classPrivateMethodGet(this,_processFormat,_processFormat2).call(this,ret):null}to(space,coords){if(1===arguments.length&&([space,coords]=[space.space,space.coords]),this!==(space=ColorSpace.get(space))){coords=coords.map(c=>Number.isNaN(c)?0:c);var myPath=_classPrivateFieldGet(this,_path),otherPath=_classPrivateFieldGet(space,_path);let connectionSpace,connectionSpaceIndex;for(let i=0;i<myPath.length&&myPath[i]===otherPath[i];i++)connectionSpace=myPath[i],connectionSpaceIndex=i;if(!connectionSpace)throw new Error(`Cannot convert between color spaces ${this} and ${space}: no connection space was found`);for(let i=myPath.length-1;i>connectionSpaceIndex;i--)coords=myPath[i].toBase(coords);for(let i=connectionSpaceIndex+1;i<otherPath.length;i++)coords=otherPath[i].fromBase(coords)}return coords}from(space,coords){return 1===arguments.length&&([space,coords]=[space.space,space.coords]),(space=ColorSpace.get(space)).to(this,coords)}toString(){return`${this.name} (${this.id})`}getMinCoords(){var id,ret=[];for(id in this.coords){var meta=this.coords[id],meta=meta.range||meta.refRange;ret.push(null!=(meta=null==meta?void 0:meta.min)?meta:0)}return ret}static get all(){return[...new Set(Object.values(ColorSpace.registry))]}static register(id,space){if(1===arguments.length&&(id=(space=arguments[0]).id),space=this.get(space),this.registry[id]&&this.registry[id]!==space)throw new Error(`Duplicate color space registration: '${id}'`);if(this.registry[id]=space,1===arguments.length&&space.aliases)for(var alias of space.aliases)this.register(alias,space);return space}static get(space,...alternatives){if(!space||space instanceof ColorSpace)return space;if("string"===type(space)){var ret=ColorSpace.registry[space.toLowerCase()];if(ret)return ret;throw new TypeError(`No color space found with id = "${space}"`)}if(alternatives.length)return ColorSpace.get(...alternatives);throw new TypeError(space+" is not a valid color space")}static resolveCoord(ref,workingSpace){let space,coord;if("string"===type(ref)?ref.includes(".")?[space,coord]=ref.split("."):[space,coord]=[,ref]:Array.isArray(ref)?[space,coord]=ref:(space=ref.space,coord=ref.coordId),!(space=(space=ColorSpace.get(space))||workingSpace))throw new TypeError(`Cannot resolve coordinate reference ${ref}: No color space specified and relative references are not allowed here`);if("number"===(workingSpace=type(coord))||"string"===workingSpace&&0<=coord){ref=Object.entries(space.coords)[coord];if(ref)return _objectSpread({space:space,id:ref[0],index:coord},ref[1])}space=ColorSpace.get(space);var id,_meta$name,normalizedCoord=coord.toLowerCase();let i=0;for(id in space.coords){let meta=space.coords[id];if(id.toLowerCase()===normalizedCoord||(null==(_meta$name=meta.name)?void 0:_meta$name.toLowerCase())===normalizedCoord)return _objectSpread({space:space,id:id,index:i},meta);i++}throw new TypeError(`No "${coord}" coordinate found in ${space.name}. Its coordinates are: `+Object.keys(space.coords).join(", "))}}function _processFormat2(format){if(format.coords&&!format.coordGrammar){format.type||(format.type="function"),format.name||(format.name="color"),format.coordGrammar=parseCoordGrammar(format.coords);let coordFormats=Object.entries(this.coords).map(([,coordMeta],i)=>{i=format.coordGrammar[i][0],coordMeta=coordMeta.range||coordMeta.refRange;let toRange=i.range,suffix="";return"<percentage>"==i?(toRange=[0,100],suffix="%"):"<angle>"==i&&(suffix="deg"),{fromRange:coordMeta,toRange:toRange,suffix:suffix}});format.serializeCoords=(coords,precision)=>coords.map((c,i)=>{var{fromRange:i,toRange,suffix}=coordFormats[i];return c=toPrecision(c=i&&toRange?mapRange(i,toRange,c):c,precision),suffix&&(c+=suffix),c})}return format}function _getPath2(){var ret=[this];for(let space=this;space=space.base;)ret.push(space);return ret}_defineProperty(ColorSpace,"registry",{}),_defineProperty(ColorSpace,"DEFAULT_FORMAT",{type:"functions",name:"color"});var XYZ_D65=new ColorSpace({id:"xyz-d65",name:"XYZ D65",coords:{x:{name:"X"},y:{name:"Y"},z:{name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]});class RGBColorSpace extends ColorSpace{constructor(options){options.coords||(options.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),options.base||(options.base=XYZ_D65),options.toXYZ_M&&options.fromXYZ_M&&(null==options.toBase&&(options.toBase=rgb=>{let xyz=multiplyMatrices(options.toXYZ_M,rgb);return xyz=this.white!==this.base.white?adapt$1(this.white,this.base.white,xyz):xyz}),null==options.fromBase)&&(options.fromBase=xyz=>(xyz=adapt$1(this.base.white,this.white,xyz),multiplyMatrices(options.fromXYZ_M,xyz))),null==options.referred&&(options.referred="display"),super(options)}}function parse(str){let env={str:null==(_String=String(str))?void 0:_String.trim()};if(hooks.run("parse-start",env),env.color)return env.color;if(env.parsed=parseFunction(env.str),env.parsed){let name=env.parsed.name;if("color"===name){var space,_String,id=env.parsed.args.shift(),alpha=0<env.parsed.rawArgs.indexOf("/")?env.parsed.args.pop():1;for(space of ColorSpace.all){var colorSpec=space.getFormat("color");if(colorSpec)if(id===colorSpec.id||null!=(colorSpec=colorSpec.ids)&&colorSpec.includes(id)){colorSpec=Object.keys(space.coords).length;let coords=Array(colorSpec).fill(0);return coords.forEach((_,i)=>coords[i]=env.parsed.args[i]||0),{spaceId:space.id,coords:coords,alpha:alpha}}}let didYouMean="";throw id in ColorSpace.registry&&(_String=null==(_String=ColorSpace.registry[id].formats)||null==(_String=_String.functions)||null==(_String=_String.color)?void 0:_String.id)&&(didYouMean=`Did you mean color(${_String})?`),new TypeError(`Cannot parse color(${id}). `+(didYouMean||"Missing a plugin?"))}for(let space of ColorSpace.all){let format=space.getFormat(name);if(format&&"function"===format.type){let alpha=1,coords=((format.lastAlpha||last(env.parsed.args).alpha)&&(alpha=env.parsed.args.pop()),env.parsed.args);return format.coordGrammar&&Object.entries(space.coords).forEach(([id,coordMeta],i)=>{var _coords$i;let coordGrammar=format.coordGrammar[i],providedType=null==(_coords$i=coords[i])?void 0:_coords$i.type;if(!(coordGrammar=coordGrammar.find(c=>c==providedType)))throw _coords$i=coordMeta.name||id,new TypeError(`${providedType} not allowed for ${_coords$i} in ${name}()`);let fromRange=coordGrammar.range;"<percentage>"===providedType&&(fromRange=fromRange||[0,1]);id=coordMeta.range||coordMeta.refRange;fromRange&&id&&(coords[i]=mapRange(fromRange,id,coords[i]))}),{spaceId:space.id,coords:coords,alpha:alpha}}}}else for(let space of ColorSpace.all)for(var formatId in space.formats){formatId=space.formats[formatId];if("custom"===formatId.type&&(!formatId.test||formatId.test(env.str))){formatId=formatId.parse(env.str);if(formatId)return null==formatId.alpha&&(formatId.alpha=1),formatId}}throw new TypeError(`Could not parse ${str} as a color. Missing a plugin?`)}function getColor(color){var space;if(color)return(space=(color=isString(color)?parse(color):color).space||color.spaceId)instanceof ColorSpace||(color.space=ColorSpace.get(space)),void 0===color.alpha&&(color.alpha=1),color;throw new TypeError("Empty color reference")}function getAll(color,space){return(space=ColorSpace.get(space)).from(color)}function get(color,prop){var{space:prop,index}=ColorSpace.resolveCoord(prop,color.space);return getAll(color,prop)[index]}function setAll(color,space,coords){return space=ColorSpace.get(space),color.coords=space.to(color.space,coords),color}function set$1(color,prop,value){if(color=getColor(color),2===arguments.length&&"object"===type(prop)){var p,object=prop;for(p in object)set$1(color,p,object[p])}else{"function"==typeof value&&(value=value(get(color,prop)));var{space:prop,index}=ColorSpace.resolveCoord(prop,color.space),coords=getAll(color,prop);coords[index]=value,setAll(color,prop,coords)}return color}var XYZ_D50=new ColorSpace({id:"xyz-d50",name:"XYZ D50",white:"D50",base:XYZ_D65,fromBase:coords=>adapt$1(XYZ_D65.white,"D50",coords),toBase:coords=>adapt$1("D50",XYZ_D65.white,coords),formats:{color:{}}});const κ$1=24389/27;let white$1=WHITES.D50;var lab=new ColorSpace({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:white$1,base:XYZ_D50,fromBase(XYZ){XYZ=XYZ.map((value,i)=>value/white$1[i]).map(value=>216/24389<value?Math.cbrt(value):(κ$1*value+16)/116);return[116*XYZ[1]-16,500*(XYZ[0]-XYZ[1]),200*(XYZ[1]-XYZ[2])]},toBase(Lab){var f=[];return f[1]=(Lab[0]+16)/116,f[0]=Lab[1]/500+f[1],f[2]=f[1]-Lab[2]/200,[24/116<f[0]?Math.pow(f[0],3):(116*f[0]-16)/κ$1,8<Lab[0]?Math.pow((Lab[0]+16)/116,3):Lab[0]/κ$1,24/116<f[2]?Math.pow(f[2],3):(116*f[2]-16)/κ$1].map((value,i)=>value*white$1[i])},formats:{lab:{coords:["<number> | <percentage>","<number>","<number>"]}}});function constrain(angle){return(angle%360+360)%360}var lch=new ColorSpace({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:lab,fromBase(Lab){var[Lab,a,b]=Lab;let hue;return hue=Math.abs(a)<.02&&Math.abs(b)<.02?NaN:180*Math.atan2(b,a)/Math.PI,[Lab,Math.sqrt(a**2+b**2),constrain(hue)]},toBase(LCH){let[Lightness,Chroma,Hue]=LCH;return Chroma<0&&(Chroma=0),isNaN(Hue)&&(Hue=0),[Lightness,Chroma*Math.cos(Hue*Math.PI/180),Chroma*Math.sin(Hue*Math.PI/180)]},formats:{lch:{coords:["<number> | <percentage>","<number>","<number> | <angle>"]}}});const Gfactor=25**7,π$1=Math.PI,r2d=180/π$1,d2r$1=π$1/180;function deltaE2000(color,sample,{kL=1,kC=1,kH=1}={}){var[color,a1,b1]=lab.from(color);let C1=lch.from(lab,[color,a1,b1])[1];var[sample,a2,b2]=lab.from(sample);let C2=lch.from(lab,[sample,a2,b2])[1];C1<0&&(C1=0),C2<0&&(C2=0);var C7=((C1+C2)/2)**7,C7=.5*(1-Math.sqrt(C7/(C7+Gfactor))),a1=(1+C7)*a1,C7=(1+C7)*a2,a2=Math.sqrt(a1**2+b1**2),Cdash2=Math.sqrt(C7**2+b2**2);let h1=0==a1&&0===b1?0:Math.atan2(b1,a1),h2=0==C7&&0===b2?0:Math.atan2(b2,C7);h1<0&&(h1+=2*π$1),h2<0&&(h2+=2*π$1),h1*=r2d;var b1=sample-color,a1=Cdash2-a2,b2=(h2*=r2d)-h1,C7=h1+h2,habs=Math.abs(b2);let Δh;a2*Cdash2==0?Δh=0:habs<=180?Δh=b2:180<b2?Δh=b2-360:b2<-180?Δh=360+b2:console.log("the unthinkable has happened");var b2=2*Math.sqrt(Cdash2*a2)*Math.sin(Δh*d2r$1/2),color=(color+sample)/2,sample=(a2+Cdash2)/2,Cdash7=Math.pow(sample,7);let hdash;hdash=a2*Cdash2==0?C7:habs<=180?C7/2:C7<360?(C7+360)/2:(C7-360)/2;a2=(color-50)**2,Cdash2=1+.015*a2/Math.sqrt(20+a2),habs=1+.045*sample,C7=1,color=1+.015*sample*((C7-=.17*Math.cos((hdash-30)*d2r$1))+.24*Math.cos(2*hdash*d2r$1)+.32*Math.cos((3*hdash+6)*d2r$1)-.2*Math.cos((4*hdash-63)*d2r$1)),a2=30*Math.exp(-1*((hdash-275)/25)**2),sample=2*Math.sqrt(Cdash7/(Cdash7+Gfactor)),C7=(b1/(kL*Cdash2))**2,C7=(C7+=(a1/(kC*habs))**2)+(b2/(kH*color))**2+a1/(kC*habs)*(-1*Math.sin(2*a2*d2r$1)*sample)*(b2/(kH*color));return Math.sqrt(C7)}const ε$2=75e-6;function inGamut(color,space=color.space,{epsilon=ε$2}={}){color=getColor(color),space=ColorSpace.get(space);let coords=color.coords;return space!==color.space&&(coords=space.from(color)),space.inGamut(coords,{epsilon:epsilon})}function clone(color){return{space:color.space,coords:color.coords.slice(),alpha:color.alpha}}function toGamut(color,{method=defaults.gamut_mapping,space=color.space}={}){if(isString(arguments[1])&&(space=arguments[1]),!inGamut(color,space=ColorSpace.get(space),{epsilon:0})){let spaceColor=to(color,space);if("clip"!==method&&!inGamut(color,space)){var clipped=toGamut(clone(spaceColor),{method:"clip",space:space});if(2<deltaE2000(color,clipped)){var coordMeta=ColorSpace.resolveCoord(method),mapSpace=coordMeta.space,coordId=coordMeta.id,mappedColor=to(spaceColor,mapSpace);let low=(coordMeta.range||coordMeta.refRange)[0],high=get(mappedColor,coordId);for(;.01<high-low;){let clipped=clone(mappedColor);deltaE2000(mappedColor,clipped=toGamut(clipped,{space:space,method:"clip"}))-2<.01?low=get(mappedColor,coordId):high=get(mappedColor,coordId),set$1(mappedColor,coordId,(low+high)/2)}spaceColor=to(mappedColor,space)}else spaceColor=clipped}if("clip"===method||!inGamut(spaceColor,space,{epsilon:0})){let bounds=Object.values(space.coords).map(c=>c.range||[]);spaceColor.coords=spaceColor.coords.map((c,i)=>{var[i,max]=bounds[i];return void 0!==i&&(c=Math.max(i,c)),c=void 0!==max?Math.min(c,max):c})}space!==color.space&&(spaceColor=to(spaceColor,color.space)),color.coords=spaceColor.coords}return color}function to(color,space,{inGamut}={}){color=getColor(color);var coords=(space=ColorSpace.get(space)).from(color);let ret={space:space,coords:coords,alpha:color.alpha};return ret=inGamut?toGamut(ret):ret}function serialize(color,_ref2={}){let{precision=defaults.precision,format="default",inGamut:inGamut$1=!0}=_ref2,customOptions=_objectWithoutProperties(_ref2,_excluded),ret;color=getColor(color);_ref2=format;format=null!=(_color$space$getForma=null!=(_color$space$getForma=color.space.getFormat(format))?_color$space$getForma:color.space.getFormat("default"))?_color$space$getForma:ColorSpace.DEFAULT_FORMAT,inGamut$1=inGamut$1||format.toGamut;let coords=color.coords;if(coords=coords.map(c=>c||0),inGamut$1&&!inGamut(color)&&(coords=toGamut(clone(color),!0===inGamut$1?void 0:inGamut$1).coords),"custom"===format.type){if(customOptions.precision=precision,!format.serialize)throw new TypeError(`format ${_ref2} can only be used to parse colors, not for serialization`);ret=format.serialize(coords,color.alpha,customOptions)}else{var _color$space$getForma=format.name||"color",_ref2=(format.serializeCoords?coords=format.serializeCoords(coords,precision):null!==precision&&(coords=coords.map(c=>toPrecision(c,precision))),[...coords]);"color"===_color$space$getForma&&(_format$ids=format.id||(null==(_format$ids=format.ids)?void 0:_format$ids[0])||color.space.id,_ref2.unshift(_format$ids));let alpha=color.alpha;null!==precision&&(alpha=toPrecision(alpha,precision));var _format$ids=color.alpha<1&&!format.noAlpha?`${format.commas?",":" /"} `+alpha:"";ret=`${_color$space$getForma}(${_ref2.join(format.commas?", ":" ")}${_format$ids})`}return ret}to.returns=toGamut.returns="color";var REC2020Linear=new RGBColorSpace({id:"rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],fromXYZ_M:[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]]});const α=1.09929682680944,β=.018053968510807;var REC2020=new RGBColorSpace({id:"rec2020",name:"REC.2020",base:REC2020Linear,toBase(RGB){return RGB.map(function(val){return val<4.5*β?val/4.5:Math.pow((val+α-1)/α,1/.45)})},fromBase(RGB){return RGB.map(function(val){return val>=β?α*Math.pow(val,.45)-(α-1):4.5*val})},formats:{color:{}}}),P3Linear=new RGBColorSpace({id:"p3-linear",name:"Linear P3",white:"D65",toXYZ_M:[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],fromXYZ_M:[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]]}),sRGBLinear=new RGBColorSpace({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],fromXYZ_M:[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],formats:{color:{}}}),KEYWORDS={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[.6,50/255,.8],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,.6],lightslategrey:[119/255,136/255,.6],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[.4,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,.8],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[.4,.2,.6],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]},coordGrammar=Array(3).fill("<percentage> | <number>[0, 255]"),coordGrammarNumber=Array(3).fill("<number>[0, 255]"),coordGrammar=new RGBColorSpace({id:"srgb",name:"sRGB",base:sRGBLinear,fromBase:rgb=>rgb.map(val=>{var sign=val<0?-1:1,abs=val*sign;return.0031308<abs?sign*(1.055*abs**(1/2.4)-.055):12.92*val}),toBase:rgb=>rgb.map(val=>{var sign=val<0?-1:1,abs=val*sign;return abs<.04045?val/12.92:sign*((.055+abs)/1.055)**2.4}),formats:{rgb:{coords:coordGrammar},rgb_number:{name:"rgb",commas:!0,coords:coordGrammarNumber,noAlpha:!0},color:{},rgba:{coords:coordGrammar,commas:!0,lastAlpha:!0},rgba_number:{name:"rgba",commas:!0,coords:coordGrammarNumber},hex:{type:"custom",toGamut:!0,test:str=>/^#([a-f0-9]{3,4}){1,2}$/i.test(str),parse(str){str.length<=5&&(str=str.replace(/[a-f0-9]/gi,"$&$&"));let rgba=[];return str.replace(/[a-f0-9]{2}/gi,component=>{rgba.push(parseInt(component,16)/255)}),{spaceId:"srgb",coords:rgba.slice(0,3),alpha:rgba.slice(3)[0]}},serialize:(coords,alpha,{collapse=!0}={})=>{alpha<1&&coords.push(alpha),coords=coords.map(c=>Math.round(255*c));let collapsible=collapse&&coords.every(c=>c%17==0);return"#"+coords.map(c=>collapsible?(c/17).toString(16):c.toString(16).padStart(2,"0")).join("")}},keyword:{type:"custom",test:str=>/^[a-z]+$/i.test(str),parse(str){var ret={spaceId:"srgb",coords:null,alpha:1};if("transparent"===(str=str.toLowerCase())?(ret.coords=KEYWORDS.black,ret.alpha=0):ret.coords=KEYWORDS[str],ret.coords)return ret}}}}),coordGrammarNumber=new RGBColorSpace({id:"p3",name:"P3",base:P3Linear,fromBase:coordGrammar.fromBase,toBase:coordGrammar.toBase,formats:{color:{id:"display-p3"}}});if(defaults.display_space=coordGrammar,"undefined"!=typeof CSS&&CSS.supports)for(var space of[lab,REC2020,coordGrammarNumber]){var coords=space.getMinCoords(),coords=serialize({space:space,coords:coords,alpha:1});if(CSS.supports("color",coords)){defaults.display_space=space;break}}function distance(color1,color2,space="lab"){color1=(space=ColorSpace.get(space)).from(color1);let coords2=space.from(color2);return Math.sqrt(color1.reduce((acc,c1,i)=>{i=coords2[i];return isNaN(c1)||isNaN(i)?acc:acc+(i-c1)**2},0))}const κ=24389/27;let white=WHITES.D65;var lab_d65=new ColorSpace({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:white,base:XYZ_D65,fromBase(XYZ){XYZ=XYZ.map((value,i)=>value/white[i]).map(value=>216/24389<value?Math.cbrt(value):(κ*value+16)/116);return[116*XYZ[1]-16,500*(XYZ[0]-XYZ[1]),200*(XYZ[1]-XYZ[2])]},toBase(Lab){var f=[];return f[1]=(Lab[0]+16)/116,f[0]=Lab[1]/500+f[1],f[2]=f[1]-Lab[2]/200,[24/116<f[0]?Math.pow(f[0],3):(116*f[0]-16)/κ,8<Lab[0]?Math.pow((Lab[0]+16)/116,3):Lab[0]/κ,24/116<f[2]?Math.pow(f[2],3):(116*f[2]-16)/κ].map((value,i)=>value*white[i])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number>","<number>"]}}});Math.pow(5,.5);const d2r=Math.PI/180;var XYZ_Abs_D65=new ColorSpace({id:"xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:XYZ_D65,fromBase(XYZ){return XYZ.map(v=>Math.max(203*v,0))},toBase(AbsXYZ){return AbsXYZ.map(v=>Math.max(v/203,0))}});const g=.66,d=-.56,d0=16295499532821565e-27,XYZtoCone_M=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],ConetoXYZ_M=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],ConetoIab_M=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],IabtoCone_M=[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]];var Jzazbz=new ColorSpace({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.5,.5]},bz:{refRange:[-.5,.5]}},base:XYZ_Abs_D65,fromBase(XYZ){var[XYZ,Ya,Za]=XYZ,Xm=1.15*XYZ-(1.15-1)*Za,Ya=g*Ya-(g-1)*XYZ,XYZ=multiplyMatrices(XYZtoCone_M,[Xm,Ya,Za]).map(function(val){return((.8359375+2413/128*(val/1e4)**(2610/16384))/(1+18.6875*(val/1e4)**(2610/16384)))**(1.7*2523/32)}),[Xm,Ya,Za]=multiplyMatrices(ConetoIab_M,XYZ);return[(1+d)*Xm/(1+d*Xm)-d0,Ya,Za]},toBase(Jzazbz){var[Jzazbz,az,bz]=Jzazbz,Jzazbz=(Jzazbz+d0)/(1+d-d*(Jzazbz+d0)),Jzazbz=multiplyMatrices(IabtoCone_M,[Jzazbz,az,bz]).map(function(val){return 1e4*((.8359375-val**(32/(1.7*2523)))/(18.6875*val**(32/(1.7*2523))-2413/128))**(16384/2610)}),[az,bz,Jzazbz]=multiplyMatrices(ConetoXYZ_M,Jzazbz),az=(az+(1.15-1)*Jzazbz)/1.15;return[az,(bz+(g-1)*az)/g,Jzazbz]},formats:{color:{}}}),jzczhz=new ColorSpace({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,1],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:Jzazbz,fromBase(jzazbz){var[jzazbz,az,bz]=jzazbz;let hue;return hue=Math.abs(az)<2e-4&&Math.abs(bz)<2e-4?NaN:180*Math.atan2(bz,az)/Math.PI,[jzazbz,Math.sqrt(az**2+bz**2),constrain(hue)]},toBase(jzczhz){return[jzczhz[0],jzczhz[1]*Math.cos(jzczhz[2]*Math.PI/180),jzczhz[1]*Math.sin(jzczhz[2]*Math.PI/180)]},formats:{color:{}}});const m1=2610/16384,XYZtoLMS_M$1=[[.3592,.6976,-.0358],[-.1922,1.1004,.0755],[.007,.0749,.8434]],LMStoIPT_M=[[.5,.5,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],IPTtoLMS_M=[[.9999888965628402,.008605050147287059,.11103437159861648],[1.00001110343716,-.008605050147287059,-.11103437159861648],[1.0000320633910054,.56004913547279,-.3206339100541203]],LMStoXYZ_M$1=[[2.0701800566956137,-1.326456876103021,.20661600684785517],[.3649882500326575,.6804673628522352,-.04542175307585323],[-.04959554223893211,-.04942116118675749,1.1879959417328034]];var ictcp=new ColorSpace({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:XYZ_Abs_D65,fromBase(XYZ){return function(LMS){LMS=LMS.map(function(val){return((.8359375+2413/128*(val/1e4)**m1)/(1+18.6875*(val/1e4)**m1))**(2523/32)});return multiplyMatrices(LMStoIPT_M,LMS)}(multiplyMatrices(XYZtoLMS_M$1,XYZ))},toBase(ICtCp){ICtCp=function(ICtCp){ICtCp=multiplyMatrices(IPTtoLMS_M,ICtCp),ICtCp=ICtCp.map(function(val){return 1e4*(Math.max(val**(32/2523)-.8359375,0)/(2413/128-18.6875*val**(32/2523)))**(16384/2610)});return ICtCp}(ICtCp);return multiplyMatrices(LMStoXYZ_M$1,ICtCp)},formats:{color:{}}});const XYZtoLMS_M=[[.8190224432164319,.3619062562801221,-.12887378261216414],[.0329836671980271,.9292868468965546,.03614466816999844],[.048177199566046255,.26423952494422764,.6335478258136937]],LMStoXYZ_M=[[1.2268798733741557,-.5578149965554813,.28139105017721583],[-.04057576262431372,1.1122868293970594,-.07171106666151701],[-.07637294974672142,-.4214933239627914,1.5869240244272418]],LMStoLab_M=[[.2104542553,.793617785,-.0040720468],[1.9779984951,-2.428592205,.4505937099],[.0259040371,.7827717662,-.808675766]],LabtoLMS_M=[[.9999999984505198,.39633779217376786,.2158037580607588],[1.0000000088817609,-.10556134232365635,-.06385417477170591],[1.0000000546724108,-.08948418209496575,-1.2914855378640917]];var OKLab=new ColorSpace({id:"oklab",name:"OKLab",coords:{l:{refRange:[0,1],name:"L"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:XYZ_D65,fromBase(XYZ){XYZ=multiplyMatrices(XYZtoLMS_M,XYZ).map(val=>Math.cbrt(val));return multiplyMatrices(LMStoLab_M,XYZ)},toBase(OKLab){OKLab=multiplyMatrices(LabtoLMS_M,OKLab).map(val=>val**3);return multiplyMatrices(LMStoXYZ_M,OKLab)},formats:{oklab:{coords:["<number> | <percentage>","<number>","<number>"]}}});var deltaEMethods=Object.freeze({__proto__:null,deltaE76:function(color,sample){return distance(color,sample,"lab")},deltaECMC:function(color,sample,{l=2,c=1}={}){var[color,a1,b1]=lab.from(color);let[,C1,H1]=lch.from(lab,[color,a1,b1]);var[sample,a2,b2]=lab.from(sample);let C2=lch.from(lab,[sample,a2,b2])[1];C1<0&&(C1=0),C2<0&&(C2=0);var sample=color-sample,ΔC=C1-C2,a1=(a1-a2)**2+(b1-b2)**2-ΔC**2;let SL=16<=color?.040975*color/(1+.01765*color):.511;a2=.0638*C1/(1+.0131*C1)+.638;let T;return Number.isNaN(H1)&&(H1=0),T=164<=H1&&H1<=345?.56+Math.abs(.2*Math.cos((H1+168)*d2r)):.36+Math.abs(.4*Math.cos((H1+35)*d2r)),b1=Math.pow(C1,4),b2=Math.sqrt(b1/(b1+1900)),color=a2*(b2*T+1-b2),b1=(b1=(sample/(l*SL))**2)+(ΔC/(c*a2))**2+a1/color**2,Math.sqrt(b1)},deltaE2000:deltaE2000,deltaEJz:function(color,sample){let[Jz1,Cz1,Hz1]=jzczhz.from(color),[Jz2,Cz2,Hz2]=jzczhz.from(sample);var color=Jz1-Jz2,sample=Cz1-Cz2,Δh=(Number.isNaN(Hz1)&&Number.isNaN(Hz2)?(Hz1=0,Hz2=0):Number.isNaN(Hz1)?Hz1=Hz2:Number.isNaN(Hz2)&&(Hz2=Hz1),Hz1-Hz2),Δh=2*Math.sqrt(Cz1*Cz2)*Math.sin(Δh/2*(Math.PI/180));return Math.sqrt(color**2+sample**2+Δh**2)},deltaEITP:function(color,sample){var[color,T1,P1]=ictcp.from(color),[sample,T2,P2]=ictcp.from(sample);return 720*Math.sqrt((color-sample)**2+.25*(T1-T2)**2+(P1-P2)**2)},deltaEOK:function(color,sample){var[color,a1,b1]=OKLab.from(color),[sample,a2,b2]=OKLab.from(sample);return Math.sqrt((color-sample)**2+(a1-a2)**2+(b1-b2)**2)}});function deltaE(c1,c2,o={}){isString(o)&&(o={method:o});var m,{method=defaults.deltaE}=o,rest=_objectWithoutProperties(o,_excluded4);for(m in c1=getColor(c1),c2=getColor(c2),deltaEMethods)if("deltae"+method.toLowerCase()===m.toLowerCase())return deltaEMethods[m](c1,c2,rest);throw new TypeError("Unknown deltaE method: "+method)}var variations=Object.freeze({__proto__:null,lighten:function(color,amount=.25){return set$1(color,[ColorSpace.get("oklch","lch"),"l"],l=>l*(1+amount))},darken:function(color,amount=.25){return set$1(color,[ColorSpace.get("oklch","lch"),"l"],l=>l*(1-amount))}});defaults.interpolationSpace="lab";var HSL=new ColorSpace({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:coordGrammar,fromBase:rgb=>{var max=Math.max(...rgb),min=Math.min(...rgb),[r,g,b]=rgb;let[h,s,l]=[NaN,0,(min+max)/2];var d=max-min;if(0!=d){switch(s=0===l||1===l?0:(max-l)/Math.min(l,1-l),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h*=60}return[h,100*s,100*l]},toBase:hsl=>{let[h,s,l]=hsl;function f(n){var n=(n+h/30)%12,a=s*Math.min(l,1-l);return l-a*Math.max(-1,Math.min(n-3,9-n,1))}return(h%=360)<0&&(h+=360),s/=100,l/=100,[f(0),f(8),f(4)]},formats:{hsl:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]},hsla:{coords:["<number> | <angle>","<percentage>","<percentage>"],commas:!0,lastAlpha:!0}}}),HSV=new ColorSpace({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:HSL,fromBase(hsl){var[hsl,s,l]=hsl,s=(l/=100)+(s/=100)*Math.min(l,1-l);return[hsl,0==s?0:200*(1-l/s),100*s]},toBase(hsv){var[hsv,s,v]=hsv,s=(v/=100)*(1-(s/=100)/2);return[hsv,0==s||1==s?0:(v-s)/Math.min(s,1-s)*100,100*s]},formats:{color:{toGamut:!0}}}),hwb=new ColorSpace({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:HSV,fromBase(hsv){var[hsv,s,v]=hsv;return[hsv,v*(100-s)/100,100-v]},toBase(hwb){var[hwb,w,b]=hwb,sum=(w/=100)+(b/=100);return 1<=sum?[hwb,0,100*(w/sum)]:[hwb,100*(0==(sum=1-b)?0:1-w/sum),100*sum]},formats:{hwb:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]}}}),A98Linear=new RGBColorSpace({id:"a98rgb-linear",name:"Linear Adobe® 98 RGB compatible",white:"D65",toXYZ_M:[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],fromXYZ_M:[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]]}),a98rgb=new RGBColorSpace({id:"a98rgb",name:"Adobe® 98 RGB compatible",base:A98Linear,toBase:RGB=>RGB.map(val=>Math.pow(Math.abs(val),563/256)*Math.sign(val)),fromBase:RGB=>RGB.map(val=>Math.pow(Math.abs(val),256/563)*Math.sign(val)),formats:{color:{id:"a98-rgb"}}}),ProPhotoLinear=new RGBColorSpace({id:"prophoto-linear",name:"Linear ProPhoto",white:"D50",base:XYZ_D50,toXYZ_M:[[.7977604896723027,.13518583717574031,.0313493495815248],[.2880711282292934,.7118432178101014,8565396060525902e-20],[0,0,.8251046025104601]],fromXYZ_M:[[1.3457989731028281,-.25558010007997534,-.05110628506753401],[-.5446224939028347,1.5082327413132781,.02053603239147973],[0,0,1.2119675456389454]]});var prophoto=new RGBColorSpace({id:"prophoto",name:"ProPhoto",base:ProPhotoLinear,toBase(RGB){return RGB.map(v=>v<.03125?v/16:v**1.8)},fromBase(RGB){return RGB.map(v=>1/512<=v?v**(1/1.8):16*v)},formats:{color:{id:"prophoto-rgb"}}}),oklch=new ColorSpace({id:"oklch",name:"OKLCh",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:OKLab,fromBase(oklab){var[oklab,a,b]=oklab;let h;return h=Math.abs(a)<2e-4&&Math.abs(b)<2e-4?NaN:180*Math.atan2(b,a)/Math.PI,[oklab,Math.sqrt(a**2+b**2),constrain(h)]},toBase(oklch){var[oklch,C,h]=oklch;let a,b;return b=isNaN(h)?a=0:(a=C*Math.cos(h*Math.PI/180),C*Math.sin(h*Math.PI/180)),[oklch,a,b]},formats:{oklch:{coords:["<number> | <percentage>","<number>","<number> | <angle>"]}}});const n=2610/16384;var rec2100Pq=new RGBColorSpace({id:"rec2100pq",name:"REC.2100-PQ",base:REC2020Linear,toBase(RGB){return RGB.map(function(val){return 1e4*(Math.max(val**(32/2523)-.8359375,0)/(2413/128-18.6875*val**(32/2523)))**(16384/2610)/203})},fromBase(RGB){return RGB.map(function(val){val=Math.max(203*val/1e4,0);return((.8359375+2413/128*val**n)/(1+18.6875*val**n))**(2523/32)})},formats:{color:{id:"rec2100-pq"}}});const a=.17883277,b=.28466892,c=.55991073;var rec2100Hlg=new RGBColorSpace({id:"rec2100hlg",cssid:"rec2100-hlg",name:"REC.2100-HLG",referred:"scene",base:REC2020Linear,toBase(RGB){return RGB.map(function(val){return val<=1/12?Math.sqrt(3*val):a*Math.log(12*val-b)+c})},fromBase(RGB){return RGB.map(function(val){return val<=.5?val**2/3:Math.exp((val-c)/a+b)/12})},formats:{color:{id:"rec2100-hlg"}}});const CATs={};function defineCAT({id}){CATs[id]=arguments[0]}function adapt(W1,W2,id="Bradford"){var id=CATs[id],[W1,γs,βs]=multiplyMatrices(id.toCone_M,W1),[W2,γd,βd]=multiplyMatrices(id.toCone_M,W2),W2=multiplyMatrices([[W2/W1,0,0],[0,γd/γs,0],[0,0,βd/βs]],id.toCone_M);return multiplyMatrices(id.fromCone_M,W2)}hooks.add("chromatic-adaptation-start",env=>{env.options.method&&(env.M=adapt(env.W1,env.W2,env.options.method))}),hooks.add("chromatic-adaptation-end",env=>{env.M||(env.M=adapt(env.W1,env.W2,env.options.method))}),defineCAT({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599364,-1.1293816,.2198974],[.3611914,.6388125,-64e-7],[0,0,1.0890636]]}),defineCAT({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929,-.1470543,.1599627],[.4323053,.5183603,.0492912],[-.0085287,.0400428,.9684867]]}),defineCAT({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238,-.278869,.1827452],[.454369,.4735332,.0720978],[-.0096276,-.005698,1.0153256]]}),defineCAT({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.011254630531685,.1491867754444518],[.3875265432361372,.6214474419314753,-.008973985167612518],[-.01584149884933386,-.03412293802851557,1.04996443687785]]}),Object.assign(WHITES,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]}),WHITES.ACES=[.32168/.33767,1,.34065/.33767];var ACEScg=new RGBColorSpace({id:"acescg",name:"ACEScg",coords:{r:{range:[0,65504],name:"Red"},g:{range:[0,65504],name:"Green"},b:{range:[0,65504],name:"Blue"}},referred:"scene",white:WHITES.ACES,toXYZ_M:[[.6624541811085053,.13400420645643313,.1561876870049078],[.27222871678091454,.6740817658111484,.05368951740793705],[-.005574649490394108,.004060733528982826,1.0103391003129971]],fromXYZ_M:[[1.6410233796943257,-.32480329418479,-.23642469523761225],[-.6636628587229829,1.6153315916573379,.016756347685530137],[.011721894328375376,-.008284441996237409,.9883948585390215]],formats:{color:{}}});const ε=2**-16;const ACES_cc_max=(Math.log2(65504)+9.72)/17.52;var key,id,acescc=new RGBColorSpace({id:"acescc",name:"ACEScc",coords:{r:{range:[-.35828683,ACES_cc_max],name:"Red"},g:{range:[-.35828683,ACES_cc_max],name:"Green"},b:{range:[-.35828683,ACES_cc_max],name:"Blue"}},referred:"scene",base:ACEScg,toBase(RGB){return RGB.map(function(val){return val<=(9.72-15)/17.52?2*(2**(17.52*val-9.72)-ε):val<ACES_cc_max?2**(17.52*val-9.72):65504})},fromBase(RGB){return RGB.map(function(val){return val<=0?(Math.log2(ε)+9.72)/17.52:val<ε?(Math.log2(ε+.5*val)+9.72)/17.52:(Math.log2(val)+9.72)/17.52})},formats:{color:{}}}),spaces=Object.freeze({__proto__:null,XYZ_D65:XYZ_D65,XYZ_D50:XYZ_D50,XYZ_ABS_D65:XYZ_Abs_D65,Lab_D65:lab_d65,Lab:lab,LCH:lch,sRGB_Linear:sRGBLinear,sRGB:coordGrammar,HSL:HSL,HWB:hwb,HSV:HSV,P3_Linear:P3Linear,P3:coordGrammarNumber,A98RGB_Linear:A98Linear,A98RGB:a98rgb,ProPhoto_Linear:ProPhotoLinear,ProPhoto:prophoto,REC_2020_Linear:REC2020Linear,REC_2020:REC2020,OKLab:OKLab,OKLCH:oklch,Jzazbz:Jzazbz,JzCzHz:jzczhz,ICTCP:ictcp,REC_2100_PQ:rec2100Pq,REC_2100_HLG:rec2100Hlg,ACEScg:ACEScg,ACEScc:acescc}),_space=new WeakMap;class Color{constructor(...args){_classPrivateFieldInitSpec(this,_space,{writable:!0,value:void 0});let color,space,coords,alpha;(color=1===args.length?getColor(args[0]):color)?(space=color.space||color.spaceId,coords=color.coords,alpha=color.alpha):[space,coords,alpha]=args,_classPrivateFieldSet(this,_space,ColorSpace.get(space)),this.coords=coords?coords.slice():[0,0,0],this.alpha=alpha<1?alpha:1;for(let i=0;i<this.coords.length;i++)"NaN"===this.coords[i]&&(this.coords[i]=NaN);for(let id in _classPrivateFieldGet(this,_space).coords)Object.defineProperty(this,id,{get:()=>this.get(id),set:value=>this.set(id,value)})}get space(){return _classPrivateFieldGet(this,_space)}get spaceId(){return _classPrivateFieldGet(this,_space).id}clone(){return new Color(this.space,this.coords,this.alpha)}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}display(...args){args=function(color,_ref4={}){var{space=defaults.display_space}=_ref4,_ref4=_objectWithoutProperties(_ref4,_excluded2);let ret=serialize(color,_ref4);return"undefined"==typeof CSS||CSS.supports("color",ret)||!defaults.display_space?(ret=new String(ret)).color=color:(color=to(color,space),(ret=new String(serialize(color,_ref4))).color=color),ret}(this,...args);return args.color=new Color(args.color),args}static get(color,...args){return color instanceof Color?color:new Color(color,...args)}static defineFunction(name,code,o=code){function func(...args){let ret=code(...args);if("color"===returns)ret=Color.get(ret);else if("function<color>"===returns){let f=ret;ret=function(...args){args=f(...args);return Color.get(args)},Object.assign(ret,f)}else"array<color>"===returns&&(ret=ret.map(c=>Color.get(c)));return ret}let{instance=!0,returns}=o;name in Color||(Color[name]=func),instance&&(Color.prototype[name]=function(...args){return func(this,...args)})}static defineFunctions(o){for(var name in o)Color.defineFunction(name,o[name],o[name])}static extend(exports){if(exports.register)exports.register(Color);else for(var name in exports)Color.defineFunction(name,exports[name])}}Color.defineFunctions({get:get,getAll:getAll,set:set$1,setAll:setAll,to:to,equals:function(color1,color2){return color1=getColor(color1),color2=getColor(color2),color1.space===color2.space&&color1.alpha===color2.alpha&&color1.coords.every((c,i)=>c===color2.coords[i])},inGamut:inGamut,toGamut:toGamut,distance:distance,toString:serialize}),Object.assign(Color,{util:util,hooks:hooks,WHITES:WHITES,Space:ColorSpace,spaces:ColorSpace.registry,parse:parse,defaults:defaults});for(key of Object.keys(spaces))ColorSpace.register(spaces[key]);for(id in ColorSpace.registry)addSpaceAccessors(id,ColorSpace.registry[id]);function addSpaceAccessors(id,space){Object.keys(space.coords),Object.values(space.coords).map(c=>c.name);var propId=id.replace(/-/g,"_");Object.defineProperty(Color.prototype,propId,{get(){var ret=this.getAll(id);return"undefined"==typeof Proxy?ret:new Proxy(ret,{has:(obj,property)=>{try{return ColorSpace.resolveCoord([space,property]),!0}catch(e){}return Reflect.has(obj,property)},get:(obj,property,receiver)=>{if(property&&"symbol"!=typeof property&&!(property in obj)){var index=ColorSpace.resolveCoord([space,property])["index"];if(0<=index)return obj[index]}return Reflect.get(obj,property,receiver)},set:(obj,property,value,receiver)=>{if(property&&"symbol"!=typeof property&&!(property in obj)||0<=property){var index=ColorSpace.resolveCoord([space,property])["index"];if(0<=index)return obj[index]=value,this.setAll(id,obj),!0}return Reflect.set(obj,property,value,receiver)}})},set(coords){this.setAll(id,coords)},configurable:!0,enumerable:!0})}hooks.add("colorspace-init-end",addSpaceAccessors),Color.extend(deltaEMethods),Color.extend({deltaE:deltaE}),Color.extend(variations),module.exports=Color},{}],38:[function(require,module,exports){"use strict";var elementsData={en:[],ko:[["title",0,"스타크래프트 QR 코드 도구"],[".page-title",0,"스타크래프트 맵 QR 코드/미니맵 드로잉 도구"],[".map-inputs",0,"입력 맵:"],[".map-info",0,"크기:"],["#map-input-status-text",0,"지도 업로드"],["#mmdraw-image-status-text",0,"이미지 업로드"],["#tab-unitqr",0,"단위QR"],["#tab-tileqr",0,"타일QR"],["#tab-mmdraw",0,"미니맵 그리기"],["label[for*='qr-input-text']",0,"데이터:"],["label[for='tileqr-size']",0,"크기:"],["#label-unitqr-player",0,"단위 소유자:"],["#label-unitqr-pos",0,"위치:"],["#label-unitqr-ecl",0,"오류 수정 수준:"],["#label-tileqr-tiles",0,"타일:"],["#label-tileqr-pos",0,"위치:"],["#label-tileqr-ecl",0,"오류 수정 수준:"],["label[for*='qr-ecl-l']",0,"낮다"],["label[for*='qr-ecl-m']",0,"보통"],["label[for*='qr-ecl-h']",0,"높다"],["#label-unitqr-layerdown",0,"레이어 다운"],["#label-mmdraw-layerdown",0,"레이어 다운"],["#label-mmdraw-image",0,"이미지:"],["#label-mmdraw-size",0,"크기:"],["#label-mmdraw-pos",0,"위치:"],["#label-mmdraw-usegas",0,"가스 사용"],["#download-map",0,"지도 저장"],["#download-chk",0,"CHK 저장"],["#bubble-hint-unitqr-pos",0,"픽셀단위로 측정됩니다. QR 코드를 중앙에 두려면 공백을 둡니다."],["#bubble-hint-tileqr-pos",0,"32x32 그리드로 측정됩니다. QR 코드를 중앙에 두려면 공백을 둡니다."],["#bubble-hint-mmdraw-pos",0,"픽셀단위로 측정됩니다. 이미지를 중앙에 두려면 공간을 둡니다."],["#bubble-hint-unitqr-layer-down",0,"QR 코드 뒤에 다른 플레이어의 시작 위치를 이동합니다."],["#bubble-hint-mmdraw-layerdown",0,"이미지 뒤에 있는 모든 시작 위치를 이동합니다. 이렇게 하면 플레이어의 시작 보기가 변경됩니다."],["#bubble-hint-mmdraw-usegas",0,"청록색을 위해 플레이어 11용 간헐천을 만듭니다. 게임이 시작될 때 트리거를 사용하여 제거해야 합니다."],["#bubble-hint-tileqr-tiles",0,"SCMDraft 타일 인덱스 도구(예: 0100.01)에서 번호를 사용할 수 있습니다."],["#bubble-hint-mmdraw-image",0,"블랙은 투명합니다."],["#bubble-hint-mmdraw-size",0,"단위 수입니다."],["#palette-details",0,"팔레트: f40404,0c49cc,2cb494,87409c,f88e14,703014,cce0d0,fcfc38,088008,fcfc7c,ebc4b0,4067d4,000000[,00e3fc]"]],zh:[["title",0,"星际重制版二维码工具"],[".page-title",0,"星际重制版二维码&小地图绘制工具"],[".map-inputs",0,"地图："],[".map-info",0,"大小："],["#map-input-status-text",0,"点击上传地图"],["#mmdraw-image-status-text",0,"点击上传图片"],["#tab-unitqr",0,"单位码"],["#tab-tileqr",0,"地形码"],["#tab-mmdraw",0,"小地图绘制"],["label[for*='qr-input-text']",0,"文本："],["label[for='tileqr-size']",0,"倍率："],["#label-unitqr-player",0,"玩家："],["#label-unitqr-pos",0,"位置："],["#label-unitqr-ecl",0,"除错码："],["#label-tileqr-tiles",0,"地形："],["#label-tileqr-pos",0,"位置："],["#label-tileqr-ecl",0,"除错码："],["label[for*='qr-ecl-l']",0,"低"],["label[for*='qr-ecl-m']",0,"中"],["label[for*='qr-ecl-h']",0,"高"],["#label-unitqr-layerdown",0,"图层下移："],["#label-mmdraw-layerdown",0,"图层下移："],["#label-mmdraw-image",0,"图像："],["#label-mmdraw-size",0,"大小："],["#label-mmdraw-pos",0,"位置："],["#label-mmdraw-usegas",0,"使用气矿："],["#download-map",0,"生成地图"],["#download-chk",0,"生成CHK"],["#bubble-hint-unitqr-pos",0,"单位为像素。留空会生成在中间"],["#bubble-hint-tileqr-pos",0,"单位为格子。留空会生成在中间"],["#bubble-hint-mmdraw-pos",0,"单位为像素。留空会生成在中间"],["#bubble-hint-unitqr-layer-down",0,"把其他玩家的起始地点移到二维码下层"],["#bubble-hint-mmdraw-layerdown",0,"把所有玩家的起始点移到图像下层。会导致起始点变化"],["#bubble-hint-mmdraw-usegas",0,"生成玩家11的气矿来表示青色。建议开始游戏后用触发删掉"],["#bubble-hint-tileqr-tiles",0,"可以填SCMDraft的地形工具标题栏上的数字（如0100.01）"],["#bubble-hint-mmdraw-image",0,"黑色是透明"],["#bubble-hint-mmdraw-size",0,"单位的数量"],["#palette-details",0,"调色板：f40404,0c49cc,2cb494,87409c,f88e14,703014,cce0d0,fcfc38,088008,fcfc7c,ebc4b0,4067d4,000000[,00e3fc]"]]},elementAttribsData={en:[],ko:[["#unitqr-input-text, #tileqr-input-text","placeholder","QR 코드로 변환하려면 여기에 텍스트를 입력하십시오"],["#mmdraw-size-width","placeholder","너비"],["#mmdraw-size-height","placeholder","높이"]],zh:[["#unitqr-input-text, #tileqr-input-text","placeholder","输入想要转换为二维码的文字或链接"],["#mmdraw-size-width","placeholder","宽度"],["#mmdraw-size-height","placeholder","高度"]]},textData={en:{},ko:{"No input map!":"입력맵이 없습니다!","No map data! load map from input first":"지도 데이터가 없습니다! 먼저 입력에서 지도 업로드","No function selected!":"기능을 선택하지 않았습니다.","Cannot apply function!":"기능을 적용할 수 없습니다!","Unknown error! cannot convert map":"알 수없는 오류! 맵을 변환할 수 없습니다.","Cannot save file!":"파일을 저장할 수 없습니다!","Error! cannot pack map as MPQ (try saving as CHK)":"오류! 맵을 MPQ로 포장할 수 없습니다(CHK로 저장해 보십시오)","Failed to read map data!":"지도 데이터를 읽지 못했습니다!","No input text!":"텍스트를 입력하십시오!","Please upload image file!":"이미지를 업로드해 주세요!"},zh:{"No input map!":"没有输入图！","No map data! load map from input first":"没有地图数据！首先加载地图","No function selected!":"没有选择任何功能！","Cannot apply function!":"不能应用功能！","Unknown error! cannot convert map":"未知错误！无法转换地图","Cannot save file!":"无法保存文件！","Error! cannot pack map as MPQ (try saving as CHK)":"错误！不能将地图打包为 MPQ（尝试将地图保存为 CHK）","Failed to read map data!":"无法读取地图数据！","No input text!":"没有输入文本！","Please upload image file!":"请上传图像文件！"}};let currentLocale="en";const availableTranslations=["ko","zh"];function detectLocale(){for(let i=0;i<availableTranslations.length;i++){var key=availableTranslations[i];if(0==navigator.language.toString().indexOf(key))return currentLocale=key}return currentLocale}function translateElements(elemsData,elemsAttribsData){var fillBackEn=!1;0==elementsData.en.length&&(fillBackEn=!0),elemsData.forEach(args=>{let[selectors,textNodeID,text]=args,fbe=fillBackEn;Array.from(document.querySelectorAll(selectors)).map(a=>Array.from(a.childNodes).filter(cn=>cn.nodeType==document.TEXT_NODE)).forEach(a=>{a[textNodeID]&&(fbe&&(elementsData.en.push([selectors,textNodeID,a[textNodeID].textContent]),fbe=!1),a[textNodeID].textContent=text)})}),elemsAttribsData.forEach(args=>{let fbe=fillBackEn,[selectors,attribID,text]=args;Array.from(document.querySelectorAll(selectors)).forEach(a=>{fbe&&(elementAttribsData.en.push([selectors,attribID,a[attribID]]),fbe=!1),a[attribID]=text})})}module.exports={detectLocale:detectLocale,autoSetLocale:function(){var loc=detectLocale();return-1!=availableTranslations.indexOf(loc)&&translateElements(elementsData[loc],elementAttribsData[loc]),loc},changeLocale:function(){return currentLocale="en"==currentLocale?"ko":"ko"==currentLocale?"zh":"zh"==currentLocale?"en":"ko",translateElements(elementsData[currentLocale],elementAttribsData[currentLocale]),currentLocale},translateElements:translateElements,getI18n:function(key){return textData[currentLocale]&&textData[currentLocale][key]||key}}},{}],39:[function(require,module,exports){"use strict";const drawStars=require("./starsky")["drawStars"],{previewMinimapImage,patchChkDrawMinimap}=require("./minimapdraw"),findChunk=require("./chunkfind")["findChunk"],{previewQR,patchChkUnitQR,patchChkTileQR,getStartLocationSizes,suggestTiles}=require("./scqr"),objpacker=require("./objpacker"),chkstructs=require("./chkstructs"),{autoSetLocale,getI18n,changeLocale}=require("./i18n");var hiddenCanvas,downloadLink,mapChkData,optionsVisible=!1,downloadsVisible=!1,selectedFunction=0;function $Q(e){return document.querySelector(e)}function attachBubbleHintEvent(mainElem,bubbleHintElem){mainElem.addEventListener("mouseover",evt=>{bubbleHintElem.style.setProperty("display","block"),bubbleHintElem.style.setProperty("top",mainElem.offsetTop-bubbleHintElem.offsetHeight-12+"px"),bubbleHintElem.style.setProperty("left",mainElem.offsetLeft+"px")}),mainElem.addEventListener("mouseout",evt=>{bubbleHintElem.style.setProperty("display","none")})}function warning(text){let elem=document.createElement("div");elem.className="status-item";var elemText=document.createElement("div"),text=(elemText.className="status-message",elemText.innerHTML=text,elem.appendChild(elemText),evt=>{elem&&!elem.isBeingRemoved&&(elem.isBeingRemoved=!0,elem.style.setProperty("animation","fade 500ms reverse"),elem.style.setProperty("opacity",0),setTimeout(()=>{try{document.getElementById("status-container").removeChild(elem)}catch(e){}},550))});elem.addEventListener("click",text),document.getElementById("status-container").appendChild(elem),setTimeout(text,3e3)}function show(elem,val="block",time="500ms"){elem.style.setProperty("display",val),elem.style.setProperty("animation","fade "+time),elem.style.setProperty("opacity",1)}function hide(elem){elem.style.setProperty("display","none"),elem.style.setProperty("animation","fadeout 500ms"),elem.style.setProperty("opacity",0)}function toHex(n){return"0x"+n.toString(16).padStart("0",2).toUpperCase()}function readFileToUint8Array(file){let fr=new FileReader;return new Promise((res,rej)=>{fr.readAsArrayBuffer(file),fr.onload=evt=>{res(fr.result)},fr.onerror=rej}).then(s=>new Uint8Array(s))}async function mapFileChange(evt){try{$Q("#map-input-status-text").innerText=$Q("#map-file").files[0].name}catch(e){return void warning(getI18n("No input map!"))}try{var fileData=await readFileToUint8Array($Q("#map-file").files[0]),fileMagic=objpacker.packToUint32("<4B",fileData.slice(0,4)),dimData=(mapChkData=441536589===fileMagic?await async function(mpqData){var mpqData=await MPQ.fromArrayBuffer(mpqData),mpqPath=mpqData.filePath,chkData=mpqData.readFile("staredit\\scenario.chk");mpqData.close();try{FS.unlink(mpqPath)}catch(e){console.log(e)}return chkData}(fileData):fileData,findChunk(mapChkData,"DIM ")),dims=chkstructs.unpackDim(dimData.data),sizes=($Q("#map-size-width").innerHTML=dims.width,$Q("#map-size-height").innerHTML=dims.height,getStartLocationSizes([dims.width,dims.height])),eraData=($Q("#mmdraw-size-width").value=sizes[4],$Q("#mmdraw-size-height").value=sizes[5],findChunk(mapChkData,"ERA ")),era=7&eraData.data[0],suggestedTiles=suggestTiles(era);$Q("#tileqr-tile-0").value=toHex(suggestedTiles[0]),$Q("#tileqr-tile-1").value=toHex(suggestedTiles[1]),optionsVisible||(show($Q(".map-info")),show($Q(".function-tabs"),"grid"),optionsVisible=!0)}catch(e){warning(getI18n("Failed to read map data!"))}}function unitqrTabClick(evt){$Q("#tab-unitqr").classList.add("function-tab-selected"),$Q("#tab-tileqr").classList.remove("function-tab-selected"),$Q("#tab-mmdraw").classList.remove("function-tab-selected"),show($Q("#function-options-unitqr")),hide($Q("#function-options-tileqr")),hide($Q("#function-options-mmdraw")),selectedFunction=1}function tileqrTabClick(evt){$Q("#tab-unitqr").classList.remove("function-tab-selected"),$Q("#tab-tileqr").classList.add("function-tab-selected"),$Q("#tab-mmdraw").classList.remove("function-tab-selected"),hide($Q("#function-options-unitqr")),show($Q("#function-options-tileqr")),hide($Q("#function-options-mmdraw")),selectedFunction=2}function mmdrawTabClick(evt){$Q("#tab-unitqr").classList.remove("function-tab-selected"),$Q("#tab-tileqr").classList.remove("function-tab-selected"),$Q("#tab-mmdraw").classList.add("function-tab-selected"),hide($Q("#function-options-unitqr")),hide($Q("#function-options-tileqr")),show($Q("#function-options-mmdraw")),selectedFunction=3}function getErrorCorrectionLevel(){return 1==selectedFunction?$Q("#unitqr-ecl-l").checked?"L":$Q("#unitqr-ecl-h").checked?"H":"M":2==selectedFunction?$Q("#tileqr-ecl-l").checked?"L":$Q("#tileqr-ecl-h").checked?"H":"M":"M"}async function unitqrInputTextChange(evt){var text=$Q("#unitqr-input-text").value;await previewQR($Q("#previewer"),text,{errorCorrectionLevel:getErrorCorrectionLevel()}),$Q("#previewer").style.setProperty("width","256px"),$Q("#previewer").style.setProperty("height","256px"),downloadsVisible||(show($Q(".results"),"grid"),downloadsVisible=!0)}async function tileqrInputTextChange(evt){var text=$Q("#tileqr-input-text").value;await previewQR($Q("#previewer"),text,{errorCorrectionLevel:getErrorCorrectionLevel()}),$Q("#previewer").style.setProperty("width","256px"),$Q("#previewer").style.setProperty("height","256px"),downloadsVisible||(show($Q(".results"),"grid"),downloadsVisible=!0)}function mmdrawImageFileChange(evt){try{$Q("#mmdraw-image-status-text").innerText=$Q("#mmdraw-image-file").files[0].name}catch(e){}previewMinimapImage($Q("#mmdraw-image-file").files[0],hiddenCanvas,$Q("#previewer"),$Q("#mmdraw-size-width").value||32,$Q("#mmdraw-size-height").value||32),downloadsVisible||(show($Q(".results"),"grid"),downloadsVisible=!0)}function parseTile(t){var arr;return-1!=t.indexOf(".")?(arr=t.split("."),16*parseInt(arr[0],10)+parseInt(arr[1],10)):parseInt(t)}function saveFile(buffer,filename,linkElem){buffer=new Blob([buffer]),buffer=URL.createObjectURL(buffer);linkElem.href=buffer,linkElem.download=filename,linkElem.click()}async function saveMapOrChkClick(outputRawChk){if(mapChkData){try{var newChkData;if(1==selectedFunction){if(""==$Q("#unitqr-input-text").value)return void warning(getI18n("No input text!"));chkData=mapChkData,text=$Q("#unitqr-input-text").value,p0=parseInt($Q("#unitqr-player-0").value),p1=parseInt($Q("#unitqr-player-1").value),x=parseInt($Q("#unitqr-pos-x").value),y=parseInt($Q("#unitqr-pos-y").value),ld=!!$Q("#unitqr-layerdown").checked,newChkData=patchChkUnitQR(chkData,text,{offsetX:isNaN(x)?null:x,offsetY:isNaN(y)?null:y,player0:isNaN(p0)?6:p0,player1:isNaN(p1)?5:p1,layerDown:ld,errorCorrectionLevel:getErrorCorrectionLevel()})}else if(2==selectedFunction){if(""==$Q("#tileqr-input-text").value)return void warning(getI18n("No input text!"));newChkData=function(chkData){var text=$Q("#tileqr-input-text").value,t0=parseTile($Q("#tileqr-tile-0").value),t1=parseTile($Q("#tileqr-tile-1").value),x=parseInt($Q("#tileqr-pos-x").value),y=parseInt($Q("#tileqr-pos-y").value),size=parseInt($Q("#tileqr-size").value);return patchChkTileQR(chkData,text,{offsetX:isNaN(x)?null:x,offsetY:isNaN(y)?null:y,tile0:isNaN(t0)?64:t0,tile1:isNaN(t1)?416:t1,tileSize:size,errorCorrectionLevel:getErrorCorrectionLevel()})}(mapChkData)}else{if(3!=selectedFunction)return void warning(getI18n("No function selected!"));if(!$Q("#mmdraw-image-file").files[0])return void warning(getI18n("Please upload image file!"));newChkData=await function(chkData){$Q("#tileqr-input-text").value;var width=parseInt($Q("#mmdraw-size-width").value),height=parseInt($Q("#mmdraw-size-height").value),x=parseInt($Q("#mmdraw-pos-x").value),y=parseInt($Q("#mmdraw-pos-y").value),layerDown=!!$Q("#mmdraw-layerdown").checked,useGas=!!$Q("#mmdraw-usegas").checked;return patchChkDrawMinimap(chkData,$Q("#mmdraw-image-file").files[0],{canvas:hiddenCanvas,offsetX:isNaN(x)?null:x,offsetY:isNaN(y)?null:y,width:isNaN(width)?null:width,height:isNaN(height)?null:height,useGas:useGas,layerDown:layerDown})}(mapChkData)}}catch(e){return void warning(getI18n("Cannot apply function!"))}var chkData,text,p0,p1,x,y,ld;if(newChkData){if(outputRawChk)try{return void saveFile(newChkData,"scenario.chk",downloadLink)}catch(e){return void warning(getI18n("Cannot save file!"))}try{var fileData=await readFileToUint8Array($Q("#map-file").files[0]);if(441536589===objpacker.packToUint32("<4B",fileData.slice(0,4))){var newMpq=await async function(origMpqData,chkData){return(await MPQ.fromArrayBuffer(origMpqData)).addFileFromArrayBuffer("staredit\\scenario.chk",chkData,{compression:["pkware"],encrypt:!0,fixKey:!1,replace:!0}).compact()}(fileData,newChkData),newMpqData=newMpq.toArrayBuffer();newMpq.close();try{FS.unlink(newMpq.filePath)}catch(e){}}else{var createdMpq=await async function(chkData){return(await MPQ.create(`temp_scqr_${Math.floor(1e5*Math.random())}.mpq`,{version:1,fileFlagsListfile:{compression:["pkware"],encrypt:!0,fixKey:!1},fileFlagsAttributes:{},fileFlagsSignature:{}})).addFileFromArrayBuffer("staredit\\scenario.chk",chkData,{compression:["pkware"],encrypt:!0,fixKey:!1,replace:!0}).compact()}(newChkData);newMpqData=createdMpq.toArrayBuffer(),createdMpq.close();try{FS.unlink(createdMpq.filePath)}catch(e){}}if(!newMpqData)throw new Error("localError")}catch(e){return void warning(getI18n("Error! cannot pack map as MPQ (try saving as CHK)"))}try{saveFile(newMpqData,$Q("#map-file").files[0].name.replace(".chk",".scx"),downloadLink)}catch(e){warning(getI18n("Cannot save file!"))}}else warning(getI18n("Unknown error! cannot convert map"))}else warning(getI18n("No map data! load map from input first"))}function saveMapClick(evt){saveMapOrChkClick(!1)}function saveChkClick(evt){saveMapOrChkClick(!0)}window.init=function(){hiddenCanvas=document.getElementById("hidden-canvas").getContext("2d"),downloadLink=document.getElementById("save-link");var canvasElem=document.getElementById("night-sky"),canvasElem=(drawStars(canvasElem.getContext("2d"),canvasElem.width,canvasElem.height),attachBubbleHintEvent($Q("#label-unitqr-pos"),$Q("#bubble-hint-unitqr-pos")),attachBubbleHintEvent($Q("#label-unitqr-layerdown"),$Q("#bubble-hint-unitqr-layer-down")),attachBubbleHintEvent($Q("#label-tileqr-tiles"),$Q("#bubble-hint-tileqr-tiles")),attachBubbleHintEvent($Q("#label-tileqr-pos"),$Q("#bubble-hint-tileqr-pos")),attachBubbleHintEvent($Q("#label-mmdraw-image"),$Q("#bubble-hint-mmdraw-image")),attachBubbleHintEvent($Q("#label-mmdraw-size"),$Q("#bubble-hint-mmdraw-size")),attachBubbleHintEvent($Q("#label-mmdraw-pos"),$Q("#bubble-hint-mmdraw-pos")),attachBubbleHintEvent($Q("#label-mmdraw-layerdown"),$Q("#bubble-hint-mmdraw-layerdown")),attachBubbleHintEvent($Q("#label-mmdraw-usegas"),$Q("#bubble-hint-mmdraw-usegas")),$Q("#mmdraw-image-file").addEventListener("change",mmdrawImageFileChange),$Q("#map-file").addEventListener("change",mapFileChange),$Q("#unitqr-input-text").addEventListener("change",unitqrInputTextChange),$Q("#tileqr-input-text").addEventListener("change",tileqrInputTextChange),$Q("#tab-unitqr").addEventListener("click",unitqrTabClick),$Q("#tab-tileqr").addEventListener("click",tileqrTabClick),$Q("#tab-mmdraw").addEventListener("click",mmdrawTabClick),$Q("#download-map").addEventListener("click",saveMapClick),$Q("#download-chk").addEventListener("click",saveChkClick),$Q("#link-change-language").addEventListener("click",evt=>{var locale=changeLocale();document.body.lang=locale}),autoSetLocale());document.body.lang=canvasElem}},{"./chkstructs":35,"./chunkfind":36,"./i18n":38,"./minimapdraw":40,"./objpacker":42,"./scqr":43,"./starsky":44}],40:[function(require,module,exports){"use strict";const chkstructs=require("./chkstructs"),{findChunk,replaceChunk}=require("./chunkfind"),{getStartLocationSizes,mergeUnits,mergeUnitsLayerDown,createStartLocation,createUnitObject,validateUnitSection}=require("./scqr"),findNearestColorIndex=require("./nearestcolor")["findNearestColorIndex"],playerColors=[[244,4,4],[12,72,204],[44,180,148],[136,64,156],[248,140,20],[112,48,20],[204,224,208],[252,252,56],[8,128,8],[252,252,124],[236,196,176],[64,104,212]],resourceColor=[0,228,252];async function getImageFileData(imgFile,canvas,options){let width,height,fr=new FileReader;var loadedImage=await new Promise((res,rej)=>{fr.readAsDataURL(imgFile),fr.onload=evt=>{let im=new Image;im.src=fr.result,im.addEventListener("load",evt=>{width=options.width||im.width,height=options.height||im.height,res(im)}),im.addEventListener("error",rej)},fr.onerror=rej});return canvas.drawImage(loadedImage,0,0,width,height),Array.from(canvas.getImageData(0,0,width,height).data)}function approxPlayerColors(colors,useResource){let approxColors=[[0,0,0]].concat(playerColors),resourceIndex=playerColors.length+1;return useResource&&(approxColors=approxColors.concat([resourceColor])),colors.map(row=>row.map(color=>{color=findNearestColorIndex(color,approxColors);return 0==color?-1:color==resourceIndex?-2:color-1}))}function applyPlayerColors(pColors){return pColors.map(row=>row.map(pColor=>-1==pColor?[0,0,0]:-2==pColor?resourceColor:playerColors[pColor]))}function createGas(x,y){return createUnitObject(188,10,x,y)}function chunkize(array,n){return array.reduce((r,e,i)=>(i%n?r[r.length-1].push(e):r.push([e]))&&r,[])}module.exports={patchChkDrawMinimap:async function(chkData,imageFile,options={}){var dimData=findChunk(chkData,"DIM "),dimData=chkstructs.unpackDim(dimData.data),sizeParams=getStartLocationSizes([dimData.width,dimData.height]),width=options.width||sizeParams[4],sizeParams=options.height||sizeParams[5],useGas=options.useGas,imageFile=chunkize(await getImageFileData(imageFile,options.canvas,{width:width,height:sizeParams}),4),imageFile=(sizeParams=function(pColors,dims,options){var[,,unitSizeX,unitSizeY,maxX,maxY]=getStartLocationSizes(dims),out=[],outGas=[],offsetX=options.offsetX||0,offsetY=options.offsetX||0;for(let i=0;i<maxY&&i<pColors.length;i++)for(let j=0;j<maxX&&j<pColors[0].length;j++){var playerID=pColors[i][j];if(-1!=playerID)if(-2==playerID){var playerID=Math.round(offsetX+(j+.5)*unitSizeX),y1=Math.round(offsetY+(i+.5)*unitSizeY-16),y2=Math.round(offsetY+(i+.5)*unitSizeY+16);outGas.push(createGas(playerID,y1)),outGas.push(createGas(playerID,y2))}else{let x=Math.round(offsetX+(j+.5)*unitSizeX);y1=Math.round(offsetY+(i+.5)*unitSizeY);out.push(createStartLocation(pColors[i][j],x,y1))}}return[out,outGas]}(approxPlayerColors(chunkize(imageFile,width),useGas),[dimData.width,dimData.height],{offsetX:options.offsetX,offsetY:options.offsetY}))[0],width=sizeParams[1],useGas=findChunk(chkData,"UNIT",validateUnitSection),dimData=chkstructs.unpackAllUnits(useGas.data),useGas=(sizeParams=options.layerDown?mergeUnitsLayerDown(dimData,imageFile,[]):mergeUnits(imageFile,dimData),sizeParams=mergeUnits(sizeParams,width),chkstructs.packAllUnits(sizeParams));return replaceChunk(chkData,"UNIT",useGas,validateUnitSection)},previewMinimapImage:async function(imageFile,canvas,outputCanvasElem,width,height){var imageFile=chunkize(await getImageFileData(imageFile,canvas,{width:width,height:height}),4),canvas=applyPlayerColors(approxPlayerColors(chunkize(imageFile,width),!1)).map(s=>s.reduce((a,b)=>a.concat(b).concat([255]),[])).reduce((a,b)=>a.concat(b),[]),imageFile=outputCanvasElem.offsetWidth,_canvasH=outputCanvasElem.offsetHeight,size=Math.max(width,height),xPos=Math.floor((size-width)/2),yPos=Math.floor((size-height)/2);outputCanvasElem.width=size,outputCanvasElem.height=size,outputCanvasElem.style.setProperty("width",imageFile+"px"),outputCanvasElem.style.setProperty("height",_canvasH+"px");(imageFile=outputCanvasElem.getContext("2d")).fillStyle="rgb(0, 0, 0)",imageFile.fillRect(0,0,size,size),_canvasH=new ImageData(new Uint8ClampedArray(canvas),width,height);imageFile.putImageData(_canvasH,xPos,yPos)}}},{"./chkstructs":35,"./chunkfind":36,"./nearestcolor":41,"./scqr":43}],41:[function(require,module,exports){"use strict";const ColorJs=require("./color");function toColorJs(rgbArray){return new ColorJs("srgb",rgbArray.map(x=>x/255))}exports.findNearestColor=function(color,colorList){let scores=[];const colorComp=toColorJs(color);return colorList.map(toColorJs).forEach((c,i)=>{scores.push([i,c.deltaE2000(colorComp)])}),colorList[(scores=scores.sort((a,b)=>a[1]-b[1]))[0][0]]},exports.findNearestColorIndex=function(color,colorList){let scores=[];const colorComp=toColorJs(color);return colorList.map(toColorJs).forEach((c,i)=>{scores.push([i,c.deltaE2000(colorComp)])}),(scores=scores.sort((a,b)=>a[1]-b[1]))[0][0]}},{"./color":37}],42:[function(require,module,exports){"use strict";const bufferpack=require("bufferpack");module.exports={unpack:function(pattern,objKeys,buffer){let unpacked=bufferpack.unpack(pattern,buffer),out={},p=0;return objKeys.forEach(key=>{var n;/\[.*\]/.test(key)?(n=parseInt(key.match(/\[(.*)\]/)[1]),out[key.replace(/\[.*\]/g,"")]=unpacked.slice(p,p+n),p+=n):(out[key]=unpacked[p],p++)}),out},pack:function(pattern,objKeys,obj){let a=[];return objKeys.forEach(key=>{/\[.*\]/.test(key)?(parseInt(key.match(/\[(.*)\]/)[1]),a=a.concat(out[key.replace(/\[.*\]/g,"")])):a.push(obj[key])}),bufferpack.pack(pattern,a)},packToUint32:function(pattern,values){return pattern=bufferpack.pack(pattern,values),bufferpack.unpack("<I",pattern)[0]},unpackFlags:function(binFlags,flagIdentifiers,truncated=!1){let out={};return flagIdentifiers.forEach((key,i)=>{truncated?binFlags&1<<i&&(out[key]=!0):out[key]=!!(binFlags&1<<i)}),out},packFlags:function(objFlags,flagIdentifiers){let out=0;return flagIdentifiers.forEach((key,i)=>{objFlags[key]&&(out|=1<<i)}),out}}},{bufferpack:4}],43:[function(require,module,exports){"use strict";const QRCode=require("qrcode"),chkstructs=require("./chkstructs"),{findChunk,replaceChunk}=require("./chunkfind");function createQRData(qrText,qrParams){var qrText=QRCode.create(qrText,qrParams),out=[],data=qrText.modules.data,size=qrText.modules.size;for(let i=0;i<size;i++)out.push(Array.from(data.slice(i*size,(i+1)*size)));return out}function setTile(tileArray,newTileArray,offsetX=0,offsetY=0){for(let i=0;i<newTileArray.length&&i+offsetY<tileArray.length;i++)for(let j=0;j<newTileArray[0].length&&j+offsetX<tileArray[0].length;j++)tileArray[i+offsetY][j+offsetX]=newTileArray[i][j];return tileArray}function getQRTiles(qrText,qrParams){let tile0=qrParams.tile0,tile1=qrParams.tile1;var n,size=qrParams.tileSize;let qrTiles=createQRData(qrText,qrParams).map(row=>row.map(item=>item?tile1:tile0));return qrTiles=1<size?(qrText=qrTiles,n=size,qrText.map(row=>row.map(val=>Array(n).fill(val)).reduce((t,a)=>t.concat(a),[])).map(row=>Array(n).fill(row)).reduce((t,a)=>t.concat(a),[])):qrTiles}function createUnitObject(unitID,player,x,y){return{classInstance:Math.floor(2147483647*Math.random()),x:x,y:y,unitID:unitID,relation:{},validFlags:{hallucinated:!0,invincible:!0},validProps:{owner:!0},player:player,hp:100,sp:0,energy:0,resources:0,hangar:0,stateFlags:{},relationCI:0}}function createStartLocation(player,x,y){return createUnitObject(214,player,x,y)}function mergeUnitsLayerDown(origUnits,qrUnits,usedPlayers){var sLocsToMoveFront=origUnits.filter(u=>214===u.unitID&&usedPlayers.every(p=>p!=u)),origUnits=origUnits.filter(u=>214!==u.unitID||!usedPlayers.every(p=>p!=u)),sLocsToMoveFront=mergeUnits(sLocsToMoveFront,qrUnits);return mergeUnits(sLocsToMoveFront,origUnits)}function mergeUnits(units1,units2){return units1.concat(units2)}function getStartLocationSizes(mapSize){var s=Math.max(mapSize[0],mapSize[1]),s=s<=64?48:s<=96?64:s<=128?96:128;return[32*mapSize[0],32*mapSize[1],s,s,Math.floor(32*mapSize[0]/s),Math.floor(32*mapSize[1]/s)]}function validateUnitSection(len,buf){return len%36==0&&len<36e5}module.exports={patchChkTileQR:function(chkData,qrText,qrParams={}){var qrText=getQRTiles(qrText,{tile0:null!=(qrText=qrParams.tile0)?qrText:64,tile1:null!=(qrText=qrParams.tile1)?qrText:416,tileSize:null!=(qrText=qrParams.tileSize)?qrText:2}),dimData=findChunk(chkData,"DIM "),dimData=chkstructs.unpackDim(dimData.data),_qrParams$offsetX=null!=(_qrParams$offsetX=qrParams.offsetX)?_qrParams$offsetX:dimData.width-qrText[0].length>>1,qrParams=null!=(qrParams=qrParams.offsetY)?qrParams:dimData.height-qrText.length>>1,tileData=findChunk(chkData,"MTXM"),tileData=setTile(chkstructs.unpackTile(tileData.data,[dimData.width,dimData.height]),qrText,_qrParams$offsetX,qrParams),tileData=chkstructs.packTile(tileData);let newBuffer=replaceChunk(chkData,"MTXM",tileData);try{var tileDataSE=findChunk(chkData,"TILE"),tilesSE=setTile(chkstructs.unpackTile(tileDataSE.data,[dimData.width,dimData.height]),qrText,_qrParams$offsetX,qrParams),repackedTilesSE=chkstructs.packTile(tilesSE);newBuffer=replaceChunk(newBuffer,"TILE",repackedTilesSE)}catch(e){}return newBuffer},patchChkUnitQR:function(chkData,qrText,qrParams={}){var dimData=findChunk(chkData,"DIM "),dimData=chkstructs.unpackDim(dimData.data),_qrParams$player=(qrParams.player0=null!=(_qrParams$player=qrParams.player0)?_qrParams$player:6,qrParams.player1=null!=(_qrParams$player=qrParams.player1)?_qrParams$player:5,getStartLocationSizes([dimData.width,dimData.height])),dimData=(qrParams.mapSize=[_qrParams$player[0],_qrParams$player[1]],qrParams.unitSize=_qrParams$player[2],function(qrText,qrParams){var l,r,t,b,unitSizeX,unitSizeY,qrData=createQRData(qrText,qrParams),player0=qrParams.player0,player1=qrParams.player1,qrText=qrData.length,defUnitSize=qrParams.unitSize||96,mapSize=qrParams.mapSize,out=(qrParams.offsetX&&qrParams.offsetY?(r=(l=qrParams.offsetX)+(unitSizeX=defUnitSize)*qrText,t=qrParams.offsetY,b+=(unitSizeY=defUnitSize)*qrText):mapSize[0]<=defUnitSize*qrText||mapSize[1]<=defUnitSize*qrText?(r=mapSize[0]-(l=64),b=mapSize[1]-(t=64),unitSizeX=Math.round((r-l)/(qrData[0].length-1)),unitSizeY=Math.round((b-t)/(qrData.length-1))):(l=mapSize[0]-(unitSizeY=unitSizeX=defUnitSize)*qrText>>1,r=mapSize[0]-l,t=mapSize[1]-defUnitSize*qrText>>1,b=mapSize[1]-t),[]);for(let i=0;i<qrData.length;i++)for(let j=0;j<qrData[0].length;j++){var x=l+j*unitSizeX,y=t+i*unitSizeY;out.push(createStartLocation(qrData[i][j]?player1:player0,x,y))}return out}(qrText,qrParams).sort((a,b)=>a.x-b.x)),_qrParams$player=findChunk(chkData,"UNIT",validateUnitSection),qrText=chkstructs.unpackAllUnits(_qrParams$player.data),qrParams=(_qrParams$player=qrParams.layerDown?mergeUnitsLayerDown(qrText,dimData,[qrParams.player0,qrParams.player1]):mergeUnits(dimData,qrText),chkstructs.packAllUnits(_qrParams$player));return replaceChunk(chkData,"UNIT",qrParams,validateUnitSection)},previewQR:function(canvasElem,qrText,qrParams){QRCode.toCanvas(canvasElem,qrText,qrParams)},getStartLocationSizes:getStartLocationSizes,mergeUnits:mergeUnits,mergeUnitsLayerDown:mergeUnitsLayerDown,createStartLocation:createStartLocation,createUnitObject:createUnitObject,validateUnitSection:validateUnitSection,suggestTiles:function(tileset){return[[128,256],[96,256],[32,128],[192,32],[192,416],[128,416],[64,288],[128,416]][tileset]}}},{"./chkstructs":35,"./chunkfind":36,qrcode:7}],44:[function(require,module,exports){"use strict";module.exports.drawStars=function(canvas,w,h){for(let i=0;i<1e3;i++)canvas.beginPath(),canvas.fillStyle=`rgb(${Math.floor(32*Math.random()+224)}, ${Math.floor(32*Math.random()+224)}, ${Math.floor(16*Math.random()+240)})`,canvas.arc(Math.floor(Math.random()*w),Math.floor(Math.random()*h),2*Math.random(),0,2*Math.PI),canvas.fill()}},{}]},{},[39]);
