!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var p="function"==typeof require&&require;if(!f&&p)return p(i,!0);if(u)return u(i,!0);throw(p=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",p}p=n[i]={exports:{}},e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";exports.byteLength=function(validLen){var placeHoldersLen=getLens(validLen),validLen=placeHoldersLen[0],placeHoldersLen=placeHoldersLen[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function(b64){var tmp,i,placeHoldersLen=getLens(b64),validLen=placeHoldersLen[0],placeHoldersLen=placeHoldersLen[1],arr=new Arr(function(validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(validLen,placeHoldersLen)),curByte=0,len=0<placeHoldersLen?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(function(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(function(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}(tmp));return output.join("")}(uint8,i,len2<i+16383?len2:i+16383));1==extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2==extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(validLen){var len=validLen.length;if(0<len%4)throw new Error("Invalid string. Length must be a multiple of 4");validLen=validLen.indexOf("=");return[validLen=-1===validLen?len:validLen,validLen===len?0:4-validLen%4]}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],2:[function(require,module,exports){!function(Buffer){!function(){"use strict";var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;function createBuffer(buf){if(K_MAX_LENGTH<buf)throw new RangeError('The value "'+buf+'" is invalid for option "size"');buf=new Uint8Array(buf);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"!=typeof arg)return from(arg,encodingOrOffset,length);if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}function from(value,encodingOrOffset,length){if("string"==typeof value)return function(string,actual){"string"==typeof actual&&""!==actual||(actual="utf8");if(!Buffer.isEncoding(actual))throw new TypeError("Unknown encoding: "+actual);var length=0|byteLength(string,actual),buf=createBuffer(length),actual=buf.write(string,actual);actual!==length&&(buf=buf.slice(0,actual));return buf}(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return function(array,byteOffset,buf){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(buf||0))throw new RangeError('"length" is outside of buffer bounds');buf=void 0===byteOffset&&void 0===buf?new Uint8Array(array):void 0===buf?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,buf);return buf.__proto__=Buffer.prototype,buf}(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var b=value.valueOf&&value.valueOf();if(null!=b&&b!==value)return Buffer.from(b,encodingOrOffset,length);b=function(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}if(void 0!==obj.length)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}(value);if(b)return b;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function checked(length){if(K_MAX_LENGTH<=length)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=2<arguments.length&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((start=void 0===start||start<0?0:start)>this.length)return"";if((end=void 0===end||end>this.length?this.length:end)<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding=encoding||"utf8";;)switch(encoding){case"hex":return function(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0);(!end||end<0||len<end)&&(end=len);for(var out="",i=start;i<end;++i)out+=function(n){return n<16?"0"+n.toString(16):n.toString(16)}(buf[i]);return out}(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}(this,start,end);case"latin1":case"binary":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}(this,start,end);case"base64":return function(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):2147483647<byteOffset?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),(byteOffset=(byteOffset=numberIsNaN(byteOffset=+byteOffset)?dir?0:buffer.length-1:byteOffset)<0?buffer.length+byteOffset:byteOffset)>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?(dir?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;arrLength/=indexSize=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir)for(var foundIndex=-1,i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(i-(foundIndex=-1===foundIndex?i:foundIndex)+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1;else for(i=byteOffset=arrLength<byteOffset+valLength?arrLength-valLength:byteOffset;0<=i;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)lo=str.charCodeAt(i),hi=lo>>8,lo=lo%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=239<firstByte?4:223<firstByte?3:191<firstByte?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&127<(tempCodePoint=(31&firstByte)<<6|63&secondByte)&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&2047<(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)&&(tempCodePoint<55296||57343<tempCodePoint)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&65535<(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):65535<codePoint&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}exports.kMaxLength=K_MAX_LENGTH,(Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=from,Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return assertSize(size),!(size<=0)&&void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)},Buffer.allocUnsafe=allocUnsafe,Buffer.allocUnsafeSlow=allocUnsafe,Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);if(void 0===length)for(i=length=0;i<list.length;++i)length+=list[i].length;for(var buffer=Buffer.allocUnsafe(length),pos=0,i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toLocaleString=Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES,str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();return this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),(start=void 0===start?0:start)<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisEnd<=thisStart&&end<=start)return 0;if(thisEnd<=thisStart)return-1;if(end<=start)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||remaining<length)&&(length=remaining),0<string.length&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding=encoding||"utf8";for(var loweredCase=!1;;)switch(encoding){case"hex":return function(buf,string,offset,length){offset=Number(offset)||0;var strLen=buf.length-offset;(!length||strLen<(length=Number(length)))&&(length=strLen),(strLen=string.length)/2<length&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}(this,string,offset,length);case"utf8":case"utf-8":return function(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return asciiWrite(this,string,offset,length);case"base64":return function(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(length<offset+ext)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(max<value||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,newBuf){var len=this.length;(start=~~start)<0?(start+=len)<0&&(start=0):len<start&&(start=len),(newBuf=void 0===newBuf?len:~~newBuf)<0?(newBuf+=len)<0&&(newBuf=0):len<newBuf&&(newBuf=len),newBuf<start&&(newBuf=start);newBuf=this.subarray(start,newBuf);return newBuf.__proto__=Buffer.prototype,newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;0<byteLength&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];0<i&&(mul*=256);)val+=this[offset+--i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(val,noAssert){val>>>=0,noAssert||checkOffset(val,2,this.length);val=this[val]|this[val+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(val,noAssert){val>>>=0,noAssert||checkOffset(val,2,this.length);val=this[val+1]|this[val]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,limit){value=+value,offset>>>=0,limit||checkInt(this,value,offset,byteLength,(limit=Math.pow(2,8*byteLength-1))-1,-limit);var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,limit){value=+value,offset>>>=0,limit||checkInt(this,value,offset,byteLength,(limit=Math.pow(2,8*byteLength-1))-1,-limit);var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),this[offset]=255&(value=value<0?255+value+1:value),offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=(value=value<0?4294967295+value+1:value)>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start=start||0,end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),(end=0<end&&end<start?start:end)===start)return 0;if(0===target.length||0===this.length)return 0;if((targetStart=targetStart||0)<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length);var len=(end=target.length-targetStart<end-start?target.length-targetStart+start:end)-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;0<=i;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var code;1===val.length&&(code=val.charCodeAt(0),("utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code))}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,"number"==typeof(val=val||0))for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(55295<(codePoint=string.charCodeAt(i))&&codePoint<57344){if(!leadSurrogate){if(56319<codePoint){-1<(units-=3)&&bytes.push(239,191,189);continue}if(i+1===length){-1<(units-=3)&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){-1<(units-=3)&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&-1<(units-=3)&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if(--units<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}}.call(this)}.call(this,require("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:3}],3:[function(require,module,exports){exports.read=function(buffer,offset,s,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=s?nBytes-1:0,d=s?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;0<nBits;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;0<nBits;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,c,mLen,s){var e,m,eLen=8*s-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=c?0:s-1,d=c?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),2<=(value+=1<=e+eBias?rt/c:rt*Math.pow(2,1-eBias))*c&&(e++,c/=2),eMax<=e+eBias?(m=0,e=eMax):1<=e+eBias?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));8<=mLen;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;0<eLen;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],4:[function(require,module,exports){!function(Buffer){!function(){module.exports=new function(){var el,bBE=!1,m=this;m._DeArray=function(a,p,l){return[a.slice(p,p+l)]},m._EnArray=function(a,p,l,v){for(var i=0;i<l;a[p+i]=v[i]||0,i++);},m._DeChar=function(a,p){return String.fromCharCode(a[p])},m._EnChar=function(a,p,v){a[p]=v.charCodeAt(0)},m._DeInt=function(a,p){for(var lsb=bBE?el.len-1:0,nsb=bBE?-1:1,stop=lsb+nsb*el.len,rv=0,i=lsb,f=1;i!=stop;rv+=a[p+i]*f,i+=nsb,f*=256);return el.bSigned&&rv&Math.pow(2,8*el.len-1)&&(rv-=Math.pow(2,8*el.len)),rv},m._EnInt=function(a,p,v){var i,lsb=bBE?el.len-1:0,nsb=bBE?-1:1,stop=lsb+nsb*el.len;for(v=v<el.min?el.min:v>el.max?el.max:v,i=lsb;i!=stop;a[p+i]=255&v,i+=nsb,v>>=8);},m._DeString=function(a,p,l){for(var rv=new Array(l),i=0;i<l;rv[i]=String.fromCharCode(a[p+i]),i++);return rv.join("")},m._EnString=function(a,p,l,v){for(var t,i=0;i<l;a[p+i]=(t=v.charCodeAt(i))?t:0,i++);},m._DeNullString=function(a,p,l,str){str=m._DeString(a,p,l,str);return str.substring(0,str.length-1)},m._De754=function(a,p){var e,m,nBits,mLen=el.mLen,eLen=8*el.len-el.mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,i=bBE?0:el.len-1,d=bBE?1:-1,s=a[p+i];for(i+=d,e=s&(1<<-(nBits=-7))-1,s>>=-nBits,nBits+=eLen;0<nBits;e=256*e+a[p+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;0<nBits;m=256*m+a[p+i],i+=d,nBits-=8);switch(e){case 0:e=1-eBias;break;case eMax:return m?NaN:1/0*(s?-1:1);default:m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},m._En754=function(a,p,v){var e,m,i,d,c,mLen=el.mLen,eLen=8*el.len-el.mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,s=v<0?1:0;for(v=Math.abs(v),isNaN(v)||v==1/0?(m=isNaN(v)?1:0,e=eMax):(e=Math.floor(Math.log(v)/Math.LN2),v*(c=Math.pow(2,-e))<1&&(e--,c*=2),2<=(v+=1<=e+eBias?el.rt/c:el.rt*Math.pow(2,1-eBias))*c&&(e++,c/=2),eMax<=e+eBias?(m=0,e=eMax):1<=e+eBias?(m=(v*c-1)*Math.pow(2,mLen),e+=eBias):(m=v*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0)),i=bBE?el.len-1:0,d=bBE?-1:1;8<=mLen;a[p+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;0<eLen;a[p+i]=255&e,i+=d,e/=256,eLen-=8);a[p+i-d]|=128*s},m._sPattern="(\\d+)?([AxcbBhHsSfdiIlL])(\\(([a-zA-Z0-9]+)\\))?",m._lenLut={A:1,x:1,c:1,b:1,B:1,h:2,H:2,s:1,S:1,f:4,d:8,i:4,I:4,l:4,L:4},m._elLut={A:{en:m._EnArray,de:m._DeArray},s:{en:m._EnString,de:m._DeString},S:{en:m._EnString,de:m._DeNullString},c:{en:m._EnChar,de:m._DeChar},b:{en:m._EnInt,de:m._DeInt,len:1,bSigned:!0,min:-Math.pow(2,7),max:Math.pow(2,7)-1},B:{en:m._EnInt,de:m._DeInt,len:1,bSigned:!1,min:0,max:Math.pow(2,8)-1},h:{en:m._EnInt,de:m._DeInt,len:2,bSigned:!0,min:-Math.pow(2,15),max:Math.pow(2,15)-1},H:{en:m._EnInt,de:m._DeInt,len:2,bSigned:!1,min:0,max:Math.pow(2,16)-1},i:{en:m._EnInt,de:m._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},I:{en:m._EnInt,de:m._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},l:{en:m._EnInt,de:m._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},L:{en:m._EnInt,de:m._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},f:{en:m._En754,de:m._De754,len:4,mLen:23,rt:Math.pow(2,-24)-Math.pow(2,-77)},d:{en:m._En754,de:m._De754,len:8,mLen:52,rt:0}},m._UnpackSeries=function(n,s,a,p){for(var fxn=el.de,rv=[],i=0;i<n;rv.push(fxn(a,p+i*s)),i++);return rv},m._PackSeries=function(n,s,a,p,v,i){for(var fxn=el.en,o=0;o<n;fxn(a,p+o*s,v[i+o]),o++);},m._zip=function(keys,values){for(var result={},i=0;i<keys.length;i++)result[keys[i]]=values[i];return result},m.unpack=function(fmt,a,p){bBE="<"!=fmt.charAt(0),p=p||0;for(var m,n,s,re=new RegExp(this._sPattern,"g"),rk=[],rv=[];m=re.exec(fmt);){if(n=null==m[1]||""==m[1]?1:parseInt(m[1]),"S"===m[2]){for(n=0;0!==a[p+n];)n++;n++}if(p+n*(s=this._lenLut[m[2]])>a.length)return;switch(m[2]){case"A":case"s":case"S":rv.push(this._elLut[m[2]].de(a,p,n));break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":el=this._elLut[m[2]],rv.push(this._UnpackSeries(n,s,a,p))}rk.push(m[4]),p+=n*s}return rv=Array.prototype.concat.apply([],rv),-1!==rk.indexOf(void 0)?rv:this._zip(rk,rv)},m.packTo=function(fmt,a,p,values){bBE="<"!=fmt.charAt(0);for(var m,n,s,j,re=new RegExp(this._sPattern,"g"),i=0;m=re.exec(fmt);){if(n=null==m[1]||""==m[1]?1:parseInt(m[1]),p+(n="S"===m[2]?values[i].length+1:n)*(s=this._lenLut[m[2]])>a.length)return!1;switch(m[2]){case"A":case"s":case"S":if(i+1>values.length)return!1;this._elLut[m[2]].en(a,p,n,values[i]),i+=1;break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":if(el=this._elLut[m[2]],i+n>values.length)return!1;this._PackSeries(n,s,a,p,values,i),i+=n;break;case"x":for(j=0;j<n;j++)a[p+j]=0}p+=n*s}return a},m.pack=function(fmt,values){return this.packTo(fmt,new Buffer(this.calcLength(fmt,values)),0,values)},m.calcLength=function(format,values){for(var m,re=new RegExp(this._sPattern,"g"),sum=0,i=0;m=re.exec(format);){var n=(null==m[1]||""==m[1]?1:parseInt(m[1]))*this._lenLut[m[2]];sum+=n="S"===m[2]?values[i].length+1:n,i++}return sum}}}.call(this)}.call(this,require("buffer").Buffer)},{buffer:2}],5:[function(require,module,exports){"use strict";var dijkstra={single_source_shortest_paths:function(graph,s,msg){var predecessors={},costs={};costs[s]=0;var closest,u,v,cost_of_s_to_u,adjacent_nodes,cost_of_s_to_u_plus_cost_of_e,cost_of_s_to_v,open=dijkstra.PriorityQueue.make();for(open.push(s,0);!open.empty();)for(v in u=(closest=open.pop()).value,cost_of_s_to_u=closest.cost,adjacent_nodes=graph[u]||{})adjacent_nodes.hasOwnProperty(v)&&(cost_of_s_to_u_plus_cost_of_e=cost_of_s_to_u+adjacent_nodes[v],cost_of_s_to_v=costs[v],(void 0===costs[v]||cost_of_s_to_u_plus_cost_of_e<cost_of_s_to_v)&&(costs[v]=cost_of_s_to_u_plus_cost_of_e,open.push(v,cost_of_s_to_u_plus_cost_of_e),predecessors[v]=u));if(void 0===msg||void 0!==costs[msg])return predecessors;msg=["Could not find a path from ",s," to ",msg,"."].join("");throw new Error(msg)},extract_shortest_path_from_predecessor_list:function(predecessors,d){for(var nodes=[],u=d;u;)nodes.push(u),predecessors[u],u=predecessors[u];return nodes.reverse(),nodes},find_path:function(graph,predecessors,d){predecessors=dijkstra.single_source_shortest_paths(graph,predecessors,d);return dijkstra.extract_shortest_path_from_predecessor_list(predecessors,d)},PriorityQueue:{make:function(opts){var key,T=dijkstra.PriorityQueue,t={};for(key in opts=opts||{},T)T.hasOwnProperty(key)&&(t[key]=T[key]);return t.queue=[],t.sorter=opts.sorter||T.default_sorter,t},default_sorter:function(a,b){return a.cost-b.cost},push:function(value,cost){this.queue.push({value:value,cost:cost}),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};void 0!==module&&(module.exports=dijkstra)},{}],6:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],7:[function(require,module,exports){var canPromise=require("./can-promise"),QRCode=require("./core/qrcode"),CanvasRenderer=require("./renderer/canvas"),SvgRenderer=require("./renderer/svg-tag.js");function renderCanvas(renderFunc,canvas,text,opts,cb){var isLastArgCb=[].slice.call(arguments,1),argsNum=isLastArgCb.length,isLastArgCb="function"==typeof isLastArgCb[argsNum-1];if(!isLastArgCb&&!canPromise())throw new Error("Callback required as last argument");if(!isLastArgCb){if(argsNum<1)throw new Error("Too few arguments provided");return 1===argsNum?(text=canvas,canvas=opts=void 0):2!==argsNum||canvas.getContext||(opts=text,text=canvas,canvas=void 0),new Promise(function(resolve,reject){try{var data=QRCode.create(text,opts);resolve(renderFunc(data,canvas,opts))}catch(e){reject(e)}})}if(argsNum<2)throw new Error("Too few arguments provided");2===argsNum?(cb=text,text=canvas,canvas=opts=void 0):3===argsNum&&(canvas.getContext&&void 0===cb?(cb=opts,opts=void 0):(cb=opts,opts=text,text=canvas,canvas=void 0));try{var data=QRCode.create(text,opts);cb(null,renderFunc(data,canvas,opts))}catch(e){cb(e)}}exports.create=QRCode.create,exports.toCanvas=renderCanvas.bind(null,CanvasRenderer.render),exports.toDataURL=renderCanvas.bind(null,CanvasRenderer.renderToDataURL),exports.toString=renderCanvas.bind(null,function(data,_,opts){return SvgRenderer.render(data,opts)})},{"./can-promise":8,"./core/qrcode":24,"./renderer/canvas":31,"./renderer/svg-tag.js":32}],8:[function(require,module,exports){module.exports=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}},{}],9:[function(require,module,exports){var getSymbolSize=require("./utils").getSymbolSize;exports.getRowColCoords=function(size){if(1===size)return[];for(var posCount=Math.floor(size/7)+2,size=getSymbolSize(size),intervals=145===size?26:2*Math.ceil((size-13)/(2*posCount-2)),positions=[size-7],i=1;i<posCount-1;i++)positions[i]=positions[i-1]-intervals;return positions.push(6),positions.reverse()},exports.getPositions=function(version){for(var coords=[],pos=exports.getRowColCoords(version),posLength=pos.length,i=0;i<posLength;i++)for(var j=0;j<posLength;j++)0===i&&0===j||0===i&&j===posLength-1||i===posLength-1&&0===j||coords.push([pos[i],pos[j]]);return coords}},{"./utils":28}],10:[function(require,module,exports){var Mode=require("./mode"),ALPHA_NUM_CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function AlphanumericData(data){this.mode=Mode.ALPHANUMERIC,this.data=data}AlphanumericData.getBitsLength=function(length){return 11*Math.floor(length/2)+length%2*6},AlphanumericData.prototype.getLength=function(){return this.data.length},AlphanumericData.prototype.getBitsLength=function(){return AlphanumericData.getBitsLength(this.data.length)},AlphanumericData.prototype.write=function(bitBuffer){for(var i=0;i+2<=this.data.length;i+=2){var value=45*ALPHA_NUM_CHARS.indexOf(this.data[i]);value+=ALPHA_NUM_CHARS.indexOf(this.data[i+1]),bitBuffer.put(value,11)}this.data.length%2&&bitBuffer.put(ALPHA_NUM_CHARS.indexOf(this.data[i]),6)},module.exports=AlphanumericData},{"./mode":21}],11:[function(require,module,exports){function BitBuffer(){this.buffer=[],this.length=0}BitBuffer.prototype={get:function(index){var bufIndex=Math.floor(index/8);return 1==(this.buffer[bufIndex]>>>7-index%8&1)},put:function(num,length){for(var i=0;i<length;i++)this.putBit(1==(num>>>length-i-1&1))},getLengthInBits:function(){return this.length},putBit:function(bit){var bufIndex=Math.floor(this.length/8);this.buffer.length<=bufIndex&&this.buffer.push(0),bit&&(this.buffer[bufIndex]|=128>>>this.length%8),this.length++}},module.exports=BitBuffer},{}],12:[function(require,module,exports){var BufferUtil=require("../utils/buffer");function BitMatrix(size){if(!size||size<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=size,this.data=BufferUtil.alloc(size*size),this.reservedBit=BufferUtil.alloc(size*size)}BitMatrix.prototype.set=function(row,index,value,reserved){index=row*this.size+index;this.data[index]=value,reserved&&(this.reservedBit[index]=!0)},BitMatrix.prototype.get=function(row,col){return this.data[row*this.size+col]},BitMatrix.prototype.xor=function(row,col,value){this.data[row*this.size+col]^=value},BitMatrix.prototype.isReserved=function(row,col){return this.reservedBit[row*this.size+col]},module.exports=BitMatrix},{"../utils/buffer":34}],13:[function(require,module,exports){var BufferUtil=require("../utils/buffer"),Mode=require("./mode");function ByteData(data){this.mode=Mode.BYTE,this.data=BufferUtil.from(data)}ByteData.getBitsLength=function(length){return 8*length},ByteData.prototype.getLength=function(){return this.data.length},ByteData.prototype.getBitsLength=function(){return ByteData.getBitsLength(this.data.length)},ByteData.prototype.write=function(bitBuffer){for(var i=0,l=this.data.length;i<l;i++)bitBuffer.put(this.data[i],8)},module.exports=ByteData},{"../utils/buffer":34,"./mode":21}],14:[function(require,module,exports){var ECLevel=require("./error-correction-level"),EC_BLOCKS_TABLE=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],EC_CODEWORDS_TABLE=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];exports.getBlocksCount=function(version,errorCorrectionLevel){switch(errorCorrectionLevel){case ECLevel.L:return EC_BLOCKS_TABLE[4*(version-1)+0];case ECLevel.M:return EC_BLOCKS_TABLE[4*(version-1)+1];case ECLevel.Q:return EC_BLOCKS_TABLE[4*(version-1)+2];case ECLevel.H:return EC_BLOCKS_TABLE[4*(version-1)+3];default:return}},exports.getTotalCodewordsCount=function(version,errorCorrectionLevel){switch(errorCorrectionLevel){case ECLevel.L:return EC_CODEWORDS_TABLE[4*(version-1)+0];case ECLevel.M:return EC_CODEWORDS_TABLE[4*(version-1)+1];case ECLevel.Q:return EC_CODEWORDS_TABLE[4*(version-1)+2];case ECLevel.H:return EC_CODEWORDS_TABLE[4*(version-1)+3];default:return}}},{"./error-correction-level":15}],15:[function(require,module,exports){exports.L={bit:1},exports.M={bit:0},exports.Q={bit:3},exports.H={bit:2},exports.isValid=function(level){return level&&void 0!==level.bit&&0<=level.bit&&level.bit<4},exports.from=function(value,defaultValue){if(exports.isValid(value))return value;try{return function(string){if("string"!=typeof string)throw new Error("Param is not a string");switch(string.toLowerCase()){case"l":case"low":return exports.L;case"m":case"medium":return exports.M;case"q":case"quartile":return exports.Q;case"h":case"high":return exports.H;default:throw new Error("Unknown EC Level: "+string)}}(value)}catch(e){return defaultValue}}},{}],16:[function(require,module,exports){var getSymbolSize=require("./utils").getSymbolSize;exports.getPositions=function(size){size=getSymbolSize(size);return[[0,0],[size-7,0],[0,size-7]]}},{"./utils":28}],17:[function(require,module,exports){var Utils=require("./utils"),G15_BCH=Utils.getBCHDigit(1335);exports.getEncodedBits=function(errorCorrectionLevel,data){for(var data=errorCorrectionLevel.bit<<3|data,d=data<<10;0<=Utils.getBCHDigit(d)-G15_BCH;)d^=1335<<Utils.getBCHDigit(d)-G15_BCH;return 21522^(data<<10|d)}},{"./utils":28}],18:[function(BufferUtil,module,exports){var BufferUtil=BufferUtil("../utils/buffer"),EXP_TABLE=BufferUtil.alloc(512),LOG_TABLE=BufferUtil.alloc(256);!function(){for(var x=1,i=0;i<255;i++)EXP_TABLE[i]=x,LOG_TABLE[x]=i,256&(x<<=1)&&(x^=285);for(i=255;i<512;i++)EXP_TABLE[i]=EXP_TABLE[i-255]}(),exports.log=function(n){if(n<1)throw new Error("log("+n+")");return LOG_TABLE[n]},exports.exp=function(n){return EXP_TABLE[n]},exports.mul=function(x,y){return 0===x||0===y?0:EXP_TABLE[LOG_TABLE[x]+LOG_TABLE[y]]}},{"../utils/buffer":34}],19:[function(require,module,exports){var Mode=require("./mode"),Utils=require("./utils");function KanjiData(data){this.mode=Mode.KANJI,this.data=data}KanjiData.getBitsLength=function(length){return 13*length},KanjiData.prototype.getLength=function(){return this.data.length},KanjiData.prototype.getBitsLength=function(){return KanjiData.getBitsLength(this.data.length)},KanjiData.prototype.write=function(bitBuffer){for(var i=0;i<this.data.length;i++){var value=Utils.toSJIS(this.data[i]);if(33088<=value&&value<=40956)value-=33088;else{if(!(57408<=value&&value<=60351))throw new Error("Invalid SJIS character: "+this.data[i]+"\nMake sure your charset is UTF-8");value-=49472}bitBuffer.put(value=192*(value>>>8&255)+(255&value),13)}},module.exports=KanjiData},{"./mode":21,"./utils":28}],20:[function(require,module,exports){exports.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var PenaltyScores_N1=3,PenaltyScores_N2=3,PenaltyScores_N3=40,PenaltyScores_N4=10;exports.isValid=function(mask){return null!=mask&&""!==mask&&!isNaN(mask)&&0<=mask&&mask<=7},exports.from=function(value){return exports.isValid(value)?parseInt(value,10):void 0},exports.getPenaltyN1=function(data){for(var size=data.size,points=0,sameCountCol=0,sameCountRow=0,lastCol=null,lastRow=null,row=0;row<size;row++){for(var sameCountCol=sameCountRow=0,lastCol=lastRow=null,col=0;col<size;col++){var module=data.get(row,col);module===lastCol?sameCountCol++:(5<=sameCountCol&&(points+=PenaltyScores_N1+(sameCountCol-5)),lastCol=module,sameCountCol=1),(module=data.get(col,row))===lastRow?sameCountRow++:(5<=sameCountRow&&(points+=PenaltyScores_N1+(sameCountRow-5)),lastRow=module,sameCountRow=1)}5<=sameCountCol&&(points+=PenaltyScores_N1+(sameCountCol-5)),5<=sameCountRow&&(points+=PenaltyScores_N1+(sameCountRow-5))}return points},exports.getPenaltyN2=function(data){for(var size=data.size,points=0,row=0;row<size-1;row++)for(var col=0;col<size-1;col++){var last=data.get(row,col)+data.get(row,col+1)+data.get(row+1,col)+data.get(row+1,col+1);4!==last&&0!==last||points++}return points*PenaltyScores_N2},exports.getPenaltyN3=function(data){for(var size=data.size,points=0,bitsCol=0,bitsRow=0,row=0;row<size;row++)for(var bitsCol=bitsRow=0,col=0;col<size;col++)bitsCol=bitsCol<<1&2047|data.get(row,col),10<=col&&(1488===bitsCol||93===bitsCol)&&points++,bitsRow=bitsRow<<1&2047|data.get(col,row),10<=col&&(1488===bitsRow||93===bitsRow)&&points++;return points*PenaltyScores_N3},exports.getPenaltyN4=function(data){for(var darkCount=0,modulesCount=data.data.length,i=0;i<modulesCount;i++)darkCount+=data.data[i];return Math.abs(Math.ceil(100*darkCount/modulesCount/5)-10)*PenaltyScores_N4},exports.applyMask=function(pattern,data){for(var size=data.size,col=0;col<size;col++)for(var row=0;row<size;row++)data.isReserved(row,col)||data.xor(row,col,function(maskPattern,i,j){switch(maskPattern){case exports.Patterns.PATTERN000:return(i+j)%2==0;case exports.Patterns.PATTERN001:return i%2==0;case exports.Patterns.PATTERN010:return j%3==0;case exports.Patterns.PATTERN011:return(i+j)%3==0;case exports.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(j/3))%2==0;case exports.Patterns.PATTERN101:return i*j%2+i*j%3==0;case exports.Patterns.PATTERN110:return(i*j%2+i*j%3)%2==0;case exports.Patterns.PATTERN111:return(i*j%3+(i+j)%2)%2==0;default:throw new Error("bad maskPattern:"+maskPattern)}}(pattern,row,col))},exports.getBestMask=function(data,setupFormatFunc){for(var numPatterns=Object.keys(exports.Patterns).length,bestPattern=0,lowerPenalty=1/0,p=0;p<numPatterns;p++){setupFormatFunc(p),exports.applyMask(p,data);var penalty=exports.getPenaltyN1(data)+exports.getPenaltyN2(data)+exports.getPenaltyN3(data)+exports.getPenaltyN4(data);exports.applyMask(p,data),penalty<lowerPenalty&&(lowerPenalty=penalty,bestPattern=p)}return bestPattern}},{}],21:[function(require,module,exports){var VersionCheck=require("./version-check"),Regex=require("./regex");exports.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},exports.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},exports.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},exports.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},exports.MIXED={bit:-1},exports.getCharCountIndicator=function(mode,version){if(!mode.ccBits)throw new Error("Invalid mode: "+mode);if(!VersionCheck.isValid(version))throw new Error("Invalid version: "+version);return 1<=version&&version<10?mode.ccBits[0]:version<27?mode.ccBits[1]:mode.ccBits[2]},exports.getBestModeForData=function(dataStr){return Regex.testNumeric(dataStr)?exports.NUMERIC:Regex.testAlphanumeric(dataStr)?exports.ALPHANUMERIC:Regex.testKanji(dataStr)?exports.KANJI:exports.BYTE},exports.toString=function(mode){if(mode&&mode.id)return mode.id;throw new Error("Invalid mode")},exports.isValid=function(mode){return mode&&mode.bit&&mode.ccBits},exports.from=function(value,defaultValue){if(exports.isValid(value))return value;try{return function(string){if("string"!=typeof string)throw new Error("Param is not a string");switch(string.toLowerCase()){case"numeric":return exports.NUMERIC;case"alphanumeric":return exports.ALPHANUMERIC;case"kanji":return exports.KANJI;case"byte":return exports.BYTE;default:throw new Error("Unknown mode: "+string)}}(value)}catch(e){return defaultValue}}},{"./regex":26,"./version-check":29}],22:[function(require,module,exports){var Mode=require("./mode");function NumericData(data){this.mode=Mode.NUMERIC,this.data=data.toString()}NumericData.getBitsLength=function(length){return 10*Math.floor(length/3)+(length%3?length%3*3+1:0)},NumericData.prototype.getLength=function(){return this.data.length},NumericData.prototype.getBitsLength=function(){return NumericData.getBitsLength(this.data.length)},NumericData.prototype.write=function(bitBuffer){for(var group,value,i=0;i+3<=this.data.length;i+=3)group=this.data.substr(i,3),value=parseInt(group,10),bitBuffer.put(value,10);var remainingNum=this.data.length-i;0<remainingNum&&(group=this.data.substr(i),value=parseInt(group,10),bitBuffer.put(value,3*remainingNum+1))},module.exports=NumericData},{"./mode":21}],23:[function(require,module,exports){var BufferUtil=require("../utils/buffer"),GF=require("./galois-field");exports.mul=function(p1,p2){for(var coeff=BufferUtil.alloc(p1.length+p2.length-1),i=0;i<p1.length;i++)for(var j=0;j<p2.length;j++)coeff[i+j]^=GF.mul(p1[i],p2[j]);return coeff},exports.mod=function(divident,divisor){for(var result=BufferUtil.from(divident);0<=result.length-divisor.length;){for(var coeff=result[0],i=0;i<divisor.length;i++)result[i]^=GF.mul(divisor[i],coeff);for(var offset=0;offset<result.length&&0===result[offset];)offset++;result=result.slice(offset)}return result},exports.generateECPolynomial=function(degree){for(var poly=BufferUtil.from([1]),i=0;i<degree;i++)poly=exports.mul(poly,[1,GF.exp(i)]);return poly}},{"../utils/buffer":34,"./galois-field":18}],24:[function(require,module,exports){var BufferUtil=require("../utils/buffer"),Utils=require("./utils"),ECLevel=require("./error-correction-level"),BitBuffer=require("./bit-buffer"),BitMatrix=require("./bit-matrix"),AlignmentPattern=require("./alignment-pattern"),FinderPattern=require("./finder-pattern"),MaskPattern=require("./mask-pattern"),ECCode=require("./error-correction-code"),ReedSolomonEncoder=require("./reed-solomon-encoder"),Version=require("./version"),FormatInfo=require("./format-info"),Mode=require("./mode"),Segments=require("./segments"),isArray=require("isarray");function setupFormatInfo(matrix,errorCorrectionLevel,maskPattern){for(var mod,size=matrix.size,bits=FormatInfo.getEncodedBits(errorCorrectionLevel,maskPattern),i=0;i<15;i++)mod=1==(bits>>i&1),i<6?matrix.set(i,8,mod,!0):i<8?matrix.set(i+1,8,mod,!0):matrix.set(size-15+i,8,mod,!0),i<8?matrix.set(8,size-i-1,mod,!0):i<9?matrix.set(8,15-i-1+1,mod,!0):matrix.set(8,15-i-1,mod,!0);matrix.set(size-8,8,1,!0)}function createData(version,errorCorrectionLevel,dataTotalCodewordsBits){var buffer=new BitBuffer;dataTotalCodewordsBits.forEach(function(data){buffer.put(data.mode.bit,4),buffer.put(data.getLength(),Mode.getCharCountIndicator(data.mode,version)),data.write(buffer)});dataTotalCodewordsBits=8*(Utils.getSymbolTotalCodewords(version)-ECCode.getTotalCodewordsCount(version,errorCorrectionLevel));for(buffer.getLengthInBits()+4<=dataTotalCodewordsBits&&buffer.put(0,4);buffer.getLengthInBits()%8!=0;)buffer.putBit(0);for(var remainingByte=(dataTotalCodewordsBits-buffer.getLengthInBits())/8,i=0;i<remainingByte;i++)buffer.put(i%2?17:236,8);return function(bitBuffer,version,totalCodewordsInGroup1){for(var totalCodewords=Utils.getSymbolTotalCodewords(version),dataTotalCodewords=ECCode.getTotalCodewordsCount(version,totalCodewordsInGroup1),dataTotalCodewords=totalCodewords-dataTotalCodewords,ecTotalBlocks=ECCode.getBlocksCount(version,totalCodewordsInGroup1),blocksInGroup1=ecTotalBlocks-totalCodewords%ecTotalBlocks,totalCodewordsInGroup1=Math.floor(totalCodewords/ecTotalBlocks),dataCodewordsInGroup1=Math.floor(dataTotalCodewords/ecTotalBlocks),dataCodewordsInGroup2=dataCodewordsInGroup1+1,ecCount=totalCodewordsInGroup1-dataCodewordsInGroup1,rs=new ReedSolomonEncoder(ecCount),offset=0,dcData=new Array(ecTotalBlocks),ecData=new Array(ecTotalBlocks),maxDataSize=0,buffer=BufferUtil.from(bitBuffer.buffer),b=0;b<ecTotalBlocks;b++){var dataSize=b<blocksInGroup1?dataCodewordsInGroup1:dataCodewordsInGroup2;dcData[b]=buffer.slice(offset,offset+dataSize),ecData[b]=rs.encode(dcData[b]),offset+=dataSize,maxDataSize=Math.max(maxDataSize,dataSize)}var i,r,data=BufferUtil.alloc(totalCodewords),index=0;for(i=0;i<maxDataSize;i++)for(r=0;r<ecTotalBlocks;r++)i<dcData[r].length&&(data[index++]=dcData[r][i]);for(i=0;i<ecCount;i++)for(r=0;r<ecTotalBlocks;r++)data[index++]=ecData[r][i];return data}(buffer,version,errorCorrectionLevel)}function createSymbol(modules,version,errorCorrectionLevel,maskPattern){var segments;if(isArray(modules))segments=Segments.fromArray(modules);else{if("string"!=typeof modules)throw new Error("Invalid data");var rawSegments,dataBits=version;dataBits||(rawSegments=Segments.rawSplit(modules),dataBits=Version.getBestVersionForData(rawSegments,errorCorrectionLevel)),segments=Segments.fromString(modules,dataBits||40)}modules=Version.getBestVersionForData(segments,errorCorrectionLevel);if(!modules)throw new Error("The amount of data is too big to be stored in a QR Code");if(version){if(version<modules)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+modules+".\n")}else version=modules;dataBits=createData(version,errorCorrectionLevel,segments),modules=Utils.getSymbolSize(version),modules=new BitMatrix(modules);return function(matrix,version){for(var size=matrix.size,pos=FinderPattern.getPositions(version),i=0;i<pos.length;i++)for(var row=pos[i][0],col=pos[i][1],r=-1;r<=7;r++)if(!(row+r<=-1||size<=row+r))for(var c=-1;c<=7;c++)col+c<=-1||size<=col+c||(0<=r&&r<=6&&(0===c||6===c)||0<=c&&c<=6&&(0===r||6===r)||2<=r&&r<=4&&2<=c&&c<=4?matrix.set(row+r,col+c,!0,!0):matrix.set(row+r,col+c,!1,!0))}(modules,version),function(matrix){for(var size=matrix.size,r=8;r<size-8;r++){var value=r%2==0;matrix.set(r,6,value,!0),matrix.set(6,r,value,!0)}}(modules),function(matrix,version){for(var pos=AlignmentPattern.getPositions(version),i=0;i<pos.length;i++)for(var row=pos[i][0],col=pos[i][1],r=-2;r<=2;r++)for(var c=-2;c<=2;c++)-2===r||2===r||-2===c||2===c||0===r&&0===c?matrix.set(row+r,col+c,!0,!0):matrix.set(row+r,col+c,!1,!0)}(modules,version),setupFormatInfo(modules,errorCorrectionLevel,0),7<=version&&function(matrix,version){for(var row,col,mod,size=matrix.size,bits=Version.getEncodedBits(version),i=0;i<18;i++)row=Math.floor(i/3),matrix.set(row,col=i%3+size-8-3,mod=1==(bits>>i&1),!0),matrix.set(col,row,mod,!0)}(modules,version),function(matrix,data){for(var size=matrix.size,inc=-1,row=size-1,bitIndex=7,byteIndex=0,col=size-1;0<col;col-=2)for(6===col&&col--;;){for(var dark,c=0;c<2;c++)matrix.isReserved(row,col-c)||(dark=!1,byteIndex<data.length&&(dark=1==(data[byteIndex]>>>bitIndex&1)),matrix.set(row,col-c,dark),-1===--bitIndex&&(byteIndex++,bitIndex=7));if((row+=inc)<0||size<=row){row-=inc,inc=-inc;break}}}(modules,dataBits),isNaN(maskPattern)&&(maskPattern=MaskPattern.getBestMask(modules,setupFormatInfo.bind(null,modules,errorCorrectionLevel))),MaskPattern.applyMask(maskPattern,modules),setupFormatInfo(modules,errorCorrectionLevel,maskPattern),{modules:modules,version:version,errorCorrectionLevel:errorCorrectionLevel,maskPattern:maskPattern,segments:segments}}exports.create=function(data,options){if(void 0===data||""===data)throw new Error("No input text");var version,mask,errorCorrectionLevel=ECLevel.M;return void 0!==options&&(errorCorrectionLevel=ECLevel.from(options.errorCorrectionLevel,ECLevel.M),version=Version.from(options.version),mask=MaskPattern.from(options.maskPattern),options.toSJISFunc&&Utils.setToSJISFunction(options.toSJISFunc)),createSymbol(data,version,errorCorrectionLevel,mask)}},{"../utils/buffer":34,"./alignment-pattern":9,"./bit-buffer":11,"./bit-matrix":12,"./error-correction-code":14,"./error-correction-level":15,"./finder-pattern":16,"./format-info":17,"./mask-pattern":20,"./mode":21,"./reed-solomon-encoder":25,"./segments":27,"./utils":28,"./version":30,isarray:6}],25:[function(require,module,exports){var BufferUtil=require("../utils/buffer"),Polynomial=require("./polynomial"),Buffer=require("buffer").Buffer;function ReedSolomonEncoder(degree){this.genPoly=void 0,this.degree=degree,this.degree&&this.initialize(this.degree)}ReedSolomonEncoder.prototype.initialize=function(degree){this.degree=degree,this.genPoly=Polynomial.generateECPolynomial(this.degree)},ReedSolomonEncoder.prototype.encode=function(start){if(!this.genPoly)throw new Error("Encoder not initialized");var remainder=BufferUtil.alloc(this.degree),buff=Buffer.concat([start,remainder],start.length+this.degree),remainder=Polynomial.mod(buff,this.genPoly),start=this.degree-remainder.length;if(0<start){buff=BufferUtil.alloc(this.degree);return remainder.copy(buff,start),buff}return remainder},module.exports=ReedSolomonEncoder},{"../utils/buffer":34,"./polynomial":23,buffer:2}],26:[function(require,module,exports){var kanji="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+",byte="(?:(?![A-Z0-9 $%*+\\-./:]|"+(kanji=kanji.replace(/u/g,"\\u"))+")(?:.|[\r\n]))+";exports.KANJI=new RegExp(kanji,"g"),exports.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),exports.BYTE=new RegExp(byte,"g"),exports.NUMERIC=new RegExp("[0-9]+","g"),exports.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");var TEST_KANJI=new RegExp("^"+kanji+"$"),TEST_NUMERIC=new RegExp("^[0-9]+$"),TEST_ALPHANUMERIC=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");exports.testKanji=function(str){return TEST_KANJI.test(str)},exports.testNumeric=function(str){return TEST_NUMERIC.test(str)},exports.testAlphanumeric=function(str){return TEST_ALPHANUMERIC.test(str)}},{}],27:[function(require,module,exports){var Mode=require("./mode"),NumericData=require("./numeric-data"),AlphanumericData=require("./alphanumeric-data"),ByteData=require("./byte-data"),KanjiData=require("./kanji-data"),Regex=require("./regex"),Utils=require("./utils"),dijkstra=require("dijkstrajs");function getStringByteLength(str){return unescape(encodeURIComponent(str)).length}function getSegments(regex,mode,str){for(var result,segments=[];null!==(result=regex.exec(str));)segments.push({data:result[0],index:result.index,mode:mode,length:result[0].length});return segments}function getSegmentsFromString(kanjiSegs){var byteSegs,numSegs=getSegments(Regex.NUMERIC,Mode.NUMERIC,kanjiSegs),alphaNumSegs=getSegments(Regex.ALPHANUMERIC,Mode.ALPHANUMERIC,kanjiSegs),kanjiSegs=Utils.isKanjiModeEnabled()?(byteSegs=getSegments(Regex.BYTE,Mode.BYTE,kanjiSegs),getSegments(Regex.KANJI,Mode.KANJI,kanjiSegs)):(byteSegs=getSegments(Regex.BYTE_KANJI,Mode.BYTE,kanjiSegs),[]);return numSegs.concat(alphaNumSegs,byteSegs,kanjiSegs).sort(function(s1,s2){return s1.index-s2.index}).map(function(obj){return{data:obj.data,mode:obj.mode,length:obj.length}})}function getSegmentBitsLength(length,mode){switch(mode){case Mode.NUMERIC:return NumericData.getBitsLength(length);case Mode.ALPHANUMERIC:return AlphanumericData.getBitsLength(length);case Mode.KANJI:return KanjiData.getBitsLength(length);case Mode.BYTE:return ByteData.getBitsLength(length)}}function buildSingleSegment(data,mode){var bestMode=Mode.getBestModeForData(data),mode=Mode.from(mode,bestMode);if(mode!==Mode.BYTE&&mode.bit<bestMode.bit)throw new Error('"'+data+'" cannot be encoded with mode '+Mode.toString(mode)+".\n Suggested mode is: "+Mode.toString(bestMode));switch(mode=mode===Mode.KANJI&&!Utils.isKanjiModeEnabled()?Mode.BYTE:mode){case Mode.NUMERIC:return new NumericData(data);case Mode.ALPHANUMERIC:return new AlphanumericData(data);case Mode.KANJI:return new KanjiData(data);case Mode.BYTE:return new ByteData(data)}}exports.fromArray=function(array){return array.reduce(function(acc,seg){return"string"==typeof seg?acc.push(buildSingleSegment(seg,null)):seg.data&&acc.push(buildSingleSegment(seg.data,seg.mode)),acc},[])},exports.fromString=function(data,version){for(var graph=function(nodes,version){for(var table={},graph={start:{}},prevNodeIds=["start"],i=0;i<nodes.length;i++){for(var nodeGroup=nodes[i],currentNodeIds=[],j=0;j<nodeGroup.length;j++){var node=nodeGroup[j],key=""+i+j;currentNodeIds.push(key),table[key]={node:node,lastCount:0},graph[key]={};for(var n=0;n<prevNodeIds.length;n++){var prevNodeId=prevNodeIds[n];table[prevNodeId]&&table[prevNodeId].node.mode===node.mode?(graph[prevNodeId][key]=getSegmentBitsLength(table[prevNodeId].lastCount+node.length,node.mode)-getSegmentBitsLength(table[prevNodeId].lastCount,node.mode),table[prevNodeId].lastCount+=node.length):(table[prevNodeId]&&(table[prevNodeId].lastCount=node.length),graph[prevNodeId][key]=getSegmentBitsLength(node.length,node.mode)+4+Mode.getCharCountIndicator(node.mode,version))}}prevNodeIds=currentNodeIds}for(n=0;n<prevNodeIds.length;n++)graph[prevNodeIds[n]].end=0;return{map:graph,table:table}}(function(segs){for(var nodes=[],i=0;i<segs.length;i++){var seg=segs[i];switch(seg.mode){case Mode.NUMERIC:nodes.push([seg,{data:seg.data,mode:Mode.ALPHANUMERIC,length:seg.length},{data:seg.data,mode:Mode.BYTE,length:seg.length}]);break;case Mode.ALPHANUMERIC:nodes.push([seg,{data:seg.data,mode:Mode.BYTE,length:seg.length}]);break;case Mode.KANJI:nodes.push([seg,{data:seg.data,mode:Mode.BYTE,length:getStringByteLength(seg.data)}]);break;case Mode.BYTE:nodes.push([{data:seg.data,mode:Mode.BYTE,length:getStringByteLength(seg.data)}])}}return nodes}(getSegmentsFromString(data,Utils.isKanjiModeEnabled())),version),path=dijkstra.find_path(graph.map,"start","end"),optimizedSegs=[],i=1;i<path.length-1;i++)optimizedSegs.push(graph.table[path[i]].node);return exports.fromArray(function(segs){return segs.reduce(function(acc,curr){var prevSeg=0<=acc.length-1?acc[acc.length-1]:null;return prevSeg&&prevSeg.mode===curr.mode?acc[acc.length-1].data+=curr.data:acc.push(curr),acc},[])}(optimizedSegs))},exports.rawSplit=function(data){return exports.fromArray(getSegmentsFromString(data,Utils.isKanjiModeEnabled()))}},{"./alphanumeric-data":10,"./byte-data":13,"./kanji-data":19,"./mode":21,"./numeric-data":22,"./regex":26,"./utils":28,dijkstrajs:5}],28:[function(require,module,exports){var toSJISFunction,CODEWORDS_COUNT=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];exports.getSymbolSize=function(version){if(!version)throw new Error('"version" cannot be null or undefined');if(version<1||40<version)throw new Error('"version" should be in range from 1 to 40');return 4*version+17},exports.getSymbolTotalCodewords=function(version){return CODEWORDS_COUNT[version]},exports.getBCHDigit=function(data){for(var digit=0;0!==data;)digit++,data>>>=1;return digit},exports.setToSJISFunction=function(f){if("function"!=typeof f)throw new Error('"toSJISFunc" is not a valid function.');toSJISFunction=f},exports.isKanjiModeEnabled=function(){return void 0!==toSJISFunction},exports.toSJIS=function(kanji){return toSJISFunction(kanji)}},{}],29:[function(require,module,exports){exports.isValid=function(version){return!isNaN(version)&&1<=version&&version<=40}},{}],30:[function(require,module,exports){var Utils=require("./utils"),ECCode=require("./error-correction-code"),ECLevel=require("./error-correction-level"),Mode=require("./mode"),VersionCheck=require("./version-check"),isArray=require("isarray"),G18_BCH=Utils.getBCHDigit(7973);function getReservedBitsCount(mode,version){return Mode.getCharCountIndicator(mode,version)+4}function getBestVersionForMixedData(segments,errorCorrectionLevel){for(var currentVersion=1;currentVersion<=40;currentVersion++)if(function(segments,version){var totalBits=0;return segments.forEach(function(data){var reservedBits=getReservedBitsCount(data.mode,version);totalBits+=reservedBits+data.getBitsLength()}),totalBits}(segments,currentVersion)<=exports.getCapacity(currentVersion,errorCorrectionLevel,Mode.MIXED))return currentVersion}exports.from=function(value,defaultValue){return VersionCheck.isValid(value)?parseInt(value,10):defaultValue},exports.getCapacity=function(version,dataTotalCodewordsBits,mode){if(!VersionCheck.isValid(version))throw new Error("Invalid QR Code version");void 0===mode&&(mode=Mode.BYTE);dataTotalCodewordsBits=8*(Utils.getSymbolTotalCodewords(version)-ECCode.getTotalCodewordsCount(version,dataTotalCodewordsBits));if(mode===Mode.MIXED)return dataTotalCodewordsBits;var usableBits=dataTotalCodewordsBits-getReservedBitsCount(mode,version);switch(mode){case Mode.NUMERIC:return Math.floor(usableBits/10*3);case Mode.ALPHANUMERIC:return Math.floor(usableBits/11*2);case Mode.KANJI:return Math.floor(usableBits/13);default:Mode.BYTE;return Math.floor(usableBits/8)}},exports.getBestVersionForData=function(data,ecl){var seg,ecl=ECLevel.from(ecl,ECLevel.M);if(isArray(data)){if(1<data.length)return getBestVersionForMixedData(data,ecl);if(0===data.length)return 1;seg=data[0]}else seg=data;return function(mode,length,errorCorrectionLevel){for(var currentVersion=1;currentVersion<=40;currentVersion++)if(length<=exports.getCapacity(currentVersion,errorCorrectionLevel,mode))return currentVersion}(seg.mode,seg.getLength(),ecl)},exports.getEncodedBits=function(version){if(!VersionCheck.isValid(version)||version<7)throw new Error("Invalid QR Code version");for(var d=version<<12;0<=Utils.getBCHDigit(d)-G18_BCH;)d^=7973<<Utils.getBCHDigit(d)-G18_BCH;return version<<12|d}},{"./error-correction-code":14,"./error-correction-level":15,"./mode":21,"./utils":28,"./version-check":29,isarray:6}],31:[function(require,module,exports){var Utils=require("./utils");exports.render=function(qrData,image,ctx){var canvasEl=image;void 0!==(opts=ctx)||image&&image.getContext||(opts=image,image=void 0),image||(canvasEl=function(){try{return document.createElement("canvas")}catch(e){throw new Error("You need to specify a canvas element")}}());var opts=Utils.getOptions(opts),size=Utils.getImageWidth(qrData.modules.size,opts),ctx=canvasEl.getContext("2d"),image=ctx.createImageData(size,size);return Utils.qrToImageData(image.data,qrData,opts),function(ctx,canvas,size){ctx.clearRect(0,0,canvas.width,canvas.height),canvas.style||(canvas.style={}),canvas.height=size,canvas.width=size,canvas.style.height=size+"px",canvas.style.width=size+"px"}(ctx,canvasEl,size),ctx.putImageData(image,0,0),canvasEl},exports.renderToDataURL=function(canvasEl,type,rendererOpts){void 0!==(rendererOpts=rendererOpts)||type&&type.getContext||(rendererOpts=type,type=void 0);rendererOpts=rendererOpts||{},canvasEl=exports.render(canvasEl,type,rendererOpts),type=rendererOpts.type||"image/png",rendererOpts=rendererOpts.rendererOpts||{};return canvasEl.toDataURL(type,rendererOpts.quality)}},{"./utils":33}],32:[function(require,module,exports){var Utils=require("./utils");function getColorAttrib(str,attrib){var alpha=str.a/255,str=attrib+'="'+str.hex+'"';return alpha<1?str+" "+attrib+'-opacity="'+alpha.toFixed(2).slice(1)+'"':str}function svgCmd(cmd,str,y){str=cmd+str;return void 0!==y&&(str+=" "+y),str}exports.render=function(bg,qrcodesize,cb){var opts=Utils.getOptions(qrcodesize),svgTag=bg.modules.size,data=bg.modules.data,qrcodesize=svgTag+2*opts.margin,bg=opts.color.light.a?"<path "+getColorAttrib(opts.color.light,"fill")+' d="M0 0h'+qrcodesize+"v"+qrcodesize+'H0z"/>':"",svgTag="<path "+getColorAttrib(opts.color.dark,"stroke")+' d="'+function(data,size,margin){for(var path="",moveBy=0,newRow=!1,lineLength=0,i=0;i<data.length;i++){var col=Math.floor(i%size),row=Math.floor(i/size);col||newRow||(newRow=!0),data[i]?(lineLength++,0<i&&0<col&&data[i-1]||(path+=newRow?svgCmd("M",col+margin,.5+row+margin):svgCmd("m",moveBy,0),moveBy=0,newRow=!1),col+1<size&&data[i+1]||(path+=svgCmd("h",lineLength),lineLength=0)):moveBy++}return path}(data,svgTag,opts.margin)+'"/>',svgTag='<svg xmlns="http://www.w3.org/2000/svg" '+(opts.width?'width="'+opts.width+'" height="'+opts.width+'" ':"")+('viewBox="0 0 '+qrcodesize+" "+qrcodesize+'"')+' shape-rendering="crispEdges">'+bg+svgTag+"</svg>\n";return"function"==typeof cb&&cb(null,svgTag),svgTag}},{"./utils":33}],33:[function(require,module,exports){function hex2rgba(hexValue){if("string"!=typeof(hexValue="number"==typeof hexValue?hexValue.toString():hexValue))throw new Error("Color should be defined as hex string");var hexCode=hexValue.slice().replace("#","").split("");if(hexCode.length<3||5===hexCode.length||8<hexCode.length)throw new Error("Invalid hex color: "+hexValue);6===(hexCode=3===hexCode.length||4===hexCode.length?Array.prototype.concat.apply([],hexCode.map(function(c){return[c,c]})):hexCode).length&&hexCode.push("F","F");hexValue=parseInt(hexCode.join(""),16);return{r:hexValue>>24&255,g:hexValue>>16&255,b:hexValue>>8&255,a:255&hexValue,hex:"#"+hexCode.slice(0,6).join("")}}exports.getOptions=function(options){(options=options||{}).color||(options.color={});var margin=void 0===options.margin||null===options.margin||options.margin<0?4:options.margin,width=options.width&&21<=options.width?options.width:void 0,scale=options.scale||4;return{width:width,scale:width?4:scale,margin:margin,color:{dark:hex2rgba(options.color.dark||"#000000ff"),light:hex2rgba(options.color.light||"#ffffffff")},type:options.type,rendererOpts:options.rendererOpts||{}}},exports.getScale=function(qrSize,opts){return opts.width&&opts.width>=qrSize+2*opts.margin?opts.width/(qrSize+2*opts.margin):opts.scale},exports.getImageWidth=function(qrSize,opts){var scale=exports.getScale(qrSize,opts);return Math.floor((qrSize+2*opts.margin)*scale)},exports.qrToImageData=function(imgData,qr,opts){for(var size=qr.modules.size,data=qr.modules.data,scale=exports.getScale(size,opts),symbolSize=Math.floor((size+2*opts.margin)*scale),scaledMargin=opts.margin*scale,palette=[opts.color.light,opts.color.dark],i=0;i<symbolSize;i++)for(var j=0;j<symbolSize;j++){var posDst=4*(i*symbolSize+j),pxColor=opts.color.light;scaledMargin<=i&&scaledMargin<=j&&i<symbolSize-scaledMargin&&j<symbolSize-scaledMargin&&(pxColor=palette[data[Math.floor((i-scaledMargin)/scale)*size+Math.floor((j-scaledMargin)/scale)]?1:0]),imgData[posDst++]=pxColor.r,imgData[posDst++]=pxColor.g,imgData[posDst++]=pxColor.b,imgData[posDst]=pxColor.a}}},{}],34:[function(require,module,exports){!function(Buffer){!function(){"use strict";var isArray=require("isarray");var K_MAX_LENGTH=(Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}())?2147483647:1073741823;function Buffer(arg,offset,length){return Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer?"number"==typeof arg?allocUnsafe(this,arg):function(that,value,offset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer)return function(that,array,byteOffset,buf){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(buf||0))throw new RangeError("'length' is out of bounds");buf=void 0===byteOffset&&void 0===buf?new Uint8Array(array):void 0===buf?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,buf);Buffer.TYPED_ARRAY_SUPPORT?buf.__proto__=Buffer.prototype:buf=fromArrayLike(that,buf);return buf}(that,value,offset,length);return("string"!=typeof value?function(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(that,len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||function(val){return val!=val}(obj.length)?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(that,obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}:function(buf,actual){var length=0|byteLength(actual),buf=createBuffer(buf,length),actual=buf.write(actual);actual!==length&&(buf=buf.slice(0,actual));return buf})(that,value)}(this,arg,offset,length):new Buffer(arg,offset,length)}function checked(length){if(K_MAX_LENGTH<=length)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function createBuffer(that,length){var buf;return Buffer.TYPED_ARRAY_SUPPORT?(buf=new Uint8Array(length)).__proto__=Buffer.prototype:(buf=null===(buf=that)?new Buffer(length):buf).length=length,buf}function allocUnsafe(that,size){var buf=createBuffer(that,size<0?0:0|checked(size));if(!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)buf[i]=0;return buf}function fromArrayLike(that,array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(that,length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(55295<(codePoint=string.charCodeAt(i))&&codePoint<57344){if(!leadSurrogate){if(56319<codePoint){-1<(units-=3)&&bytes.push(239,191,189);continue}if(i+1===length){-1<(units-=3)&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){-1<(units-=3)&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&-1<(units-=3)&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if(--units<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function byteLength(string){return Buffer.isBuffer(string)?string.length:"undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)?string.byteLength:0===(string="string"!=typeof string?""+string:string).length?0:utf8ToBytes(string).length}function utf8Write(buf,string,offset,length){return function(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}(utf8ToBytes(string,buf.length-offset),buf,offset,length)}Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1})),Buffer.prototype.write=function(string,offset,length){void 0===offset||void 0===length&&"string"==typeof offset?(length=this.length,offset=0):isFinite(offset)&&(offset|=0,isFinite(length)?length|=0:length=void 0);var remaining=this.length-offset;if((void 0===length||remaining<length)&&(length=remaining),0<string.length&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");return utf8Write(this,string,offset,length)},Buffer.prototype.slice=function(start,end){var len=this.length;if((start=~~start)<0?(start+=len)<0&&(start=0):len<start&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):len<end&&(end=len),end<start&&(end=start),Buffer.TYPED_ARRAY_SUPPORT)(newBuf=this.subarray(start,end)).__proto__=Buffer.prototype;else for(var sliceLen=end-start,newBuf=new Buffer(sliceLen,void 0),i=0;i<sliceLen;++i)newBuf[i]=this[i+start];return newBuf},Buffer.prototype.copy=function(target,targetStart,start,end){if(start=start||0,end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),(end=0<end&&end<start?start:end)===start)return 0;if(0===target.length||0===this.length)return 0;if((targetStart=targetStart||0)<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length);var i,len=(end=target.length-targetStart<end-start?target.length-targetStart+start:end)-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;0<=i;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end){var code;if("string"==typeof val?("string"==typeof start?(start=0,end=this.length):"string"==typeof end&&(end=this.length),1!==val.length||(code=val.charCodeAt(0))<256&&(val=code)):"number"==typeof val&&(val&=255),start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;if(start>>>=0,end=void 0===end?this.length:end>>>0,"number"==typeof(val=val||0))for(i=start;i<end;++i)this[i]=val;else for(var bytes=Buffer.isBuffer(val)?val:new Buffer(val),len=bytes.length,i=0;i<end-start;++i)this[i+start]=bytes[i%len];return this},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return createBuffer(null,0);if(void 0===length)for(i=length=0;i<list.length;++i)length+=list[i].length;for(var buffer=allocUnsafe(null,length),pos=0,i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},module.exports.alloc=function(buffer){buffer=new Buffer(buffer);return buffer.fill(0),buffer},module.exports.from=function(data){return new Buffer(data)}}.call(this)}.call(this,require("buffer").Buffer)},{buffer:2,isarray:6}],35:[function(require,module,exports){"use strict";const objpacker=require("./objpacker");const unitStructNames=["classInstance","x","y","unitID","relation","validFlags","validProps","player","hp","sp","energy","resources","hangar","stateFlags","relationCI"],unitStateBits=["cloak","burrow","transit","hallucinated","invincible"],validPropBits=["owner","hp","shield","energy","resource","hangar"],relationBits=["_0","_1","_2","_3","_4","_5","_6","_7","_8","nydus","addon"];function unpackUnit(buffer){let unpacked=objpacker.unpack("<I6H4BIHHI",unitStructNames,buffer);return unpacked.validFlags=objpacker.unpackFlags(unpacked.validFlags,unitStateBits),unpacked.validProps=objpacker.unpackFlags(unpacked.validProps,validPropBits),unpacked.relation=objpacker.unpackFlags(unpacked.relation,relationBits,!0),unpacked.stateFlags=objpacker.unpackFlags(unpacked.stateFlags,unitStateBits),unpacked}function packUnit(obj){let objToPack={};return unitStructNames.forEach(key=>{switch(key){case"relation":objToPack[key]=objpacker.packFlags(obj[key],relationBits);break;case"validFlags":case"stateFlags":objToPack[key]=objpacker.packFlags(obj[key],unitStateBits);break;case"validProps":objToPack[key]=objpacker.packFlags(obj[key],validPropBits);break;default:objToPack[key]=obj[key]}}),objpacker.pack("<I6H4BIHHI",unitStructNames,objToPack)}module.exports={packUnit:packUnit,unpackUnit:unpackUnit,packAllUnits:function(units){let buffer=new Uint8Array(36*units.length);return units.map(packUnit).forEach((buf,i)=>{buffer.set(buf,36*i)}),buffer},unpackAllUnits:function(buffer){let out=[];for(let i=0;i<buffer.length;i+=36)out.push(unpackUnit(buffer.slice(i,i+36)));return out},packTile:function(i16a){let array;return array=0<i16a[0].length?i16a.reduce((t,a)=>t.concat(a),[]):i16a,i16a=new Uint16Array(array),new Uint8Array(i16a.buffer)},unpackTile:function(i16Array,tileSize){if(tileSize){var[w,h]=tileSize;let retArray=new Uint16Array(w*h),inpArray=new Uint16Array(i16Array.buffer||i16Array,i16Array.byteOffset||0,(i16Array.byteLength||i16Array.length)>>1);retArray.set(inpArray.slice(0,w*h));let a=[];for(let i=0;i<h;i++)a.push(Array.from(retArray.slice(i*w,(i+1)*w)));return a}return i16Array=new Uint16Array(i16Array.buffer||i16Array,i16Array.byteOffset||0,(i16Array.byteLength||i16Array.length)>>1),Array.from(i16Array)},packDim:function(obj){return objpacker.pack("<HH",["width","height"],obj)},unpackDim:function(buffer){return objpacker.unpack("<HH",["width","height"],buffer)}}},{"./objpacker":41}],36:[function(require,module,exports){"use strict";module.exports.findChunk=function(array,chunkLength,validationFunc=()=>!0){var b=[chunkLength.charCodeAt(0),chunkLength.charCodeAt(1),chunkLength.charCodeAt(2),chunkLength.charCodeAt(3)];let found=-1;for(let i=0;i<array.length;i++)if(array[i]==b[0]&&array[i+1]==b[1]&&array[i+2]==b[2]&&array[i+3]==b[3]){var cl=array[i+4]+(array[i+5]<<8)+(array[i+6]<<16)+(array[i+7]<<24);if(validationFunc(cl,array.slice(i+8,i+cl+8))){found=i;break}}return-1==found?null:(chunkLength=array[found+4]+(array[found+5]<<8)+(array[found+6]<<16)+(array[found+7]<<24),{chunkPosition:found,chunkLength:chunkLength,chunkLengthTotal:chunkLength+8,data:array.slice(found+8,found+chunkLength+8)})},module.exports.replaceChunk=function(newData,output,dw,validationFunc=()=>!0){let array=newData.concat?newData:Array.from(newData);var b=[output.charCodeAt(0),output.charCodeAt(1),output.charCodeAt(2),output.charCodeAt(3)],newData=Array.from(dw);let found=-1;for(let i=0;i<array.length;i++)if(array[i]==b[0]&&array[i+1]==b[1]&&array[i+2]==b[2]&&array[i+3]==b[3]){var cl=array[i+4]+(array[i+5]<<8)+(array[i+6]<<16)+(array[i+7]<<24);if(validationFunc(cl,array.slice(i+8,i+cl+8))){found=i;break}}return-1==found?null:(output=array[found+4]+(array[found+5]<<8)+(array[found+6]<<16)+(array[found+7]<<24),output=array.slice(0,found).concat(b).concat([255&(dw=newData.length),dw>>>8&255,dw>>>16&255,dw>>>24&255]).concat(newData).concat(array.slice(found+output+8)),new Uint8Array(output))}},{}],37:[function(require,module,exports){"use strict";var elementsData={en:[],ko:[["title",0,"스타크래프트 QR 코드 도구"],[".page-title",0,"스타크래프트 맵 QR 코드/미니맵 드로잉 도구"],[".map-inputs",0,"입력 맵:"],[".map-info",0,"크기:"],["#map-input-status-text",0,"지도 업로드"],["#mmdraw-image-status-text",0,"이미지 업로드"],["#tab-unitqr",0,"단위QR"],["#tab-tileqr",0,"타일QR"],["#tab-mmdraw",0,"미니맵 그리기"],["label[for*='qr-input-text']",0,"데이터:"],["label[for='tileqr-size']",0,"크기:"],["#label-unitqr-player",0,"단위 소유자:"],["#label-unitqr-pos",0,"위치:"],["#label-unitqr-ecl",0,"오류 수정 수준:"],["#label-tileqr-tiles",0,"타일:"],["#label-tileqr-pos",0,"위치:"],["#label-tileqr-ecl",0,"오류 수정 수준:"],["label[for*='qr-ecl-l']",0,"낮다"],["label[for*='qr-ecl-m']",0,"보통"],["label[for*='qr-ecl-h']",0,"높다"],["#label-unitqr-layerdown",0,"레이어 다운"],["#label-mmdraw-layerdown",0,"레이어 다운"],["#label-mmdraw-image",0,"이미지:"],["#label-mmdraw-size",0,"크기:"],["#label-mmdraw-pos",0,"위치:"],["#label-mmdraw-usegas",0,"가스 사용"],["#download-map",0,"지도 저장"],["#download-chk",0,"CHK 저장"],["#bubble-hint-unitqr-pos",0,"픽셀단위로 측정됩니다. QR 코드를 중앙에 두려면 공백을 둡니다."],["#bubble-hint-tileqr-pos",0,"32x32 그리드로 측정됩니다. QR 코드를 중앙에 두려면 공백을 둡니다."],["#bubble-hint-mmdraw-pos",0,"픽셀단위로 측정됩니다. 이미지를 중앙에 두려면 공간을 둡니다."],["#bubble-hint-unitqr-layer-down",0,"QR 코드 뒤에 다른 플레이어의 시작 위치를 이동합니다."],["#bubble-hint-mmdraw-layerdown",0,"이미지 뒤에 있는 모든 시작 위치를 이동합니다. 이렇게 하면 플레이어의 시작 보기가 변경됩니다."],["#bubble-hint-mmdraw-usegas",0,"청록색을 위해 플레이어 11용 간헐천을 만듭니다. 게임이 시작될 때 트리거를 사용하여 제거해야 합니다."],["#bubble-hint-tileqr-tiles",0,"SCMDraft 타일 인덱스 도구(예: 0100.01)에서 번호를 사용할 수 있습니다."],["#bubble-hint-mmdraw-image",0,"블랙은 투명합니다."],["#bubble-hint-mmdraw-size",0,"단위 수입니다."]],zh:[["title",0,"星际重制版二维码工具"],[".page-title",0,"星际重制版二维码&小地图绘制工具"],[".map-inputs",0,"地图："],[".map-info",0,"大小："],["#map-input-status-text",0,"点击上传地图"],["#mmdraw-image-status-text",0,"点击上传图片"],["#tab-unitqr",0,"单位码"],["#tab-tileqr",0,"地形码"],["#tab-mmdraw",0,"小地图绘制"],["label[for*='qr-input-text']",0,"文本："],["label[for='tileqr-size']",0,"倍率："],["#label-unitqr-player",0,"玩家："],["#label-unitqr-pos",0,"位置："],["#label-unitqr-ecl",0,"除错码："],["#label-tileqr-tiles",0,"地形："],["#label-tileqr-pos",0,"位置："],["#label-tileqr-ecl",0,"除错码："],["label[for*='qr-ecl-l']",0,"低"],["label[for*='qr-ecl-m']",0,"中"],["label[for*='qr-ecl-h']",0,"高"],["#label-unitqr-layerdown",0,"图层下移："],["#label-mmdraw-layerdown",0,"图层下移："],["#label-mmdraw-image",0,"图像："],["#label-mmdraw-size",0,"大小："],["#label-mmdraw-pos",0,"位置："],["#label-mmdraw-usegas",0,"使用气矿："],["#download-map",0,"生成地图"],["#download-chk",0,"生成CHK"],["#bubble-hint-unitqr-pos",0,"单位为像素。留空会生成在中间"],["#bubble-hint-tileqr-pos",0,"单位为格子。留空会生成在中间"],["#bubble-hint-mmdraw-pos",0,"单位为像素。留空会生成在中间"],["#bubble-hint-unitqr-layer-down",0,"把其他玩家的起始地点移到二维码下层"],["#bubble-hint-mmdraw-layerdown",0,"把所有玩家的起始点移到图像下层。会导致起始点变化"],["#bubble-hint-mmdraw-usegas",0,"生成玩家11的气矿来表示青色。建议开始游戏后用触发删掉"],["#bubble-hint-tileqr-tiles",0,"可以填SCMDraft的地形工具标题栏上的数字（如0100.01）"],["#bubble-hint-mmdraw-image",0,"黑色是透明"],["#bubble-hint-mmdraw-size",0,"单位的数量"]]},elementAttribsData={en:[],ko:[["#unitqr-input-text, #tileqr-input-text","placeholder","QR 코드로 변환하려면 여기에 텍스트를 입력하십시오"],["#mmdraw-size-width","placeholder","너비"],["#mmdraw-size-height","placeholder","높이"]],zh:[["#unitqr-input-text, #tileqr-input-text","placeholder","输入想要转换为二维码的文字或链接"],["#mmdraw-size-width","placeholder","宽度"],["#mmdraw-size-height","placeholder","高度"]]},textData={en:{},ko:{"No input map!":"입력맵이 없습니다!","No map data! load map from input first":"지도 데이터가 없습니다! 입력에서 먼저 로드 맵","No function selected!":"어떤 기능을 선택하지 않습니다!","Cannot apply function!":"기능을 적용할 수 없습니다!","Unknown error! cannot convert map":"알 수없는 오류! 맵을 변환할 수 없습니다.","Cannot save file!":"파일을 저장할 수 없습니다!","Error! cannot pack map as MPQ (try saving as CHK)":"오류! 맵을 MPQ로 포장할 수 없습니다(CHK로 저장해 보십시오)","Failed to read map data!":"지도 데이터를 읽지 못했습니다!","No input text!":"텍스트를 입력하십시오!","Please upload image file!":"이미지를 업로드해 주세요!"},zh:{"No input map!":"没有输入图！","No map data! load map from input first":"没有地图数据！首先加载地图","No function selected!":"没有选择任何功能！","Cannot apply function!":"不能应用功能！","Unknown error! cannot convert map":"未知错误！无法转换地图","Cannot save file!":"无法保存文件！","Error! cannot pack map as MPQ (try saving as CHK)":"错误！不能将地图打包为 MPQ（尝试将地图保存为 CHK）","Failed to read map data!":"无法读取地图数据！","No input text!":"没有输入文本！","Please upload image file!":"请上传图像文件！"}};let currentLocale="en";const availableTranslations=["ko","zh"];function detectLocale(){for(let i=0;i<availableTranslations.length;i++){var key=availableTranslations[i];if(0==navigator.language.toString().indexOf(key))return currentLocale=key}return currentLocale}function translateElements(elemsData,elemsAttribsData){var fillBackEn=!1;0==elementsData.en.length&&(fillBackEn=!0),elemsData.forEach(args=>{let[selectors,textNodeID,text]=args,fbe=fillBackEn;Array.from(document.querySelectorAll(selectors)).map(a=>Array.from(a.childNodes).filter(cn=>cn.nodeType==document.TEXT_NODE)).forEach(a=>{a[textNodeID]&&(fbe&&(elementsData.en.push([selectors,textNodeID,a[textNodeID].textContent]),fbe=!1),a[textNodeID].textContent=text)})}),elemsAttribsData.forEach(args=>{let fbe=fillBackEn,[selectors,attribID,text]=args;Array.from(document.querySelectorAll(selectors)).forEach(a=>{fbe&&(elementAttribsData.en.push([selectors,attribID,a[attribID]]),fbe=!1),a[attribID]=text})})}module.exports={detectLocale:detectLocale,autoSetLocale:function(){var loc=detectLocale();return-1!=availableTranslations.indexOf(loc)&&translateElements(elementsData[loc],elementAttribsData[loc]),loc},changeLocale:function(){return currentLocale="en"==currentLocale?"ko":"ko"==currentLocale?"zh":"zh"==currentLocale?"en":"ko",translateElements(elementsData[currentLocale],elementAttribsData[currentLocale]),currentLocale},translateElements:translateElements,getI18n:function(key){return textData[currentLocale]&&textData[currentLocale][key]||key}}},{}],38:[function(require,module,exports){"use strict";const drawStars=require("./starsky")["drawStars"],{previewMinimapImage,patchChkDrawMinimap}=require("./minimapdraw"),findChunk=require("./chunkfind")["findChunk"],{previewQR,patchChkUnitQR,patchChkTileQR,getStartLocationSizes,suggestTiles}=require("./scqr"),objpacker=require("./objpacker"),chkstructs=require("./chkstructs"),{autoSetLocale,getI18n,changeLocale}=require("./i18n");var hiddenCanvas,downloadLink,mapChkData,optionsVisible=!1,downloadsVisible=!1,selectedFunction=0;function $Q(e){return document.querySelector(e)}function attachBubbleHintEvent(mainElem,bubbleHintElem){mainElem.addEventListener("mouseover",evt=>{bubbleHintElem.style.setProperty("display","block"),bubbleHintElem.style.setProperty("top",`${mainElem.offsetTop-bubbleHintElem.offsetHeight-12}px`),bubbleHintElem.style.setProperty("left",`${mainElem.offsetLeft}px`)}),mainElem.addEventListener("mouseout",evt=>{bubbleHintElem.style.setProperty("display","none")})}function warning(removeWarningFunction){let elem=document.createElement("div");elem.className="status-item";let elemText=document.createElement("div");elemText.className="status-message",elemText.innerHTML=removeWarningFunction,elem.appendChild(elemText);removeWarningFunction=evt=>{elem&&!elem.isBeingRemoved&&(elem.isBeingRemoved=!0,elem.style.setProperty("animation","fade 500ms reverse"),elem.style.setProperty("opacity",0),setTimeout(()=>{try{document.getElementById("status-container").removeChild(elem)}catch(e){}},550))};elem.addEventListener("click",removeWarningFunction),document.getElementById("status-container").appendChild(elem),setTimeout(removeWarningFunction,3e3)}function show(elem,val="block",time="500ms"){elem.style.setProperty("display",val),elem.style.setProperty("animation",`fade ${time}`),elem.style.setProperty("opacity",1)}function hide(elem){elem.style.setProperty("display","none"),elem.style.setProperty("animation","fadeout 500ms"),elem.style.setProperty("opacity",0)}function toHex(n){return"0x"+n.toString(16).padStart("0",2).toUpperCase()}function readFileToUint8Array(file){let fr=new FileReader;return new Promise((res,rej)=>{fr.readAsArrayBuffer(file),fr.onload=evt=>{res(fr.result)},fr.onerror=rej}).then(s=>new Uint8Array(s))}async function mapFileChange(evt){try{$Q("#map-input-status-text").innerText=$Q("#map-file").files[0].name}catch(e){return void warning(getI18n("No input map!"))}try{let fileData=await readFileToUint8Array($Q("#map-file").files[0]);var fileMagic=objpacker.packToUint32("<4B",fileData.slice(0,4));mapChkData=441536589===fileMagic?await async function(mpqData){let mpq=await MPQ.fromArrayBuffer(mpqData),mpqPath=mpq.filePath,chkData=mpq.readFile("staredit\\scenario.chk");mpq.close();try{FS.unlink(mpqPath)}catch(e){console.log(e)}return chkData}(fileData):fileData;var dimData=findChunk(mapChkData,"DIM "),dims=chkstructs.unpackDim(dimData.data);$Q("#map-size-width").innerHTML=dims.width,$Q("#map-size-height").innerHTML=dims.height;var sizes=getStartLocationSizes([dims.width,dims.height]);$Q("#mmdraw-size-width").value=sizes[4],$Q("#mmdraw-size-height").value=sizes[5];var era=7&findChunk(mapChkData,"ERA ").data[0],suggestedTiles=suggestTiles(era);$Q("#tileqr-tile-0").value=toHex(suggestedTiles[0]),$Q("#tileqr-tile-1").value=toHex(suggestedTiles[1]),optionsVisible||(show($Q(".map-info")),show($Q(".function-tabs"),"grid"),optionsVisible=!0)}catch(e){warning(getI18n("Failed to read map data!"))}}function unitqrTabClick(evt){$Q("#tab-unitqr").classList.add("function-tab-selected"),$Q("#tab-tileqr").classList.remove("function-tab-selected"),$Q("#tab-mmdraw").classList.remove("function-tab-selected"),show($Q("#function-options-unitqr")),hide($Q("#function-options-tileqr")),hide($Q("#function-options-mmdraw")),selectedFunction=1}function tileqrTabClick(evt){$Q("#tab-unitqr").classList.remove("function-tab-selected"),$Q("#tab-tileqr").classList.add("function-tab-selected"),$Q("#tab-mmdraw").classList.remove("function-tab-selected"),hide($Q("#function-options-unitqr")),show($Q("#function-options-tileqr")),hide($Q("#function-options-mmdraw")),selectedFunction=2}function mmdrawTabClick(evt){$Q("#tab-unitqr").classList.remove("function-tab-selected"),$Q("#tab-tileqr").classList.remove("function-tab-selected"),$Q("#tab-mmdraw").classList.add("function-tab-selected"),hide($Q("#function-options-unitqr")),hide($Q("#function-options-tileqr")),show($Q("#function-options-mmdraw")),selectedFunction=3}function getErrorCorrectionLevel(){return 1==selectedFunction?$Q("#unitqr-ecl-l").checked?"L":$Q("#unitqr-ecl-h").checked?"H":"M":2==selectedFunction?$Q("#tileqr-ecl-l").checked?"L":$Q("#tileqr-ecl-h").checked?"H":"M":"M"}async function unitqrInputTextChange(evt){var text=$Q("#unitqr-input-text").value;await previewQR($Q("#previewer"),text,{errorCorrectionLevel:getErrorCorrectionLevel()}),$Q("#previewer").style.setProperty("width","256px"),$Q("#previewer").style.setProperty("height","256px"),downloadsVisible||(show($Q(".results"),"grid"),downloadsVisible=!0)}async function tileqrInputTextChange(evt){var text=$Q("#tileqr-input-text").value;await previewQR($Q("#previewer"),text,{errorCorrectionLevel:getErrorCorrectionLevel()}),$Q("#previewer").style.setProperty("width","256px"),$Q("#previewer").style.setProperty("height","256px"),downloadsVisible||(show($Q(".results"),"grid"),downloadsVisible=!0)}function mmdrawImageFileChange(evt){try{$Q("#mmdraw-image-status-text").innerText=$Q("#mmdraw-image-file").files[0].name}catch(e){}previewMinimapImage($Q("#mmdraw-image-file").files[0],hiddenCanvas,$Q("#previewer"),$Q("#mmdraw-size-width").value||32,$Q("#mmdraw-size-height").value||32),downloadsVisible||(show($Q(".results"),"grid"),downloadsVisible=!0)}function parseTile(arr){if(-1==arr.indexOf("."))return parseInt(arr);arr=arr.split(".");return 16*parseInt(arr[0],10)+parseInt(arr[1],10)}function saveFile(url,filename,linkElem){url=new Blob([url]),url=URL.createObjectURL(url);linkElem.href=url,linkElem.download=filename,linkElem.click()}async function saveMapOrChkClick(outputRawChk){if(mapChkData){try{var newChkData;if(1==selectedFunction){if(""==$Q("#unitqr-input-text").value)return void warning(getI18n("No input text!"));chkData=mapChkData,text=$Q("#unitqr-input-text").value,p0=parseInt($Q("#unitqr-player-0").value),p1=parseInt($Q("#unitqr-player-1").value),x=parseInt($Q("#unitqr-pos-x").value),y=parseInt($Q("#unitqr-pos-y").value),ld=!!$Q("#unitqr-layerdown").checked,newChkData=patchChkUnitQR(chkData,text,{offsetX:isNaN(x)?null:x,offsetY:isNaN(y)?null:y,player0:isNaN(p0)?6:p0,player1:isNaN(p1)?5:p1,layerDown:ld,errorCorrectionLevel:getErrorCorrectionLevel()})}else if(2==selectedFunction){if(""==$Q("#tileqr-input-text").value)return void warning(getI18n("No input text!"));newChkData=function(chkData){var text=$Q("#tileqr-input-text").value,t0=parseTile($Q("#tileqr-tile-0").value),t1=parseTile($Q("#tileqr-tile-1").value),x=parseInt($Q("#tileqr-pos-x").value),y=parseInt($Q("#tileqr-pos-y").value),size=parseInt($Q("#tileqr-size").value);return patchChkTileQR(chkData,text,{offsetX:isNaN(x)?null:x,offsetY:isNaN(y)?null:y,tile0:isNaN(t0)?64:t0,tile1:isNaN(t1)?416:t1,tileSize:size,errorCorrectionLevel:getErrorCorrectionLevel()})}(mapChkData)}else{if(3!=selectedFunction)return void warning(getI18n("No function selected!"));if(!$Q("#mmdraw-image-file").files[0])return void warning(getI18n("Please upload image file!"));newChkData=await function(chkData){$Q("#tileqr-input-text").value;var width=parseInt($Q("#mmdraw-size-width").value),height=parseInt($Q("#mmdraw-size-height").value),x=parseInt($Q("#mmdraw-pos-x").value),y=parseInt($Q("#mmdraw-pos-y").value),layerDown=!!$Q("#mmdraw-layerdown").checked,useGas=!!$Q("#mmdraw-usegas").checked;return patchChkDrawMinimap(chkData,$Q("#mmdraw-image-file").files[0],{canvas:hiddenCanvas,offsetX:isNaN(x)?null:x,offsetY:isNaN(y)?null:y,width:isNaN(width)?null:width,height:isNaN(height)?null:height,useGas:useGas,layerDown:layerDown})}(mapChkData)}}catch(e){return void warning(getI18n("Cannot apply function!"))}var chkData,text,p0,p1,x,y,ld,newMpqData;if(newChkData){if(outputRawChk)try{return void saveFile(newChkData,"scenario.chk",downloadLink)}catch(e){return void warning(getI18n("Cannot save file!"))}try{let fileData=await readFileToUint8Array($Q("#map-file").files[0]);if(441536589===objpacker.packToUint32("<4B",fileData.slice(0,4))){let newMpq=await async function(origMpqData,chkData){let mpq=await MPQ.fromArrayBuffer(origMpqData);return mpq.addFileFromArrayBuffer("staredit\\scenario.chk",chkData,{compression:["pkware"],encrypt:!0,fixKey:!1,replace:!0}).compact()}(fileData,newChkData);newMpqData=newMpq.toArrayBuffer(),newMpq.close();try{FS.unlink(newMpq.filePath)}catch(e){}}else{let createdMpq=await async function(chkData){let mpq=await MPQ.create(`temp_scqr_${Math.floor(1e5*Math.random())}.mpq`,{version:1,fileFlagsListfile:{compression:["pkware"],encrypt:!0,fixKey:!1},fileFlagsAttributes:{},fileFlagsSignature:{}});return mpq.addFileFromArrayBuffer("staredit\\scenario.chk",chkData,{compression:["pkware"],encrypt:!0,fixKey:!1,replace:!0}).compact()}(newChkData);newMpqData=createdMpq.toArrayBuffer(),createdMpq.close();try{FS.unlink(createdMpq.filePath)}catch(e){}}if(!newMpqData)throw new Error("localError")}catch(e){return void warning(getI18n("Error! cannot pack map as MPQ (try saving as CHK)"))}try{saveFile(newMpqData,$Q("#map-file").files[0].name.replace(".chk",".scx"),downloadLink)}catch(e){warning(getI18n("Cannot save file!"))}}else warning(getI18n("Unknown error! cannot convert map"))}else warning(getI18n("No map data! load map from input first"))}function saveMapClick(evt){saveMapOrChkClick(!1)}function saveChkClick(evt){saveMapOrChkClick(!0)}window.init=function(){hiddenCanvas=document.getElementById("hidden-canvas").getContext("2d"),downloadLink=document.getElementById("save-link");let canvasElem=document.getElementById("night-sky");drawStars(canvasElem.getContext("2d"),canvasElem.width,canvasElem.height),attachBubbleHintEvent($Q("#label-unitqr-pos"),$Q("#bubble-hint-unitqr-pos")),attachBubbleHintEvent($Q("#label-unitqr-layerdown"),$Q("#bubble-hint-unitqr-layer-down")),attachBubbleHintEvent($Q("#label-tileqr-tiles"),$Q("#bubble-hint-tileqr-tiles")),attachBubbleHintEvent($Q("#label-tileqr-pos"),$Q("#bubble-hint-tileqr-pos")),attachBubbleHintEvent($Q("#label-mmdraw-image"),$Q("#bubble-hint-mmdraw-image")),attachBubbleHintEvent($Q("#label-mmdraw-size"),$Q("#bubble-hint-mmdraw-size")),attachBubbleHintEvent($Q("#label-mmdraw-pos"),$Q("#bubble-hint-mmdraw-pos")),attachBubbleHintEvent($Q("#label-mmdraw-layerdown"),$Q("#bubble-hint-mmdraw-layerdown")),attachBubbleHintEvent($Q("#label-mmdraw-usegas"),$Q("#bubble-hint-mmdraw-usegas")),$Q("#mmdraw-image-file").addEventListener("change",mmdrawImageFileChange),$Q("#map-file").addEventListener("change",mapFileChange),$Q("#unitqr-input-text").addEventListener("change",unitqrInputTextChange),$Q("#tileqr-input-text").addEventListener("change",tileqrInputTextChange),$Q("#tab-unitqr").addEventListener("click",unitqrTabClick),$Q("#tab-tileqr").addEventListener("click",tileqrTabClick),$Q("#tab-mmdraw").addEventListener("click",mmdrawTabClick),$Q("#download-map").addEventListener("click",saveMapClick),$Q("#download-chk").addEventListener("click",saveChkClick),$Q("#link-change-language").addEventListener("click",evt=>{var locale=changeLocale();document.body.lang=locale});var locale=autoSetLocale();document.body.lang=locale}},{"./chkstructs":35,"./chunkfind":36,"./i18n":37,"./minimapdraw":39,"./objpacker":41,"./scqr":42,"./starsky":43}],39:[function(require,module,exports){"use strict";const chkstructs=require("./chkstructs"),{findChunk,replaceChunk}=require("./chunkfind"),{getStartLocationSizes,mergeUnits,mergeUnitsLayerDown,createStartLocation,createUnitObject,validateUnitSection}=require("./scqr"),findNearestColorIndex=require("./nearestcolor")["findNearestColorIndex"],playerColors=[[244,4,4],[12,72,204],[44,180,148],[136,64,156],[248,140,20],[112,48,20],[240,240,240],[204,224,208],[8,128,8],[252,252,124],[236,196,176],[64,104,212]],resourceColor=[0,228,252];async function getImageFileData(imgFile,canvas,options){let width,height,fr=new FileReader;var loadedImage=await new Promise((res,rej)=>{fr.readAsDataURL(imgFile),fr.onload=evt=>{let im=new Image;im.src=fr.result,im.addEventListener("load",evt=>{width=options.width||im.width,height=options.height||im.height,res(im)}),im.addEventListener("error",rej)},fr.onerror=rej});return canvas.drawImage(loadedImage,0,0,width,height),Array.from(canvas.getImageData(0,0,width,height).data)}function approxPlayerColors(colors,useResource){let approxColors=[[0,0,0]].concat(playerColors),resourceIndex=playerColors.length+1;return useResource&&(approxColors=approxColors.concat([resourceColor])),colors.map(row=>row.map(nearest=>{nearest=findNearestColorIndex(nearest,approxColors);return 0==nearest?-1:nearest==resourceIndex?-2:nearest-1}))}function applyPlayerColors(pColors){return pColors.map(row=>row.map(pColor=>-1==pColor?[0,0,0]:-2==pColor?resourceColor:playerColors[pColor]))}function createGas(x,y){return createUnitObject(188,10,x,y)}function chunkize(array,n){return array.reduce((r,e,i)=>(i%n?r[r.length-1].push(e):r.push([e]))&&r,[])}module.exports={patchChkDrawMinimap:async function(chkData,imageFile,options={}){var chunkedBuf=findChunk(chkData,"DIM "),gasUnits=chkstructs.unpackDim(chunkedBuf.data),minimapUnits=getStartLocationSizes([gasUnits.width,gasUnits.height]),unitsNewBuffer=options.width||minimapUnits[4],chunkedBuf=options.height||minimapUnits[5],minimapUnits=options.useGas,chunkedBuf=chunkize(await getImageFileData(imageFile,options.canvas,{width:unitsNewBuffer,height:chunkedBuf}),4),minimapUnits=(unitsNewBuffer=function(pColors,dims,options){var[,,unitSizeX,unitSizeY,maxX,maxY]=getStartLocationSizes(dims);let out=[],outGas=[];var offsetX=options.offsetX||0,offsetY=options.offsetX||0;for(let i=0;i<maxY&&i<pColors.length;i++)for(let j=0;j<maxX&&j<pColors[0].length;j++){var y1=pColors[i][j];if(-1!=y1)if(-2==y1){var x=Math.round(offsetX+(j+.5)*unitSizeX),y1=Math.round(offsetY+(i+.5)*unitSizeY-16),y=Math.round(offsetY+(i+.5)*unitSizeY+16);outGas.push(createGas(x,y1)),outGas.push(createGas(x,y))}else{let x=Math.round(offsetX+(j+.5)*unitSizeX);y=Math.round(offsetY+(i+.5)*unitSizeY);out.push(createStartLocation(pColors[i][j],x,y))}}return[out,outGas]}(approxPlayerColors(chunkize(chunkedBuf,unitsNewBuffer),minimapUnits),[gasUnits.width,gasUnits.height],{offsetX:options.offsetX,offsetY:options.offsetY}))[0],gasUnits=unitsNewBuffer[1],unitsNewBuffer=findChunk(chkData,"UNIT",validateUnitSection),unitsNewBuffer=chkstructs.unpackAllUnits(unitsNewBuffer.data);return unitsNewBuffer=options.layerDown?mergeUnitsLayerDown(unitsNewBuffer,minimapUnits,[]):mergeUnits(minimapUnits,unitsNewBuffer),unitsNewBuffer=mergeUnits(unitsNewBuffer,gasUnits),unitsNewBuffer=chkstructs.packAllUnits(unitsNewBuffer),replaceChunk(chkData,"UNIT",unitsNewBuffer,validateUnitSection)},previewMinimapImage:async function(colorArray,_canvasW,outputCanvasElem,width,newImageData){var _canvasH=chunkize(await getImageFileData(colorArray,_canvasW,{width:width,height:newImageData}),4),colorArray=applyPlayerColors(approxPlayerColors(chunkize(_canvasH,width),!1)).map(s=>s.reduce((a,b)=>a.concat(b).concat([255]),[])).reduce((a,b)=>a.concat(b),[]),_canvasW=outputCanvasElem.offsetWidth,_canvasH=outputCanvasElem.offsetHeight;outputCanvasElem.width=width,outputCanvasElem.height=newImageData,outputCanvasElem.style.setProperty("width",`${_canvasW}px`),outputCanvasElem.style.setProperty("height",`${_canvasH}px`);let outputCanvas=outputCanvasElem.getContext("2d");outputCanvas.fillStyle="rgb(0, 0, 0)",outputCanvas.fillRect(0,0,width,newImageData),newImageData=new ImageData(new Uint8ClampedArray(colorArray),width,newImageData),outputCanvas.putImageData(newImageData,0,0)}}},{"./chkstructs":35,"./chunkfind":36,"./nearestcolor":40,"./scqr":42}],40:[function(require,module,exports){"use strict";exports.findNearestColor=function(color,colorList){let scores=[];return colorList.forEach((c,i)=>{scores.push([i,(c[0]-color[0])**2+(c[1]-color[1])**2+(c[2]-color[2])**2])}),scores=scores.sort((a,b)=>a[1]-b[1]),colorList[scores[0][0]]},exports.findNearestColorIndex=function(color,colorList){let scores=[];return colorList.forEach((c,i)=>{scores.push([i,(c[0]-color[0])**2+(c[1]-color[1])**2+(c[2]-color[2])**2])}),scores=scores.sort((a,b)=>a[1]-b[1]),scores[0][0]}},{}],41:[function(require,module,exports){"use strict";const bufferpack=require("bufferpack");module.exports={unpack:function(pattern,objKeys,buffer){let unpacked=bufferpack.unpack(pattern,buffer),out={},p=0;return objKeys.forEach(key=>{var n;/\[.*\]/.test(key)?(n=parseInt(key.match(/\[(.*)\]/)[1]),out[key.replace(/\[.*\]/g,"")]=unpacked.slice(p,p+n),p+=n):(out[key]=unpacked[p],p++)}),out},pack:function(pattern,objKeys,obj){let a=[];return objKeys.forEach(key=>{/\[.*\]/.test(key)?(parseInt(key.match(/\[(.*)\]/)[1]),a=a.concat(out[key.replace(/\[.*\]/g,"")])):a.push(obj[key])}),bufferpack.pack(pattern,a)},packToUint32:function(pattern,packed){return packed=bufferpack.pack(pattern,packed),bufferpack.unpack("<I",packed)[0]},unpackFlags:function(binFlags,flagIdentifiers,truncated=!1){let out={};return flagIdentifiers.forEach((key,i)=>{truncated?binFlags&1<<i&&(out[key]=!0):out[key]=!!(binFlags&1<<i)}),out},packFlags:function(objFlags,flagIdentifiers){let out=0;return flagIdentifiers.forEach((key,i)=>{objFlags[key]&&(out|=1<<i)}),out}}},{bufferpack:4}],42:[function(require,module,exports){"use strict";const QRCode=require("qrcode"),chkstructs=require("./chkstructs"),{findChunk,replaceChunk}=require("./chunkfind");function createQRData(qrText,qr){qr=QRCode.create(qrText,qr);let out=[],data=qr.modules.data;var size=qr.modules.size;for(let i=0;i<size;i++)out.push(Array.from(data.slice(i*size,(i+1)*size)));return out}function setTile(tileArray,newTileArray,offsetX=0,offsetY=0){for(let i=0;i<newTileArray.length&&i+offsetY<tileArray.length;i++)for(let j=0;j<newTileArray[0].length&&j+offsetX<tileArray[0].length;j++)tileArray[i+offsetY][j+offsetX]=newTileArray[i][j];return tileArray}function getQRTiles(qrText,mat){let tile0=mat.tile0,tile1=mat.tile1;var n,size=mat.tileSize;let qrData=createQRData(qrText,mat),qrTiles=qrData.map(row=>row.map(item=>item?tile1:tile0));return 1<size&&(qrTiles=(mat=qrTiles,n=size,mat.map(row=>row.map(val=>Array(n).fill(val)).reduce((t,a)=>t.concat(a),[])).map(row=>Array(n).fill(row)).reduce((t,a)=>t.concat(a),[]))),qrTiles}function createUnitObject(unitID,player,x,y){return{classInstance:Math.floor(2147483647*Math.random()),x:x,y:y,unitID:unitID,relation:{},validFlags:{hallucinated:!0,invincible:!0},validProps:{owner:!0},player:player,hp:100,sp:0,energy:0,resources:0,hangar:0,stateFlags:{},relationCI:0}}function createStartLocation(player,x,y){return createUnitObject(214,player,x,y)}function mergeUnitsLayerDown(otherUnits,u,usedPlayers){var sLocsToMoveFront=otherUnits.filter(u=>214===u.unitID&&usedPlayers.every(p=>p!=u)),otherUnits=otherUnits.filter(u=>214!==u.unitID||!usedPlayers.every(p=>p!=u)),u=mergeUnits(sLocsToMoveFront,u);return mergeUnits(u,otherUnits)}function mergeUnits(units1,units2){return units1.concat(units2)}function getStartLocationSizes(mapSize){var t=Math.max(mapSize[0],mapSize[1]),t=t<=64?48:t<=96?64:t<=128?96:128;return[32*mapSize[0],32*mapSize[1],t,t,Math.floor(32*mapSize[0]/t),Math.floor(32*mapSize[1]/t)]}function validateUnitSection(len,buf){return len%36==0&&len<36e5}module.exports={patchChkTileQR:function(chkData,qrTiles,offsetY={}){var qrTiles=getQRTiles(qrTiles,{tile0:null!==(offsetX=offsetY.tile0)&&void 0!==offsetX?offsetX:64,tile1:null!==(dims=offsetY.tile1)&&void 0!==dims?dims:416,tileSize:null!==(repackedTiles=offsetY.tileSize)&&void 0!==repackedTiles?repackedTiles:2}),offsetX=findChunk(chkData,"DIM "),dims=chkstructs.unpackDim(offsetX.data),offsetX=null!==(repackedTiles=offsetY.offsetX)&&void 0!==repackedTiles?repackedTiles:dims.width-qrTiles[0].length>>1,offsetY=null!==(repackedTiles=offsetY.offsetY)&&void 0!==repackedTiles?repackedTiles:dims.height-qrTiles.length>>1,repackedTiles=findChunk(chkData,"MTXM"),repackedTiles=setTile(repackedTiles=chkstructs.unpackTile(repackedTiles.data,[dims.width,dims.height]),qrTiles,offsetX,offsetY),repackedTiles=chkstructs.packTile(repackedTiles);let newBuffer=replaceChunk(chkData,"MTXM",repackedTiles);try{var tileDataSE=findChunk(chkData,"TILE"),tilesSE=setTile(tilesSE=chkstructs.unpackTile(tileDataSE.data,[dims.width,dims.height]),qrTiles,offsetX,offsetY),repackedTilesSE=chkstructs.packTile(tilesSE);newBuffer=replaceChunk(newBuffer,"TILE",repackedTilesSE)}catch(e){}return newBuffer},patchChkUnitQR:function(chkData,unitsNewBuffer,qrParams={}){var _qrParams$player2=findChunk(chkData,"DIM "),qrUnits=chkstructs.unpackDim(_qrParams$player2.data);return qrParams.player0=null!==(_qrParams$player2=qrParams.player0)&&void 0!==_qrParams$player2?_qrParams$player2:6,qrParams.player1=null!==(_qrParams$player2=qrParams.player1)&&void 0!==_qrParams$player2?_qrParams$player2:5,qrUnits=getStartLocationSizes([qrUnits.width,qrUnits.height]),qrParams.mapSize=[qrUnits[0],qrUnits[1]],qrParams.unitSize=qrUnits[2],qrUnits=function(mapSize,qrParams){var l,r,t,b,unitSizeX,unitSizeY,qrData=createQRData(mapSize,qrParams),player0=qrParams.player0,player1=qrParams.player1,size=qrData.length,defUnitSize=qrParams.unitSize||96,mapSize=qrParams.mapSize;qrParams.offsetX&&qrParams.offsetY?(r=(l=qrParams.offsetX)+(unitSizeX=defUnitSize)*size,t=qrParams.offsetY,b+=(unitSizeY=defUnitSize)*size):mapSize[0]<=defUnitSize*size||mapSize[1]<=defUnitSize*size?(r=mapSize[0]-(l=64),b=mapSize[1]-(t=64),unitSizeX=Math.round((r-l)/(qrData[0].length-1)),unitSizeY=Math.round((b-t)/(qrData.length-1))):(l=mapSize[0]-(unitSizeY=unitSizeX=defUnitSize)*size>>1,r=mapSize[0]-l,t=mapSize[1]-defUnitSize*size>>1,b=mapSize[1]-t);let out=[];for(let i=0;i<qrData.length;i++)for(let j=0;j<qrData[0].length;j++){var x=l+j*unitSizeX,y=t+i*unitSizeY;out.push(createStartLocation(qrData[i][j]?player1:player0,x,y))}return out}(unitsNewBuffer,qrParams).sort((a,b)=>a.x-b.x),unitsNewBuffer=findChunk(chkData,"UNIT",validateUnitSection),unitsNewBuffer=chkstructs.unpackAllUnits(unitsNewBuffer.data),unitsNewBuffer=qrParams.layerDown?mergeUnitsLayerDown(unitsNewBuffer,qrUnits,[qrParams.player0,qrParams.player1]):mergeUnits(qrUnits,unitsNewBuffer),unitsNewBuffer=chkstructs.packAllUnits(unitsNewBuffer),replaceChunk(chkData,"UNIT",unitsNewBuffer,validateUnitSection)},previewQR:function(canvasElem,qrText,qrParams){QRCode.toCanvas(canvasElem,qrText,qrParams)},getStartLocationSizes:getStartLocationSizes,mergeUnits:mergeUnits,mergeUnitsLayerDown:mergeUnitsLayerDown,createStartLocation:createStartLocation,createUnitObject:createUnitObject,validateUnitSection:validateUnitSection,suggestTiles:function(tileset){return[[128,256],[96,256],[32,128],[192,32],[192,416],[128,416],[64,288],[128,416]][tileset]}}},{"./chkstructs":35,"./chunkfind":36,qrcode:7}],43:[function(require,module,exports){"use strict";module.exports.drawStars=function(canvas,w,h){for(let i=0;i<1e3;i++)canvas.beginPath(),canvas.fillStyle=`rgb(${Math.floor(32*Math.random()+224)}, ${Math.floor(32*Math.random()+224)}, ${Math.floor(16*Math.random()+240)})`,canvas.arc(Math.floor(Math.random()*w),Math.floor(Math.random()*h),2*Math.random(),0,2*Math.PI),canvas.fill()}},{}]},{},[38]);
